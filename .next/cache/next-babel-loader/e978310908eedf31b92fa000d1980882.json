{"ast":null,"code":"import _Avatar from \"antd/lib/avatar\";\nimport _message from \"antd/lib/message\";\nimport _JSXStyle from \"styled-jsx/style\";\nvar __jsx = React.createElement;\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == typeof i ? i : i + \"\"; }\nfunction _toPrimitive(t, r) { if (\"object\" != typeof t || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != typeof i) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nimport React, { Component, useEffect } from 'react';\nimport { STYLE_URL } from \"../consts\";\nimport Marker from \"./Marker\";\nimport { connect } from 'react-redux';\nimport BottomInfoLocation from \"./BottomInfoLocation\";\nimport MenuRightClick from \"./MenuRightCLick\";\nimport { getDetailLatLngService } from \"../redux/sagas/placeSaga\";\nimport equal from 'fast-deep-equal/es6/react';\nimport { setMapViewportAction, getDetailByLatLngAction, setCenterLatLngAction, setMyLocationAction, getDetailByIdAction } from \"../redux/actions/place\";\nimport { searchAroundAction, clearSearchAroundAction, selectAroundPlaceAction } from \"../redux/actions/search\";\nimport { selectResultAction, navigationFromAction, navigationToAction, clearResultAction, navigationAction } from \"../redux/actions/navigation\";\nimport MarkerNavigation from \"./MarkerNavigation\";\nimport { setRedMarkerAction, setCollapsedInfoBoxAction, setPopupRightClick, setBoxVisibleAction } from \"../redux/actions/boxVisble\";\nimport normal_map_img from \"../static/images/normal_map.png\";\nimport satellite_img from \"../static/images/satellite.jpeg\";\nimport ReactDOMServer from 'react-dom/server';\nimport Axios from 'axios';\nimport Div100vh from 'react-div-100vh';\nimport Request from \"../utils/request\";\nimport { Mile_Travel } from \"../consts\";\nimport { isMobile } from 'react-device-detect';\nimport images from \"../utils/images\";\nimport { useDispatch, useSelector } from 'react-redux';\nimport { getParkingLotsRequest } from \"../redux/actions/parkingLot\";\nclass Map extends Component {\n  constructor(props) {\n    super(props);\n    _defineProperty(this, \"_onViewportChange\", viewport => {\n      this.props.dispatch(setMapViewportAction(viewport));\n    });\n    _defineProperty(this, \"_onMouseClick\", e => {\n      this.props.dispatch(setPopupRightClick(false));\n      if (this.props.boxVisible !== 'iframe') {\n        this.props.dispatch(setRedMarkerAction(false));\n      }\n      // if (this.props.boxVisible === \"info\") this.props.dispatch(setBoxVisibleAction('search'))\n      // this.markerWhatIs ? this.markerWhatIs.remove() : null;\n      this.props.dispatch(selectAroundPlaceAction(null));\n      this.removeMarkerWhatIs();\n      this.setState({\n        bottomInfoVisible: false\n      });\n    });\n    _defineProperty(this, \"_onRightClick\", e => {\n      const position = {\n        lat: e.lngLat.lat,\n        lng: e.lngLat.lng\n      };\n      if (this.props.boxVisible !== 'iframe') {\n        this.props.dispatch(setRedMarkerAction(true, position));\n        this.props.dispatch(setPopupRightClick(true, position, 'normal'));\n      }\n    });\n    _defineProperty(this, \"_onClickMenu\", evt => {\n      const parent = evt.target.parentElement;\n      if (evt.target.className && evt.target.className.toString().includes('what-is-this')) {\n        this.handleWhatIs();\n      } else if (evt.target.className && evt.target.className.toString().includes('from-here')) {\n        this.handleFromHere();\n      } else if (evt.target.className && evt.target.className.toString().includes('to-here')) {\n        this.handleToHere();\n      } else if (evt.target.className && evt.target.className.toString().includes('delete-location')) {\n        this.handleDeleteLocation();\n      } else if (evt.target.className && evt.target.className.toString().includes('search-around')) {\n        this.handleSearchAround();\n      } else if (evt.target.className && evt.target.className.toString().includes('to-around-place')) {\n        this.handleToAroundPlace();\n      } else if (evt.target.className && evt.target.className.toString().includes('what-is-navigation')) {\n        this.handleWhatIs(false);\n      }\n      if (parent !== null && parent !== void 0 && parent.className && parent !== null && parent !== void 0 && parent.className.toString().includes('menu-right-click')) {\n        if (evt.target.className && !evt.target.className.toString().includes('what-is-this')) {\n          this.props.dispatch(clearSearchAroundAction());\n        }\n        this.props.dispatch(setPopupRightClick(false));\n        this.removeMarkerWhatIs();\n      }\n    });\n    _defineProperty(this, \"changeVisibleBottomInfo\", visible => {\n      this.setState({\n        bottomInfoVisible: visible\n      });\n    });\n    _defineProperty(this, \"_getInforPlace\", async (lat = (_this$props$position_ => (_this$props$position_ = this.props.position_popup) === null || _this$props$position_ === void 0 ? void 0 : _this$props$position_.lat)(), lng = (_this$props$position_2 => (_this$props$position_2 = this.props.position_popup) === null || _this$props$position_2 === void 0 ? void 0 : _this$props$position_2.lng)()) => {\n      const latLng = {\n        latitude: lat,\n        longitude: lng\n      };\n      try {\n        const response = await getDetailLatLngService(latLng);\n        if (response.data.results.length > 0) {\n          const place_response = response.data.results[0];\n          return _objectSpread(_objectSpread({}, place_response), {}, {\n            name: place_response.address_components[0].long_name,\n            formatted_address: this.getAddressGeocode(place_response)\n          });\n        } else {\n          _message.error('Không tìm thấy địa điểm !!');\n          return null;\n        }\n      } catch (error) {\n        throw error;\n      }\n    });\n    _defineProperty(this, \"selectPlace\", async (lat = (_this$props$positionM => (_this$props$positionM = this.props.positionMarkerSelect) === null || _this$props$positionM === void 0 ? void 0 : _this$props$positionM.lat)(), lng = (_this$props$positionM2 => (_this$props$positionM2 = this.props.positionMarkerSelect) === null || _this$props$positionM2 === void 0 ? void 0 : _this$props$positionM2.lng)(), redMarkerVisible = true) => {\n      const place = await this._getInforPlace(lat, lng);\n      if (place) {\n        const viewport = {\n          longitude: lng,\n          latitude: lat,\n          zoom: 15\n        };\n        this.props.dispatch(setMapViewportAction(viewport));\n        this.setState({\n          bottomInfoVisible: true,\n          placeMouseClick: place\n        });\n        if (redMarkerVisible) {\n          if (this.markerWhatIs) {\n            this.markerWhatIs.setLngLat({\n              lat,\n              lng\n            }).addTo(this.map);\n          } else {\n            const el = document.createElement('div');\n            el.innerHTML = ReactDOMServer.renderToStaticMarkup(__jsx(Marker, {\n              size: 22\n            }));\n            this.markerWhatIs = new maplibregl.Marker(el, {\n              anchor: 'bottom'\n            }).setLngLat({\n              lat,\n              lng\n            }).addTo(this.map);\n          }\n          this.markerWhatIs.getElement().addEventListener('contextmenu', e => {\n            e.stopPropagation();\n            e.preventDefault();\n            this.props.dispatch(setRedMarkerAction(false));\n            this.props.dispatch(setPopupRightClick(true, {\n              lat,\n              lng\n            }, 'popupCurrentPlace'));\n          });\n          this.props.dispatch(setRedMarkerAction(false));\n        }\n        // redMarkerVisible ? this.props.dispatch(setRedMarkerAction(true, { lat, lng })) : null;\n      } else {\n        _message.error('Không tìm thấy địa điểm !!');\n      }\n    });\n    _defineProperty(this, \"removeMarkerWhatIs\", () => {\n      this.markerWhatIs ? this.markerWhatIs.remove() : null;\n    });\n    _defineProperty(this, \"_getInforPlaceAround\", async id => {\n      try {\n        const response = await Axios.get(`https://napi.goong.io/v1/marker/get_marker_detail/${id}`);\n        if (response.data.data) {\n          return response.data.data;\n        } else {\n          _message.error('Không tìm thấy địa điểm !!');\n          return null;\n        }\n      } catch (error) {\n        _message.error('Không tìm thấy địa điểm !');\n        throw error;\n      }\n    });\n    _defineProperty(this, \"selectAroundPlace\", async id => {\n      const place = await this._getInforPlaceAround(id);\n      if (place) {\n        const viewport = {\n          longitude: Number(place.lng_lat[0]),\n          latitude: Number(place.lng_lat[1]),\n          zoom: 15\n        };\n        this.props.dispatch(setMapViewportAction(viewport));\n        this.setState({\n          bottomInfoVisible: true,\n          placeMouseClick: place\n        });\n        this.props.dispatch(setPopupRightClick(false));\n      } else {\n        _message.error('Không tìm thấy địa điểm !!');\n      }\n    });\n    _defineProperty(this, \"handleWhatIs\", (redMarkerVisible = true) => {\n      const {\n        position_popup,\n        isSmallScreen\n      } = this.props;\n      if (isSmallScreen) {\n        this.props.dispatch(getDetailByLatLngAction({\n          latitude: position_popup.lat,\n          longitude: position_popup.lng\n        }));\n        this.props.dispatch(setBoxVisibleAction('info'));\n        this.props.dispatch(clearSearchAroundAction());\n        this.props.dispatch(setPopupRightClick(false));\n        this.removeMarkerWhatIs();\n      } else {\n        this.selectPlace(position_popup.lat, position_popup.lng, redMarkerVisible);\n      }\n    });\n    _defineProperty(this, \"handleFromHere\", async (lat, lng) => {\n      let place;\n      if (!lat || !lng) place = await this._getInforPlace();else {\n        place = await this._getInforPlace(lat, lng);\n      }\n      if (place) {\n        const viewport = {\n          longitude: place.geometry.location.lng,\n          latitude: place.geometry.location.lat,\n          zoom: 15\n        };\n        !this.props.to_place && this.props.dispatch(setMapViewportAction(viewport));\n        this.props.dispatch(setBoxVisibleAction('navigation'));\n        this.props.dispatch(navigationFromAction(place, `${place.name} - ${place.formatted_address}`));\n        this.props.dispatch(setRedMarkerAction(false));\n        this.changeVisibleBottomInfo(false);\n      }\n    });\n    _defineProperty(this, \"handleToHere\", async (lat, lng) => {\n      let place;\n      if (!lat || !lng) place = await this._getInforPlace();else {\n        place = await this._getInforPlace(lat, lng);\n      }\n      if (place) {\n        this.props.dispatch(setBoxVisibleAction('navigation'));\n        const viewport = {\n          longitude: place.geometry.location.lng,\n          latitude: place.geometry.location.lat,\n          zoom: 15\n        };\n        const my_location = this.props.my_location;\n        if (my_location && (this.props.boxVisible === 'search' || this.props.boxVisible === 'info')) {\n          try {\n            const response = await Request.geocode(my_location);\n            if (response.data.results.length > 0) {\n              this.props.dispatch(navigationFromAction(_objectSpread(_objectSpread({}, response.data.results[0]), {}, {\n                name: response.data.results[0].address_components[0].long_name\n              }), 'Vị trí của bạn'));\n            }\n          } catch (error) {\n            throw error;\n          }\n        }\n        !this.props.from_place && this.props.dispatch(setMapViewportAction(viewport));\n        this.props.dispatch(navigationToAction(place, `${place.name} - ${place.formatted_address}`));\n        this.props.dispatch(setBoxVisibleAction('navigation'));\n        this.props.dispatch(setRedMarkerAction(false));\n        this.changeVisibleBottomInfo(false);\n      }\n    });\n    _defineProperty(this, \"handleDeleteLocation\", () => {\n      const {\n        type_popup\n      } = this.props;\n      if (type_popup === 'popupFromPlace') {\n        this.props.dispatch(navigationFromAction(null, ''));\n      } else if (type_popup === 'popupToPlace') {\n        this.props.dispatch(navigationToAction(null, ''));\n      }\n      this.props.dispatch(clearResultAction());\n    });\n    _defineProperty(this, \"handleSearchAround\", async () => {\n      const place = await this._getInforPlace();\n      if (place) {\n        const viewport = {\n          longitude: place.geometry.location.lng,\n          latitude: place.geometry.location.lat,\n          zoom: 15\n        };\n        const location = {\n          lat: place.geometry.location.lat,\n          lng: place.geometry.location.lng\n        };\n        this.props.dispatch(setBoxVisibleAction('search'));\n        this.props.dispatch(setMapViewportAction(viewport));\n        this.props.dispatch(searchAroundAction(location, this.props.viewport.zoom));\n        this.setState({\n          bottomInfoVisible: false\n        });\n      }\n    });\n    _defineProperty(this, \"_selectAroundPlace\", (type, place) => {\n      if (type !== 'center') {\n        this.props.dispatch(selectAroundPlaceAction(place));\n        this.selectAroundPlace(place === null || place === void 0 ? void 0 : place.id);\n      } else {\n        this.props.dispatch(selectAroundPlaceAction(place));\n        this.selectPlace(place.geometry.location.lat, place.geometry.location.lng, false);\n      }\n    });\n    _defineProperty(this, \"handleToAroundPlace\", async () => {\n      let place = null;\n      this.props.around_places.map(item => {\n        if (item.lng_lat[0] * 1 === this.popupRightClick.getLngLat().lng && item.lng_lat[1] * 1 === this.popupRightClick.getLngLat().lat) {\n          place = item;\n        }\n      });\n      if (place) {\n        try {\n          var _response$data;\n          this.props.dispatch(setPopupRightClick(false));\n          const place_center = this.props.around_place_center;\n          this.props.dispatch(navigationFromAction(place_center, `${place_center.name} - ${place_center.formatted_address}`));\n          const response = await Axios.get(`https://napi.goong.io/v1/marker/get_marker_detail/${place.id}`);\n          place = (_response$data = response.data) === null || _response$data === void 0 ? void 0 : _response$data.data;\n          place = _objectSpread(_objectSpread({}, place), {}, {\n            place_id: place._id,\n            geometry: {\n              location: {\n                lat: Number(place.lng_lat[1]),\n                lng: Number(place.lng_lat[0])\n              }\n            },\n            formatted_address: place.description.address\n          });\n          this.props.dispatch(navigationToAction(place, `${place.name} - ${place.formatted_address}`));\n          this.props.dispatch(setBoxVisibleAction('navigation'));\n        } catch (error) {\n          _message.error('Không tìm thấy địa điểm !');\n        }\n      } else {\n        _message.error('Không tìm thấy địa điểm !');\n      }\n    });\n    _defineProperty(this, \"removeMarkerPopup\", () => {\n      if (this.markerCurrentPlace) this.markerCurrentPlace.remove();\n      if (this.popupRightClick) this.popupRightClick.remove();\n      if (this.props.around_places) this.props.dispatch(clearSearchAroundAction());\n      if (this.redMarker) this.redMarker.remove();\n    });\n    _defineProperty(this, \"getAddressGeocode\", place => {\n      var _place$address_compon;\n      let result = [];\n      (_place$address_compon = place.address_components) === null || _place$address_compon === void 0 ? void 0 : _place$address_compon.slice(1).map(item => {\n        result.push(item.long_name);\n      });\n      return result.join(',');\n    });\n    _defineProperty(this, \"changeStyle\", () => {\n      const {\n        style\n      } = this.state;\n      if (style === STYLE_URL.SATELITE + \"YJTajS80fLlhJ4a2BG0gXqXXdZzdLG5V3iivOK9e\") {\n        this.setState({\n          style: STYLE_URL.NORMAL + \"YJTajS80fLlhJ4a2BG0gXqXXdZzdLG5V3iivOK9e\"\n        });\n        this.map.setStyle(STYLE_URL.NORMAL + \"YJTajS80fLlhJ4a2BG0gXqXXdZzdLG5V3iivOK9e\");\n      } else {\n        this.setState({\n          style: STYLE_URL.SATELITE + \"YJTajS80fLlhJ4a2BG0gXqXXdZzdLG5V3iivOK9e\"\n        });\n        this.map.setStyle(STYLE_URL.SATELITE + \"YJTajS80fLlhJ4a2BG0gXqXXdZzdLG5V3iivOK9e\");\n      }\n    });\n    _defineProperty(this, \"navigationByURLIframe\", async (from, to) => {\n      this.props.dispatch(setBoxVisibleAction('iframe'));\n      this.props.dispatch(setRedMarkerAction(false));\n      this.changeVisibleBottomInfo(false);\n      let fromplace;\n      if (!from.lat || !from.lng) fromplace = await this._getInforPlace();else {\n        fromplace = await this._getInforPlace(from.lat, from.lng);\n      }\n      await this.props.dispatch(navigationFromAction(fromplace, `${fromplace.name} - ${fromplace.formatted_address}`));\n      let toplace;\n      if (!to.lat || !to.lng) toplace = await this._getInforPlace();else {\n        toplace = await this._getInforPlace(to.lat, to.lng);\n      }\n      await this.props.dispatch(navigationToAction(toplace, `${toplace.name} - ${toplace.formatted_address}`));\n      this.props.dispatch(navigationAction(this.props.from_place, this.props.to_place, 'car'));\n    });\n    _defineProperty(this, \"navigationByURL\", async (from, to) => {\n      this.props.dispatch(setBoxVisibleAction('navigation'));\n      this.props.dispatch(setRedMarkerAction(false));\n      this.changeVisibleBottomInfo(false);\n      let fromplace;\n      if (!from.lat || !from.lng) fromplace = await this._getInforPlace();else {\n        fromplace = await this._getInforPlace(from.lat, from.lng);\n      }\n      await this.props.dispatch(navigationFromAction(fromplace, `${fromplace.name} - ${fromplace.formatted_address}`));\n      let toplace;\n      if (!to.lat || !to.lng) toplace = await this._getInforPlace();else {\n        toplace = await this._getInforPlace(to.lat, to.lng);\n      }\n      await this.props.dispatch(navigationToAction(toplace, `${toplace.name} - ${toplace.formatted_address}`));\n    });\n    _defineProperty(this, \"handleStorageChange\", event => {\n      console.log('oppaopaopa');\n      if (event.key === 'search_history') {\n        this.setState({\n          value: event.newValue\n        });\n      }\n    });\n    _defineProperty(this, \"renderParkingLots\", () => {\n      const {\n        parkingLots\n      } = this.props;\n      return parkingLots === null || parkingLots === void 0 ? void 0 : parkingLots.map(lot => {\n        // Tạo element cho marker\n        const el = document.createElement('div');\n        el.className = 'marker parking-marker';\n        el.innerHTML = `\n\t\t\t\t<div class=\"marker-content\">P</div>\n\t\t\t\t<div class=\"marker-info\">\n\t\t\t\t\t<h3>${lot.name}</h3>\n\t\t\t\t\t<p>${lot.address}</p>\n\t\t\t\t\t<p>Available: ${lot.availableSpots}/${lot.capacity}</p>\n\t\t\t\t</div>\n\t\t\t`;\n\n        // Tạo marker theo docs của Goong\n        const marker = new maplibregl.Marker({\n          element: el,\n          anchor: 'bottom',\n          offset: [0, -10]\n        }).setLngLat([lot.longitude, lot.latitude]).addTo(this.map);\n\n        // Thêm sự kiện click\n        marker.getElement().addEventListener('click', () => {\n          this.handleParkingLotClick(lot);\n        });\n        return marker;\n      });\n    });\n    _defineProperty(this, \"handleParkingLotClick\", lot => {\n      // Zoom đến vị trí parking lot\n      this.map.flyTo({\n        center: [lot.longitude, lot.latitude],\n        zoom: 15\n      });\n\n      // Hiển thị thông tin\n      this.setState({\n        bottomInfoVisible: true,\n        placeMouseClick: {\n          name: lot.name,\n          formatted_address: lot.address,\n          geometry: {\n            location: {\n              lat: lot.latitude,\n              lng: lot.longitude\n            }\n          }\n        }\n      });\n    });\n    this._mapRef = /*#__PURE__*/React.createRef();\n    this.map = null;\n    this.redMarker = null;\n    this.popupRightClick = null;\n    this.popup_navigation = [];\n    this.state = {\n      style: STYLE_URL.NORMAL + \"YJTajS80fLlhJ4a2BG0gXqXXdZzdLG5V3iivOK9e\",\n      styleNormal: STYLE_URL.NORMAL + \"YJTajS80fLlhJ4a2BG0gXqXXdZzdLG5V3iivOK9e\",\n      styleEarth: STYLE_URL.SATELITE + \"YJTajS80fLlhJ4a2BG0gXqXXdZzdLG5V3iivOK9e\",\n      bottomInfoVisible: false,\n      value: localStorage.getItem('search_history') || '',\n      parkingLots: []\n    };\n    this.list = [];\n    this.listRestaurant = [];\n    this.listHistories = [];\n    this.view = null;\n    this.navigationView = null;\n  }\n  componentDidUpdate(prevProps) {\n    if (this.props.isSmallScreen !== prevProps.isSmallScreen) {\n      if (!this.props.isSmallScreen && !this.navigation) {\n        this.navigation = new maplibregl.NavigationControl();\n        this.map.addControl(this.navigation);\n      } else if (this.props.isSmallScreen && this.navigation) {\n        this.map.removeControl(this.navigation);\n        this.navigation = null;\n      }\n    }\n    if (!equal(prevProps.positionMarkerSelect, this.props.positionMarkerSelect) && this.props.positionMarkerSelect) {\n      if (this.redMarker) {\n        this.redMarker = this.redMarker.setLngLat(this.props.positionMarkerSelect).addTo(this.map);\n      } else {\n        const el = document.createElement('div');\n        el.innerHTML = ReactDOMServer.renderToStaticMarkup(__jsx(Marker, {\n          size: 22\n        }));\n        // Marker chuột phải\n        this.redMarker = new maplibregl.Marker({\n          anchor: 'bottom',\n          element: el\n        }).setLngLat(this.props.positionMarkerSelect).addTo(this.map);\n        this.redMarker.getElement().addEventListener('contextmenu', e => {\n          e.stopPropagation();\n          e.preventDefault();\n          this.props.dispatch(setPopupRightClick(true, this.props.positionMarkerSelect, 'normal'));\n        });\n      }\n    }\n    if (prevProps.markerSelect !== this.props.markerSelect) {\n      if (!this.props.markerSelect) {\n        var _this$redMarker;\n        (_this$redMarker = this.redMarker) === null || _this$redMarker === void 0 ? void 0 : _this$redMarker.remove();\n      }\n    }\n    if (this.props.popup_visible && (!equal(prevProps.position_popup, this.props.position_popup) || this.props.type_popup !== prevProps.type_popup) && this.props.position_popup) {\n      this.popupRightClick = this.popupRightClick ? this.popupRightClick.setLngLat([this.props.position_popup.lng, this.props.position_popup.lat]).addTo(this.map).setHTML(ReactDOMServer.renderToStaticMarkup(__jsx(MenuRightClick, {\n        dispatch: this.props.dispatch,\n        position_popup: this.props.position_popup,\n        type_popup: this.props.type_popup\n      }))) : new maplibregl.Popup({\n        closeButton: false,\n        anchor: 'top',\n        closeOnClick: false,\n        offset: [0, 5]\n      }).setLngLat([this.props.position_popup.lng, this.props.position_popup.lat]).setHTML(ReactDOMServer.renderToStaticMarkup(__jsx(MenuRightClick, {\n        dispatch: this.props.dispatch,\n        position_popup: this.props.position_popup,\n        type_popup: this.props.type_popup\n      }))).addTo(this.map);\n    }\n    if (this.popupRightClick && !this.props.popup_visible) {\n      this.popupRightClick.remove();\n    }\n    if (!equal(prevProps.current_place, this.props.current_place) && this.props.current_place) {\n      const selectedPlace = this.props.current_place;\n      this.map.flyTo({\n        center: [selectedPlace.geometry.location.lng, selectedPlace.geometry.location.lat],\n        zoom: 15,\n        speed: 1.5,\n        curve: 1\n      });\n      this.props.dispatch(setCollapsedInfoBoxAction(false));\n      this.props.dispatch(setRedMarkerAction(false));\n      this.setState({\n        bottomInfoVisible: false\n      });\n    }\n    if (!equal(prevProps.viewport, this.props.viewport) && this.props.viewport) {\n      this.map.flyTo({\n        center: [this.props.viewport.longitude, this.props.viewport.latitude],\n        zoom: this.props.viewport.zoom,\n        speed: 2\n      });\n    }\n    if (!equal(prevProps.around_place_center, this.props.around_place_center)) {\n      this.props.dispatch(setRedMarkerAction(false));\n    }\n    if (!equal(prevProps.boxVisible, this.props.boxVisible) && this.props.boxVisible === 'navigation') {\n      this.removeMarkerPopup();\n    }\n    if (!equal(prevProps.result_select, this.props.result_select) || !equal(prevProps.result_navigation, this.props.result_navigation)) {\n      const {\n        result_select,\n        result_navigation,\n        boxVisible,\n        from_place,\n        to_place\n      } = this.props;\n      let dashedLineGeoJSON = [],\n        polylineGeoJSON = [];\n      this.result_navigation = [];\n      if (boxVisible !== 'navigation' && boxVisible !== 'iframe' || !result_navigation) {\n        var _this$popup_navigatio, _this$popup_navigatio2;\n        // Remove cac layer/source\n        if (this.map.getLayer(`route-layer-fastest`)) this.map.removeLayer(`route-layer-fastest`);\n        if (this.map.getLayer(`route-layer-shortest`)) this.map.removeLayer(`route-layer-shortest`);\n        if (this.map.getLayer(`walk-layer-0`)) this.map.removeLayer(`walk-layer-0`);\n        if (this.map.getLayer(`walk-layer-1`)) this.map.removeLayer(`walk-layer-1`);\n        if (this.map.getSource(`route-source-fastest`)) this.map.removeSource(`route-source-fastest`);\n        if (this.map.getSource(`route-source-shortest`)) this.map.removeSource(`route-source-shortest`);\n        if (this.map.getSource(`walk-source-0`)) this.map.removeSource(`walk-source-0`);\n        if (this.map.getSource(`walk-source-1`)) this.map.removeSource(`walk-source-1`);\n        (_this$popup_navigatio = this.popup_navigation[0]) === null || _this$popup_navigatio === void 0 ? void 0 : _this$popup_navigatio.remove();\n        (_this$popup_navigatio2 = this.popup_navigation[1]) === null || _this$popup_navigatio2 === void 0 ? void 0 : _this$popup_navigatio2.remove();\n      } else {\n        if (result_navigation) {\n          let distance = '';\n          if (localStorage.getItem('unit') === 'KILOMETERS') {\n            distance = `${(result_navigation.fastest[0].legs[0].distance.value / 1000).toFixed(1)} KM`;\n          } else if (localStorage.getItem('unit') === 'MILES') {\n            distance = `${(result_navigation.fastest[0].legs[0].distance.value / 1000 * Mile_Travel.MILES).toFixed(1)} Dặm`;\n          } else {\n            distance = `${(result_navigation.fastest[0].legs[0].distance.value / 1000).toFixed(1)} KM`;\n          }\n          let coordinateObject1 = {};\n          coordinateObject1.coordinates = this.decodePolyline(result_navigation.fastest[0].overview_polyline.points);\n          coordinateObject1.type = 'LineString';\n          polylineGeoJSON.push(coordinateObject1);\n          polylineGeoJSON[0].roadWay = 'fastest';\n          let coordinateObject2 = {};\n          coordinateObject2.coordinates = this.decodePolyline(result_navigation.shortest[0].overview_polyline.points);\n          coordinateObject2.type = 'LineString';\n          polylineGeoJSON.push(coordinateObject2);\n          polylineGeoJSON[1].roadWay = 'shortest';\n          dashedLineGeoJSON.push({\n            type: 'LineString',\n            coordinates: [[polylineGeoJSON[0].coordinates[0][0], polylineGeoJSON[0].coordinates[0][1]], [from_place === null || from_place === void 0 ? void 0 : from_place.geometry.location.lng, from_place === null || from_place === void 0 ? void 0 : from_place.geometry.location.lat]]\n          });\n          dashedLineGeoJSON.push({\n            type: 'LineString',\n            coordinates: [[polylineGeoJSON[0].coordinates[polylineGeoJSON[0].coordinates.length - 1][0], polylineGeoJSON[0].coordinates[polylineGeoJSON[0].coordinates.length - 1][1]], [to_place === null || to_place === void 0 ? void 0 : to_place.geometry.location.lng, to_place === null || to_place === void 0 ? void 0 : to_place.geometry.location.lat]]\n          });\n          polylineGeoJSON.map((item, i) => {\n            // Layer dan duong\n            if (this.map.getLayer(`route-layer-${item.roadWay}`)) this.map.removeLayer(`route-layer-${item.roadWay}`);\n            if (this.map.getSource(`route-source-${item.roadWay}`)) this.map.removeSource(`route-source-${item.roadWay}`);\n            this.map.addSource(`route-source-${item.roadWay}`, {\n              type: 'geojson',\n              data: {\n                type: 'Feature',\n                properties: {},\n                geometry: item\n              }\n            });\n            this.map.addLayer({\n              id: `route-layer-${item.roadWay}`,\n              type: 'line',\n              source: `route-source-${item.roadWay}`,\n              layout: {\n                'line-join': 'round',\n                'line-cap': 'round'\n              },\n              paint: {\n                'line-color': 'rgb(24, 144, 255)',\n                'line-width': 7,\n                'line-opacity': item.roadWay === result_select ? 1 : 0.5\n              }\n            });\n            // Layer di bo\n\n            if (this.map.getLayer(`walk-layer-${i}`)) this.map.removeLayer(`walk-layer-${i}`);\n            if (this.map.getSource(`walk-source-${i}`)) this.map.removeSource(`walk-source-${i}`);\n            this.map.addSource(`walk-source-${i}`, {\n              type: 'geojson',\n              data: {\n                type: 'Feature',\n                properties: {},\n                geometry: dashedLineGeoJSON[i]\n              }\n            });\n            this.map.addLayer({\n              id: `walk-layer-${i}`,\n              type: 'line',\n              source: `walk-source-${i}`,\n              layout: {\n                'line-join': 'round',\n                'line-cap': 'round'\n              },\n              paint: {\n                'line-color': 'rgb(133, 135, 126)',\n                'line-opacity': 1,\n                'line-width': 6,\n                'line-dasharray': [0.2, 2]\n              }\n            });\n            // Add Popup hien ket qua\n\n            if (this.popup_navigation[i]) {\n              var _this$popup_navigatio3;\n              (_this$popup_navigatio3 = this.popup_navigation[i]) === null || _this$popup_navigatio3 === void 0 ? void 0 : _this$popup_navigatio3.remove();\n              this.popup_navigation[i] = null;\n            }\n            this.popup_navigation[i] = new maplibregl.Popup({\n              closeButton: false,\n              anchor: 'top',\n              closeOnClick: false,\n              className: item.roadWay === result_select ? 'popup-z-index1' : 'popup-z-index2'\n            }).setLngLat([i === 0 ? item.coordinates[Math.trunc(0.75 * item.coordinates.length)][0] : item.coordinates[Math.trunc(0.25 * item.coordinates.length)][0], i === 0 ? item.coordinates[Math.trunc(item.coordinates.length * 0.75)][1] : item.coordinates[Math.trunc(item.coordinates.length * 0.25)][1]]).setHTML(ReactDOMServer.renderToStaticMarkup(__jsx(\"div\", {\n              className: \"tooltipNavigation\",\n              id: `popup-${item.roadWay}`\n            }, __jsx(\"p\", null, distance), __jsx(\"p\", null, result_navigation[item.roadWay][0].legs[0].duration.text)))).setMaxWidth('300px').addTo(this.map);\n            document.getElementById(`popup-${item.roadWay}`).addEventListener('click', () => {\n              this.props.dispatch(selectResultAction(item.roadWay));\n            });\n            const normalizeBounds = bounds => {\n              const [firstPoint, secondPoint] = bounds;\n              const minLat = Math.min(firstPoint[1], secondPoint[1]);\n              const maxLat = Math.max(firstPoint[1], secondPoint[1]);\n              const minLng = Math.min(firstPoint[0], secondPoint[0]);\n              const maxLng = Math.max(firstPoint[0], secondPoint[0]);\n              return [[minLng, minLat], [maxLng, maxLat]];\n            };\n            const bound = normalizeBounds([item.coordinates[0], item.coordinates[item.coordinates.length - 1]]);\n            if (isMobile) {\n              this.navigationView = this.map.cameraForBounds(bound, {\n                padding: {\n                  top: 10,\n                  bottom: 25,\n                  left: 24,\n                  right: 24\n                }\n              });\n            } else {\n              this.navigationView = this.map.cameraForBounds(bound, {\n                padding: {\n                  top: 40,\n                  bottom: 40,\n                  left: 200,\n                  right: 40\n                }\n              });\n            }\n          });\n          this.view = {\n            latitude: this.navigationView.center.lat,\n            longitude: this.navigationView.center.lng,\n            zoom: this.navigationView.zoom\n          };\n        }\n      }\n      this.props.dispatch(setMapViewportAction(this.view));\n    }\n    if (!equal(prevProps.from_place, this.props.from_place)) {\n      const place = this.props.from_place;\n      if (place) {\n        const popup = new maplibregl.Popup({\n          offset: [0, -18],\n          className: 'tooltip-marker',\n          closeButton: false\n        }).setHTML(`<div class=\"ant-tooltip-inner tooltip-info-location\">${place.name}</div>`).setMaxWidth('150px');\n        if (this.start_marker) {\n          this.start_marker = this.start_marker.setLngLat(place.geometry.location).setPopup(popup).addTo(this.map);\n        } else {\n          const marker_start = document.createElement('div');\n          marker_start.innerHTML = ReactDOMServer.renderToStaticMarkup(__jsx(\"div\", {\n            className: \"marker-start\"\n          }, __jsx(\"img\", {\n            src: images.button,\n            style: {\n              width: 12\n            },\n            alt: \"\"\n          })));\n          this.start_marker = new maplibregl.Marker({\n            anchor: 'center',\n            element: marker_start\n          }).setPopup(popup).setLngLat(place.geometry.location).addTo(this.map);\n          this.start_marker.getElement().addEventListener('contextmenu', e => {\n            e.stopPropagation();\n            e.preventDefault();\n            const lngLat = this.start_marker.getLngLat();\n            this.props.dispatch(setPopupRightClick(true, lngLat, 'popupFromPlace'));\n            this.props.dispatch(setRedMarkerAction(false));\n          });\n          this.start_marker.getElement().addEventListener('click', () => {\n            if (popup.isOpen()) {\n              this.start_marker.togglePopup();\n            }\n          });\n          this.start_marker.getElement().addEventListener('mouseenter', () => this.start_marker.togglePopup());\n          this.start_marker.getElement().addEventListener('mouseleave', () => this.start_marker.togglePopup());\n        }\n      } else {\n        var _prevProps$from_place, _this$state$placeMous;\n        if (equal(this.start_marker.getLngLat(), this.props.position_popup)) {\n          this.props.dispatch(setPopupRightClick(false));\n        }\n        if (equal((_prevProps$from_place = prevProps.from_place) === null || _prevProps$from_place === void 0 ? void 0 : _prevProps$from_place.place_id, (_this$state$placeMous = this.state.placeMouseClick) === null || _this$state$placeMous === void 0 ? void 0 : _this$state$placeMous.place_id)) {\n          this.changeVisibleBottomInfo(false);\n        }\n        this.changeVisibleBottomInfo(false);\n        this.start_marker ? this.start_marker.remove() : null;\n      }\n    }\n    if (!equal(prevProps.to_place, this.props.to_place)) {\n      const place = this.props.to_place;\n      if (place) {\n        const popup = new maplibregl.Popup({\n          offset: [0, -18],\n          className: 'tooltip-marker',\n          closeButton: false\n        }).setHTML(`<div class=\"ant-tooltip-inner tooltip-info-location\">${place.name}</div>`).setMaxWidth('150px');\n        if (this.end_marker) {\n          this.to_place = this.end_marker.setPopup(popup).setLngLat(place.geometry.location).addTo(this.map);\n        } else {\n          const marker_end = document.createElement('div');\n          marker_end.innerHTML = ReactDOMServer.renderToStaticMarkup(__jsx(\"div\", {\n            className: \"marker-end\"\n          }, __jsx(\"div\", null, __jsx(\"img\", {\n            src: images.marker,\n            alt: \"\"\n          }))));\n          this.end_marker = new maplibregl.Marker({\n            anchor: 'center',\n            element: marker_end\n          }).setPopup(popup).setLngLat(place.geometry.location).addTo(this.map);\n          this.end_marker.getElement().addEventListener('contextmenu', e => {\n            e.stopPropagation();\n            e.preventDefault();\n            const lngLat = this.end_marker.getLngLat();\n            this.props.dispatch(setPopupRightClick(true, lngLat, 'popupToPlace'));\n            this.props.dispatch(setRedMarkerAction(false));\n          });\n          this.end_marker.getElement().addEventListener('click', () => {\n            if (popup.isOpen()) {\n              this.end_marker.togglePopup();\n            }\n          });\n          this.end_marker.getElement().addEventListener('mouseenter', () => this.end_marker.togglePopup());\n          this.end_marker.getElement().addEventListener('mouseleave', () => this.end_marker.togglePopup());\n        }\n      } else {\n        var _this$start_marker, _prevProps$to_place, _this$state$placeMous2;\n        if (equal((_this$start_marker = this.start_marker) === null || _this$start_marker === void 0 ? void 0 : _this$start_marker.getLngLat(), this.props.position_popup)) {\n          this.props.dispatch(setPopupRightClick(false));\n        }\n        if (equal((_prevProps$to_place = prevProps.to_place) === null || _prevProps$to_place === void 0 ? void 0 : _prevProps$to_place.place_id, (_this$state$placeMous2 = this.state.placeMouseClick) === null || _this$state$placeMous2 === void 0 ? void 0 : _this$state$placeMous2.place_id)) {\n          this.changeVisibleBottomInfo(false);\n        }\n        this.end_marker ? this.end_marker.remove() : null;\n      }\n    }\n    if (!equal(prevProps.around_places, this.props.around_places) || !equal(prevProps.around_place_select, this.props.around_place_select)) {\n      var _this$list_marker_aro;\n      if (((_this$list_marker_aro = this.list_marker_around) === null || _this$list_marker_aro === void 0 ? void 0 : _this$list_marker_aro.length) > 0) {\n        this.list_marker_around.forEach(item => {\n          item.remove();\n        });\n        this.list_marker_around = [];\n      }\n      const {\n        around_places,\n        around_place_center\n      } = this.props;\n      if (around_places.length > 0) {\n        this.list_marker_around = [];\n        let el = document.createElement('div');\n        el.innerHTML = ReactDOMServer.renderToStaticMarkup(__jsx(Marker, {\n          id: \"marker-center\",\n          type: \"center\"\n        }));\n        this.list_marker_around[0] = new maplibregl.Marker(el, {\n          anchor: 'bottom'\n        }).setPopup(new maplibregl.Popup({\n          offset: [0, -32],\n          className: 'tooltip-marker',\n          closeButton: false\n        }).setHTML(`<div class=\"ant-tooltip-inner tooltip-info-location\">${around_place_center.name}</div>`).setMaxWidth('150px')).setLngLat(around_place_center.geometry.location).addTo(this.map);\n        const markerCenterDiv = this.list_marker_around[0].getElement();\n        markerCenterDiv.addEventListener('click', () => {\n          this._selectAroundPlace('center', around_place_center);\n          this.props.dispatch(setRedMarkerAction(false));\n          if (this.list_marker_around[0].getPopup().isOpen()) {\n            this.list_marker_around[0].togglePopup();\n          }\n        });\n        markerCenterDiv.addEventListener('contextmenu', e => {\n          e.stopPropagation();\n          e.preventDefault();\n          this.props.dispatch(setRedMarkerAction(false));\n          this.props.dispatch(setPopupRightClick(true, around_place_center.geometry.location, 'normal'));\n        });\n        markerCenterDiv.addEventListener('mouseenter', () => this.list_marker_around[0].togglePopup());\n        markerCenterDiv.addEventListener('mouseleave', () => this.list_marker_around[0].togglePopup());\n        around_places.forEach((item, i) => {\n          const popup = new maplibregl.Popup({\n            offset: [0, -32],\n            className: 'tooltip-marker',\n            closeButton: false,\n            anchor: 'bottom'\n          }).setHTML(`<div class=\"ant-tooltip-inner tooltip-info-location\">${item.name}</div>`).setMaxWidth('150px');\n          el = document.createElement('div');\n          el.innerHTML = ReactDOMServer.renderToStaticMarkup(__jsx(Marker, {\n            type: \"around\",\n            place: item,\n            place_select: this.props.around_place_select,\n            id: `marker-around-${i}`\n          }));\n          this.list_marker_around.push(new maplibregl.Marker(el, {\n            anchor: 'bottom'\n          }).setPopup(popup).setLngLat([item.lng_lat[0] * 1, item.lng_lat[1] * 1]).addTo(this.map));\n          const markerDiv = this.list_marker_around[i + 1].getElement();\n          markerDiv.addEventListener('click', e => {\n            e.stopPropagation();\n            this.props.dispatch(setRedMarkerAction(false));\n            this._selectAroundPlace('around', item);\n            if (popup.isOpen()) {\n              this.list_marker_around[i + 1].togglePopup();\n            }\n          });\n          markerDiv.addEventListener('contextmenu', e => {\n            e.stopPropagation();\n            e.preventDefault();\n            this.props.dispatch(setPopupRightClick(true, {\n              lng: item.lng_lat[0] * 1,\n              lat: item.lng_lat[1] * 1\n            }, 'around'));\n            this.props.dispatch(setRedMarkerAction(false));\n          });\n          markerDiv.addEventListener('mouseenter', () => this.list_marker_around[i + 1].togglePopup());\n          markerDiv.addEventListener('mouseleave', () => this.list_marker_around[i + 1].togglePopup());\n        });\n      }\n    }\n    if (this.props.boxVisible === 'info' && this.props.current_place) {\n      if (!this.markerCurrentPlace) {\n        var _this$props$current_p, _this$props$current_p2;\n        const el = document.createElement('div');\n        el.innerHTML = ReactDOMServer.renderToStaticMarkup(\n        // <Marker type=\"normal\" />\n        __jsx(\"div\", {\n          className: \"marker-histories\"\n        }, __jsx(\"div\", null, __jsx(\"img\", {\n          src: images.marker,\n          alt: \"\"\n        }))));\n        // Marker info\n        this.markerCurrentPlace = new maplibregl.Marker({\n          anchor: 'bottom',\n          element: el\n        }).setLngLat((_this$props$current_p = this.props.current_place) === null || _this$props$current_p === void 0 ? void 0 : (_this$props$current_p2 = _this$props$current_p.geometry) === null || _this$props$current_p2 === void 0 ? void 0 : _this$props$current_p2.location).addTo(this.map);\n        this.markerCurrentPlace.getElement().addEventListener('contextmenu', e => {\n          e.stopPropagation();\n          e.preventDefault();\n          const lngLat = this.markerCurrentPlace.getLngLat();\n          this.props.dispatch(setPopupRightClick(true, lngLat, 'popupCurrentPlace'));\n        });\n      } else {\n        this.markerCurrentPlace.setLngLat(this.props.current_place.geometry.location).addTo(this.map);\n      }\n    }\n    if (this.props.boxVisible !== 'info' && this.markerCurrentPlace) {\n      this.markerCurrentPlace.remove();\n      this.markerCurrentPlace = null;\n    }\n    if (this.props.boxVisible === 'detailsrestaurant' && this.props.restaurantData) {\n      if (this.props.restaurantData.length !== 0) {\n        for (let item of this.props.restaurantData) {\n          const marker_restaurant = document.createElement('div');\n          marker_restaurant.innerHTML = ReactDOMServer.renderToStaticMarkup(\n          // <MarkerNavigation id=\"end-marker\" type=\"histories\" />\n          __jsx(\"div\", {\n            className: \"marker-histories\"\n          }, __jsx(\"div\", null, __jsx(\"img\", {\n            src: images.marker,\n            alt: \"\"\n          }))));\n          this.restaurant_marker = new maplibregl.Marker({\n            anchor: 'center',\n            element: marker_restaurant\n          })\n          // .setPopup(popup)\n          .setLngLat(item.geometry.location).addTo(this.map);\n          this.listRestaurant.push(this.restaurant_marker);\n        }\n      } else {\n        // console.log('Có')\n        for (let marker of this.listRestaurant) {\n          marker.remove();\n        }\n        this.listRestaurant = [];\n      }\n    }\n    if (this.props.boxVisible === 'history') {\n      for (let marker of this.listHistories) {\n        marker.remove();\n      }\n      for (let item of this.props.searchLocalStorage) {\n        const marker_history = document.createElement('div');\n        marker_history.innerHTML = ReactDOMServer.renderToStaticMarkup(__jsx(\"div\", {\n          className: \"marker-histories\"\n        }, __jsx(\"div\", null, __jsx(\"img\", {\n          src: images.marker,\n          alt: \"\"\n        }))));\n        this.history_marker = new maplibregl.Marker({\n          anchor: 'center',\n          element: marker_history\n        }).setLngLat(item.location).addTo(this.map);\n        this.listHistories.push(this.history_marker);\n      }\n    } else {\n      for (let marker of this.listHistories) {\n        marker.remove();\n      }\n    }\n\n    // if (this.props.boxVisible === \"details\") {\n    if (this.props.result_navigation && this.props.boxVisible === 'details') {\n      for (let step of this.props.result_navigation.fastest[0].legs[0].steps) {\n        const popup = new maplibregl.Popup({\n          offset: [0, -32],\n          className: 'tooltip-marker',\n          closeButton: false,\n          anchor: 'bottom'\n        }).setHTML(`<div class=\"ant-tooltip-inner tooltip-info-location\">${step.html_instructions}</div>`).setMaxWidth('150px');\n        const marker_step = document.createElement('div');\n        marker_step.innerHTML = ReactDOMServer.renderToStaticMarkup(__jsx(\"div\", {\n          className: \"marker-details\"\n        }));\n        this.step_marker = new maplibregl.Marker({\n          anchor: 'center',\n          element: marker_step\n        }).setPopup(popup).setLngLat(step.end_location).addTo(this.map);\n        this.list.push(this.step_marker);\n      }\n    } else {\n      for (let marker of this.list) {\n        marker.remove();\n      }\n      this.list = [];\n    }\n    // }\n    if (this.props.boxVisible === 'navigation' && isMobile) {\n      if (this.props.result_navigation) {\n        for (let step of this.props.result_navigation.fastest[0].legs[0].steps) {\n          const popup = new maplibregl.Popup({\n            offset: [0, -32],\n            className: 'tooltip-marker',\n            closeButton: false,\n            anchor: 'bottom'\n          }).setHTML(`<div class=\"ant-tooltip-inner tooltip-info-location\">${step.html_instructions}</div>`).setMaxWidth('150px');\n          const marker_step = document.createElement('div');\n          marker_step.innerHTML = ReactDOMServer.renderToStaticMarkup(__jsx(\"div\", {\n            className: \"marker-details\"\n          }));\n          this.step_marker = new maplibregl.Marker({\n            anchor: 'center',\n            element: marker_step\n          }).setPopup(popup).setLngLat(step.end_location).addTo(this.map);\n          this.list.push(this.step_marker);\n        }\n      } else {\n        for (let marker of this.list) {\n          marker.remove();\n        }\n        this.list = [];\n      }\n    }\n  }\n  decodePolyline(encoded) {\n    var points = [];\n    var index = 0,\n      len = encoded.length;\n    var lat = 0,\n      lng = 0;\n    while (index < len) {\n      var b,\n        shift = 0,\n        result = 0;\n      do {\n        b = encoded.charAt(index++).charCodeAt(0) - 63;\n        result |= (b & 0x1f) << shift;\n        shift += 5;\n      } while (b >= 0x20);\n      var dlat = result & 1 ? ~(result >> 1) : result >> 1;\n      lat += dlat;\n      shift = 0;\n      result = 0;\n      do {\n        b = encoded.charAt(index++).charCodeAt(0) - 63;\n        result |= (b & 0x1f) << shift;\n        shift += 5;\n      } while (b >= 0x20);\n      var dlng = result & 1 ? ~(result >> 1) : result >> 1;\n      lng += dlng;\n      points.push([lng * 1e-5, lat * 1e-5]);\n    }\n    return points;\n  }\n  componentDidMount() {\n    window.addEventListener('storage', this.handleStorageChange);\n    // console.log(STYLE_URL.NORMAL)\n    const selectedPlace = this.props.current_place;\n    this.map = new maplibregl.Map({\n      container: 'map',\n      // container id\n      style: STYLE_URL.NORMAL + \"YJTajS80fLlhJ4a2BG0gXqXXdZzdLG5V3iivOK9e\",\n      center: selectedPlace ? [selectedPlace.geometry.location.lng, selectedPlace.geometry.location.lat] : [105.801982, 21.026745],\n      // starting position [lng, lat]\n      zoom: 12 // starting zoom\n    });\n    if (selectedPlace) this.props.dispatch(setRedMarkerAction(true, selectedPlace.geometry.location));\n    this.navigation = new maplibregl.NavigationControl();\n    this.geolocateControl = new maplibregl.GeolocateControl({\n      positionOptions: {\n        enableHighAccuracy: true\n      },\n      // Bật tắt hiển bị vị trí\n      trackUserLocation: true,\n      // Hiển thị\n      showUserLocation: true,\n      // Tắt vòng tròn to\n      showAccuracyCircle: false,\n      // Điều chỉnh mức zoom đến vị trí của mình\n      fitBoundsOptions: {\n        maxZoom: 15\n      }\n    });\n    this.geolocateControl.on('error', () => {\n      _message.warning('Goong không thể lấy địa điểm hiện tại của bạn !');\n    });\n    this.geolocateControl.on('geolocate', e => {\n      this.props.dispatch(setMyLocationAction({\n        latitude: e.coords.latitude,\n        longitude: e.coords.longitude\n      }));\n    });\n    !isMobile && this.map.addControl(this.navigation);\n    !isMobile && this.map.addControl(this.geolocateControl);\n    this.map.on('click', this._onMouseClick);\n    this.map.on('contextmenu', this._onRightClick);\n    this.map.on('load', () => {\n      var _URLSearchParams$get, _this$geolocateContro;\n      this.map.resize();\n      const pid = new URLSearchParams(window.location.search).get('pid');\n      const location = (_URLSearchParams$get = new URLSearchParams(window.location.search).get('location')) === null || _URLSearchParams$get === void 0 ? void 0 : _URLSearchParams$get.split(',');\n      const pid_around = new URLSearchParams(window.location.search).get('pid_around');\n      const direction_infor = new URLSearchParams(window.location.search).get('direction');\n      if (!direction_infor && !pid && !location && !pid_around && !this.props.current_place) (_this$geolocateContro = this.geolocateControl) === null || _this$geolocateContro === void 0 ? void 0 : _this$geolocateContro.trigger();else {\n        if (navigator.geolocation) {\n          navigator.geolocation.getCurrentPosition(position => {\n            this.props.dispatch(setMyLocationAction({\n              latitude: position.coords.latitude,\n              longitude: position.coords.longitude\n            }));\n          });\n        }\n      }\n    });\n    this.map.on('move', () => {\n      this.props.dispatch(setCenterLatLngAction({\n        latitude: this.map.getCenter().lat,\n        longitude: this.map.getCenter().lng\n      }));\n    });\n    this.map.on('style.load', () => {\n      var _this$map;\n      (_this$map = this.map) === null || _this$map === void 0 ? void 0 : _this$map.addLayer({\n        id: '3d-buildings',\n        source: 'composite',\n        'source-layer': 'VN_Building',\n        filter: ['==', 'extrude', 'true'],\n        type: 'fill-extrusion',\n        minzoom: 15,\n        paint: {\n          'fill-extrusion-color': '#aaa',\n          'fill-extrusion-height': {\n            type: 'identity',\n            property: 'height'\n          },\n          'fill-extrusion-base': {\n            type: 'identity',\n            property: 'min_height'\n          },\n          'fill-extrusion-opacity': 0.4\n        }\n      });\n      if (this.props.result_navigation) {\n        if (this.props.result_select === 'fastest') {\n          this.props.dispatch(selectResultAction('shortest'));\n          this.props.dispatch(selectResultAction('fastest'));\n        } else {\n          this.props.dispatch(selectResultAction('fastest'));\n          this.props.dispatch(selectResultAction('shortest'));\n        }\n      }\n    });\n    document.body.addEventListener('click', this._onClickMenu);\n    // this.map.on('click', 'route-layer-fastest', (e) => {\n    //   console.log(e, 'fastest');\n    //   e.originalEvent.stopPropagation();\n    //   e.originalEvent.preventDefault();\n    // });\n\n    // this.map.on('click', 'route-layer-shortest', (e) => {\n    //   console.log(e)\n    // });\n\n    const direction_infor = new URLSearchParams(window.location.search).get('direction');\n    const iframe = new URLSearchParams(window.location.search).get('iframe');\n    if (direction_infor) {\n      const coor_from = {\n        lat: direction_infor.split('&')[0].split(',')[0],\n        lng: direction_infor.split('&')[0].split(',')[1]\n      };\n      const coor_to = {\n        lat: direction_infor.split('&')[1].split(',')[0],\n        lng: direction_infor.split('&')[1].split(',')[1]\n      };\n      if (coor_from.lat && coor_from.lng && coor_to.lat && coor_to.lng) {\n        // this.handleFromHere(coor_from.lat, coor_from.lng);\n        // this.handleToHere(coor_to.lat, coor_to.lng);\n        if (iframe != null) {\n          this.navigationByURLIframe(coor_from, coor_to);\n        } else {\n          this.navigationByURL(coor_from, coor_to);\n        }\n      }\n    }\n\n    // Fetch parking lots\n    this.props.dispatch(getParkingLotsRequest());\n  }\n  componentWillUnmount() {\n    window.removeEventListener('storage', this.handleStorageChange);\n    document.body.removeEventListener('click', this._onClickMenu);\n  }\n  render() {\n    var _placeMouseClick$geom, _placeMouseClick$geom2;\n    const {\n      style,\n      bottomInfoVisible,\n      placeMouseClick\n    } = this.state;\n    return __jsx(React.Fragment, null, __jsx(Div100vh, null, __jsx(\"div\", {\n      id: \"map\",\n      className: \"jsx-1397137027\"\n    }, this.renderParkingLots()), __jsx(\"div\", {\n      className: \"jsx-1397137027\"\n    }, !isMobile && __jsx(_Avatar, {\n      shape: \"square\",\n      size: 64,\n      onClick: this.changeStyle,\n      className: \"change-status-button\",\n      style: {\n        backgroundImage: style === STYLE_URL.NORMAL + \"YJTajS80fLlhJ4a2BG0gXqXXdZzdLG5V3iivOK9e\" ? `url(${satellite_img})` : `url(${normal_map_img})`\n      }\n    }), isMobile && __jsx(_Avatar, {\n      shape: \"square\",\n      size: 64,\n      onClick: this.changeStyle,\n      className: \"change-status-button\"\n      // id='change-status-button--mobile'\n      ,\n      style: {\n        backgroundImage: style === STYLE_URL.NORMAL + \"YJTajS80fLlhJ4a2BG0gXqXXdZzdLG5V3iivOK9e\" ? `url(${satellite_img})` : `url(${normal_map_img})`\n      }\n    })), bottomInfoVisible && __jsx(BottomInfoLocation, {\n      changeVisibleBottomInfo: this.changeVisibleBottomInfo,\n      lat: ((_placeMouseClick$geom = placeMouseClick.geometry) === null || _placeMouseClick$geom === void 0 ? void 0 : _placeMouseClick$geom.location.lat) || Number(placeMouseClick.lng_lat[1]),\n      lng: ((_placeMouseClick$geom2 = placeMouseClick.geometry) === null || _placeMouseClick$geom2 === void 0 ? void 0 : _placeMouseClick$geom2.location.lng) || Number(placeMouseClick.lng_lat[0]),\n      name: placeMouseClick.name || placeMouseClick.address_components[0].long_name,\n      isMarkerAround: placeMouseClick.marker_type_id,\n      place_id: placeMouseClick._id,\n      address: this.getAddressGeocode(placeMouseClick) || placeMouseClick.formatted_address || placeMouseClick.description.address,\n      removeMarker: this.removeMarkerWhatIs\n    })), __jsx(_JSXStyle, {\n      id: \"1397137027\"\n    }, \".parking-marker.jsx-1397137027{background-color:#fff;border-radius:50%;cursor:pointer;padding:0;}.marker-content.jsx-1397137027{background:#1890ff;color:white;border-radius:50%;width:32px;height:32px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;font-weight:bold;}.marker-info.jsx-1397137027{display:none;position:absolute;bottom:100%;left:50%;-webkit-transform:translateX(-50%);-ms-transform:translateX(-50%);transform:translateX(-50%);background:white;padding:8px;border-radius:4px;box-shadow:0 2px 6px rgba(0,0,0,0.1);min-width:200px;z-index:1;}.parking-marker.jsx-1397137027:hover .marker-info.jsx-1397137027{display:block;}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkQ6XFxXb3JraG9tZVxcUGFya2luZ0xvdFxcbGl2ZS1tYXBcXGNvbXBvbmVudHNcXE1hcC5qc3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBcTBDZ0IsQUFHNkIsQUFPSCxBQVlOLEFBY0MsYUFiSSxDQWNuQixLQTFCYSxHQVBNLFNBUUEsQUFZTixTQW5CRyxHQW9CTixNQVpFLEdBYWdCLEdBcEJqQixLQVFFLEtBUGIsT0FRYyx5RUFZSSxDQVhFLGdCQVlQLFlBQ00sa0JBQ21CLHFDQUNyQixVQWRPLE1BZWIsVUFDWCxtRkFma0IsaUJBQ2xCIiwiZmlsZSI6IkQ6XFxXb3JraG9tZVxcUGFya2luZ0xvdFxcbGl2ZS1tYXBcXGNvbXBvbmVudHNcXE1hcC5qc3giLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgQ29tcG9uZW50LCB1c2VFZmZlY3QgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgeyBTVFlMRV9VUkwgfSBmcm9tICcuLi9jb25zdHMnO1xuaW1wb3J0IE1hcmtlciBmcm9tICcuL01hcmtlcic7XG5pbXBvcnQgeyBjb25uZWN0IH0gZnJvbSAncmVhY3QtcmVkdXgnO1xuaW1wb3J0IEJvdHRvbUluZm9Mb2NhdGlvbiBmcm9tICcuL0JvdHRvbUluZm9Mb2NhdGlvbic7XG5pbXBvcnQgTWVudVJpZ2h0Q2xpY2sgZnJvbSAnLi9NZW51UmlnaHRDTGljayc7XG5pbXBvcnQgeyBnZXREZXRhaWxMYXRMbmdTZXJ2aWNlIH0gZnJvbSAnLi4vcmVkdXgvc2FnYXMvcGxhY2VTYWdhJztcbmltcG9ydCB7IG1lc3NhZ2UsIEF2YXRhciB9IGZyb20gJ2FudGQnO1xuaW1wb3J0IGVxdWFsIGZyb20gJ2Zhc3QtZGVlcC1lcXVhbC9lczYvcmVhY3QnO1xuaW1wb3J0IHsgc2V0TWFwVmlld3BvcnRBY3Rpb24sIGdldERldGFpbEJ5TGF0TG5nQWN0aW9uLCBzZXRDZW50ZXJMYXRMbmdBY3Rpb24sIHNldE15TG9jYXRpb25BY3Rpb24sIGdldERldGFpbEJ5SWRBY3Rpb24gfSBmcm9tICcuLi9yZWR1eC9hY3Rpb25zL3BsYWNlJztcbmltcG9ydCB7IHNlYXJjaEFyb3VuZEFjdGlvbiwgY2xlYXJTZWFyY2hBcm91bmRBY3Rpb24sIHNlbGVjdEFyb3VuZFBsYWNlQWN0aW9uIH0gZnJvbSAnLi4vcmVkdXgvYWN0aW9ucy9zZWFyY2gnO1xuaW1wb3J0IHsgc2VsZWN0UmVzdWx0QWN0aW9uLCBuYXZpZ2F0aW9uRnJvbUFjdGlvbiwgbmF2aWdhdGlvblRvQWN0aW9uLCBjbGVhclJlc3VsdEFjdGlvbiwgbmF2aWdhdGlvbkFjdGlvbiB9IGZyb20gJy4uL3JlZHV4L2FjdGlvbnMvbmF2aWdhdGlvbic7XG5pbXBvcnQgTWFya2VyTmF2aWdhdGlvbiBmcm9tICcuL01hcmtlck5hdmlnYXRpb24nO1xuaW1wb3J0IHsgc2V0UmVkTWFya2VyQWN0aW9uLCBzZXRDb2xsYXBzZWRJbmZvQm94QWN0aW9uLCBzZXRQb3B1cFJpZ2h0Q2xpY2ssIHNldEJveFZpc2libGVBY3Rpb24gfSBmcm9tICcuLi9yZWR1eC9hY3Rpb25zL2JveFZpc2JsZSc7XG5pbXBvcnQgbm9ybWFsX21hcF9pbWcgZnJvbSAnLi4vc3RhdGljL2ltYWdlcy9ub3JtYWxfbWFwLnBuZyc7XG5pbXBvcnQgc2F0ZWxsaXRlX2ltZyBmcm9tICcuLi9zdGF0aWMvaW1hZ2VzL3NhdGVsbGl0ZS5qcGVnJztcbmltcG9ydCBSZWFjdERPTVNlcnZlciBmcm9tICdyZWFjdC1kb20vc2VydmVyJztcbmltcG9ydCBBeGlvcyBmcm9tICdheGlvcyc7XG5pbXBvcnQgRGl2MTAwdmggZnJvbSAncmVhY3QtZGl2LTEwMHZoJztcbmltcG9ydCBSZXF1ZXN0IGZyb20gJy4uL3V0aWxzL3JlcXVlc3QnO1xuaW1wb3J0IHsgTWlsZV9UcmF2ZWwgfSBmcm9tICcuLi9jb25zdHMnO1xuaW1wb3J0IHsgaXNNb2JpbGUgfSBmcm9tICdyZWFjdC1kZXZpY2UtZGV0ZWN0JztcbmltcG9ydCBpbWFnZXMgZnJvbSAnLi4vdXRpbHMvaW1hZ2VzJztcbmltcG9ydCB7IHVzZURpc3BhdGNoLCB1c2VTZWxlY3RvciB9IGZyb20gJ3JlYWN0LXJlZHV4JztcbmltcG9ydCB7IGdldFBhcmtpbmdMb3RzUmVxdWVzdCB9IGZyb20gJy4uL3JlZHV4L2FjdGlvbnMvcGFya2luZ0xvdCc7XG5cbmNsYXNzIE1hcCBleHRlbmRzIENvbXBvbmVudCB7XG5cdGNvbnN0cnVjdG9yKHByb3BzKSB7XG5cdFx0c3VwZXIocHJvcHMpO1xuXHRcdHRoaXMuX21hcFJlZiA9IFJlYWN0LmNyZWF0ZVJlZigpO1xuXHRcdHRoaXMubWFwID0gbnVsbDtcblx0XHR0aGlzLnJlZE1hcmtlciA9IG51bGw7XG5cdFx0dGhpcy5wb3B1cFJpZ2h0Q2xpY2sgPSBudWxsO1xuXHRcdHRoaXMucG9wdXBfbmF2aWdhdGlvbiA9IFtdO1xuXHRcdHRoaXMuc3RhdGUgPSB7XG5cdFx0XHRzdHlsZTogU1RZTEVfVVJMLk5PUk1BTCArIFNUWUxFX0tFWSxcblx0XHRcdHN0eWxlTm9ybWFsOiBTVFlMRV9VUkwuTk9STUFMICsgU1RZTEVfS0VZLFxuXHRcdFx0c3R5bGVFYXJ0aDogU1RZTEVfVVJMLlNBVEVMSVRFICsgU1RZTEVfS0VZLFxuXHRcdFx0Ym90dG9tSW5mb1Zpc2libGU6IGZhbHNlLFxuXHRcdFx0dmFsdWU6IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdzZWFyY2hfaGlzdG9yeScpIHx8ICcnLFxuXHRcdFx0cGFya2luZ0xvdHM6IFtdLFxuXHRcdH07XG5cdFx0dGhpcy5saXN0ID0gW107XG5cdFx0dGhpcy5saXN0UmVzdGF1cmFudCA9IFtdO1xuXHRcdHRoaXMubGlzdEhpc3RvcmllcyA9IFtdO1xuXHRcdHRoaXMudmlldyA9IG51bGw7XG5cdFx0dGhpcy5uYXZpZ2F0aW9uVmlldyA9IG51bGw7XG5cdH1cblxuXHRfb25WaWV3cG9ydENoYW5nZSA9ICh2aWV3cG9ydCkgPT4ge1xuXHRcdHRoaXMucHJvcHMuZGlzcGF0Y2goc2V0TWFwVmlld3BvcnRBY3Rpb24odmlld3BvcnQpKTtcblx0fTtcblxuXHRfb25Nb3VzZUNsaWNrID0gKGUpID0+IHtcblx0XHR0aGlzLnByb3BzLmRpc3BhdGNoKHNldFBvcHVwUmlnaHRDbGljayhmYWxzZSkpO1xuXHRcdGlmICh0aGlzLnByb3BzLmJveFZpc2libGUgIT09ICdpZnJhbWUnKSB7XG5cdFx0XHR0aGlzLnByb3BzLmRpc3BhdGNoKHNldFJlZE1hcmtlckFjdGlvbihmYWxzZSkpO1xuXHRcdH1cblx0XHQvLyBpZiAodGhpcy5wcm9wcy5ib3hWaXNpYmxlID09PSBcImluZm9cIikgdGhpcy5wcm9wcy5kaXNwYXRjaChzZXRCb3hWaXNpYmxlQWN0aW9uKCdzZWFyY2gnKSlcblx0XHQvLyB0aGlzLm1hcmtlcldoYXRJcyA/IHRoaXMubWFya2VyV2hhdElzLnJlbW92ZSgpIDogbnVsbDtcblx0XHR0aGlzLnByb3BzLmRpc3BhdGNoKHNlbGVjdEFyb3VuZFBsYWNlQWN0aW9uKG51bGwpKTtcblx0XHR0aGlzLnJlbW92ZU1hcmtlcldoYXRJcygpO1xuXHRcdHRoaXMuc2V0U3RhdGUoe1xuXHRcdFx0Ym90dG9tSW5mb1Zpc2libGU6IGZhbHNlLFxuXHRcdH0pO1xuXHR9O1xuXG5cdF9vblJpZ2h0Q2xpY2sgPSAoZSkgPT4ge1xuXHRcdGNvbnN0IHBvc2l0aW9uID0geyBsYXQ6IGUubG5nTGF0LmxhdCwgbG5nOiBlLmxuZ0xhdC5sbmcgfTtcblx0XHRpZiAodGhpcy5wcm9wcy5ib3hWaXNpYmxlICE9PSAnaWZyYW1lJykge1xuXHRcdFx0dGhpcy5wcm9wcy5kaXNwYXRjaChzZXRSZWRNYXJrZXJBY3Rpb24odHJ1ZSwgcG9zaXRpb24pKTtcblx0XHRcdHRoaXMucHJvcHMuZGlzcGF0Y2goc2V0UG9wdXBSaWdodENsaWNrKHRydWUsIHBvc2l0aW9uLCAnbm9ybWFsJykpO1xuXHRcdH1cblx0fTtcblxuXHRfb25DbGlja01lbnUgPSAoZXZ0KSA9PiB7XG5cdFx0Y29uc3QgcGFyZW50ID0gZXZ0LnRhcmdldC5wYXJlbnRFbGVtZW50O1xuXG5cdFx0aWYgKGV2dC50YXJnZXQuY2xhc3NOYW1lICYmIGV2dC50YXJnZXQuY2xhc3NOYW1lLnRvU3RyaW5nKCkuaW5jbHVkZXMoJ3doYXQtaXMtdGhpcycpKSB7XG5cdFx0XHR0aGlzLmhhbmRsZVdoYXRJcygpO1xuXHRcdH0gZWxzZSBpZiAoZXZ0LnRhcmdldC5jbGFzc05hbWUgJiYgZXZ0LnRhcmdldC5jbGFzc05hbWUudG9TdHJpbmcoKS5pbmNsdWRlcygnZnJvbS1oZXJlJykpIHtcblx0XHRcdHRoaXMuaGFuZGxlRnJvbUhlcmUoKTtcblx0XHR9IGVsc2UgaWYgKGV2dC50YXJnZXQuY2xhc3NOYW1lICYmIGV2dC50YXJnZXQuY2xhc3NOYW1lLnRvU3RyaW5nKCkuaW5jbHVkZXMoJ3RvLWhlcmUnKSkge1xuXHRcdFx0dGhpcy5oYW5kbGVUb0hlcmUoKTtcblx0XHR9IGVsc2UgaWYgKGV2dC50YXJnZXQuY2xhc3NOYW1lICYmIGV2dC50YXJnZXQuY2xhc3NOYW1lLnRvU3RyaW5nKCkuaW5jbHVkZXMoJ2RlbGV0ZS1sb2NhdGlvbicpKSB7XG5cdFx0XHR0aGlzLmhhbmRsZURlbGV0ZUxvY2F0aW9uKCk7XG5cdFx0fSBlbHNlIGlmIChldnQudGFyZ2V0LmNsYXNzTmFtZSAmJiBldnQudGFyZ2V0LmNsYXNzTmFtZS50b1N0cmluZygpLmluY2x1ZGVzKCdzZWFyY2gtYXJvdW5kJykpIHtcblx0XHRcdHRoaXMuaGFuZGxlU2VhcmNoQXJvdW5kKCk7XG5cdFx0fSBlbHNlIGlmIChldnQudGFyZ2V0LmNsYXNzTmFtZSAmJiBldnQudGFyZ2V0LmNsYXNzTmFtZS50b1N0cmluZygpLmluY2x1ZGVzKCd0by1hcm91bmQtcGxhY2UnKSkge1xuXHRcdFx0dGhpcy5oYW5kbGVUb0Fyb3VuZFBsYWNlKCk7XG5cdFx0fSBlbHNlIGlmIChldnQudGFyZ2V0LmNsYXNzTmFtZSAmJiBldnQudGFyZ2V0LmNsYXNzTmFtZS50b1N0cmluZygpLmluY2x1ZGVzKCd3aGF0LWlzLW5hdmlnYXRpb24nKSkge1xuXHRcdFx0dGhpcy5oYW5kbGVXaGF0SXMoZmFsc2UpO1xuXHRcdH1cblx0XHRpZiAocGFyZW50Py5jbGFzc05hbWUgJiYgcGFyZW50Py5jbGFzc05hbWUudG9TdHJpbmcoKS5pbmNsdWRlcygnbWVudS1yaWdodC1jbGljaycpKSB7XG5cdFx0XHRpZiAoZXZ0LnRhcmdldC5jbGFzc05hbWUgJiYgIWV2dC50YXJnZXQuY2xhc3NOYW1lLnRvU3RyaW5nKCkuaW5jbHVkZXMoJ3doYXQtaXMtdGhpcycpKSB7XG5cdFx0XHRcdHRoaXMucHJvcHMuZGlzcGF0Y2goY2xlYXJTZWFyY2hBcm91bmRBY3Rpb24oKSk7XG5cdFx0XHR9XG5cdFx0XHR0aGlzLnByb3BzLmRpc3BhdGNoKHNldFBvcHVwUmlnaHRDbGljayhmYWxzZSkpO1xuXHRcdFx0dGhpcy5yZW1vdmVNYXJrZXJXaGF0SXMoKTtcblx0XHR9XG5cdH07XG5cblx0Y2hhbmdlVmlzaWJsZUJvdHRvbUluZm8gPSAodmlzaWJsZSkgPT4ge1xuXHRcdHRoaXMuc2V0U3RhdGUoe1xuXHRcdFx0Ym90dG9tSW5mb1Zpc2libGU6IHZpc2libGUsXG5cdFx0fSk7XG5cdH07XG5cblx0X2dldEluZm9yUGxhY2UgPSBhc3luYyAobGF0ID0gdGhpcy5wcm9wcy5wb3NpdGlvbl9wb3B1cD8ubGF0LCBsbmcgPSB0aGlzLnByb3BzLnBvc2l0aW9uX3BvcHVwPy5sbmcpID0+IHtcblx0XHRjb25zdCBsYXRMbmcgPSB7XG5cdFx0XHRsYXRpdHVkZTogbGF0LFxuXHRcdFx0bG9uZ2l0dWRlOiBsbmcsXG5cdFx0fTtcblxuXHRcdHRyeSB7XG5cdFx0XHRjb25zdCByZXNwb25zZSA9IGF3YWl0IGdldERldGFpbExhdExuZ1NlcnZpY2UobGF0TG5nKTtcblx0XHRcdGlmIChyZXNwb25zZS5kYXRhLnJlc3VsdHMubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRjb25zdCBwbGFjZV9yZXNwb25zZSA9IHJlc3BvbnNlLmRhdGEucmVzdWx0c1swXTtcblx0XHRcdFx0cmV0dXJuIHtcblx0XHRcdFx0XHQuLi5wbGFjZV9yZXNwb25zZSxcblx0XHRcdFx0XHRuYW1lOiBwbGFjZV9yZXNwb25zZS5hZGRyZXNzX2NvbXBvbmVudHNbMF0ubG9uZ19uYW1lLFxuXHRcdFx0XHRcdGZvcm1hdHRlZF9hZGRyZXNzOiB0aGlzLmdldEFkZHJlc3NHZW9jb2RlKHBsYWNlX3Jlc3BvbnNlKSxcblx0XHRcdFx0fTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdG1lc3NhZ2UuZXJyb3IoJ0tow7RuZyB0w6xtIHRo4bqleSDEkeG7i2EgxJFp4buDbSAhIScpO1xuXHRcdFx0XHRyZXR1cm4gbnVsbDtcblx0XHRcdH1cblx0XHR9IGNhdGNoIChlcnJvcikge1xuXHRcdFx0dGhyb3cgZXJyb3I7XG5cdFx0fVxuXHR9O1xuXG5cdHNlbGVjdFBsYWNlID0gYXN5bmMgKGxhdCA9IHRoaXMucHJvcHMucG9zaXRpb25NYXJrZXJTZWxlY3Q/LmxhdCwgbG5nID0gdGhpcy5wcm9wcy5wb3NpdGlvbk1hcmtlclNlbGVjdD8ubG5nLCByZWRNYXJrZXJWaXNpYmxlID0gdHJ1ZSkgPT4ge1xuXHRcdGNvbnN0IHBsYWNlID0gYXdhaXQgdGhpcy5fZ2V0SW5mb3JQbGFjZShsYXQsIGxuZyk7XG5cblx0XHRpZiAocGxhY2UpIHtcblx0XHRcdGNvbnN0IHZpZXdwb3J0ID0ge1xuXHRcdFx0XHRsb25naXR1ZGU6IGxuZyxcblx0XHRcdFx0bGF0aXR1ZGU6IGxhdCxcblx0XHRcdFx0em9vbTogMTUsXG5cdFx0XHR9O1xuXHRcdFx0dGhpcy5wcm9wcy5kaXNwYXRjaChzZXRNYXBWaWV3cG9ydEFjdGlvbih2aWV3cG9ydCkpO1xuXHRcdFx0dGhpcy5zZXRTdGF0ZSh7XG5cdFx0XHRcdGJvdHRvbUluZm9WaXNpYmxlOiB0cnVlLFxuXHRcdFx0XHRwbGFjZU1vdXNlQ2xpY2s6IHBsYWNlLFxuXHRcdFx0fSk7XG5cdFx0XHRpZiAocmVkTWFya2VyVmlzaWJsZSkge1xuXHRcdFx0XHRpZiAodGhpcy5tYXJrZXJXaGF0SXMpIHtcblx0XHRcdFx0XHR0aGlzLm1hcmtlcldoYXRJcy5zZXRMbmdMYXQoeyBsYXQsIGxuZyB9KS5hZGRUbyh0aGlzLm1hcCk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29uc3QgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblx0XHRcdFx0XHRlbC5pbm5lckhUTUwgPSBSZWFjdERPTVNlcnZlci5yZW5kZXJUb1N0YXRpY01hcmt1cCg8TWFya2VyIHNpemU9ezIyfSAvPik7XG5cdFx0XHRcdFx0dGhpcy5tYXJrZXJXaGF0SXMgPSBuZXcgbWFwbGlicmVnbC5NYXJrZXIoZWwsIHsgYW5jaG9yOiAnYm90dG9tJyB9KS5zZXRMbmdMYXQoeyBsYXQsIGxuZyB9KS5hZGRUbyh0aGlzLm1hcCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0dGhpcy5tYXJrZXJXaGF0SXMuZ2V0RWxlbWVudCgpLmFkZEV2ZW50TGlzdGVuZXIoJ2NvbnRleHRtZW51JywgKGUpID0+IHtcblx0XHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHR0aGlzLnByb3BzLmRpc3BhdGNoKHNldFJlZE1hcmtlckFjdGlvbihmYWxzZSkpO1xuXHRcdFx0XHRcdHRoaXMucHJvcHMuZGlzcGF0Y2goc2V0UG9wdXBSaWdodENsaWNrKHRydWUsIHsgbGF0LCBsbmcgfSwgJ3BvcHVwQ3VycmVudFBsYWNlJykpO1xuXHRcdFx0XHR9KTtcblx0XHRcdFx0dGhpcy5wcm9wcy5kaXNwYXRjaChzZXRSZWRNYXJrZXJBY3Rpb24oZmFsc2UpKTtcblx0XHRcdH1cblx0XHRcdC8vIHJlZE1hcmtlclZpc2libGUgPyB0aGlzLnByb3BzLmRpc3BhdGNoKHNldFJlZE1hcmtlckFjdGlvbih0cnVlLCB7IGxhdCwgbG5nIH0pKSA6IG51bGw7XG5cdFx0fSBlbHNlIHtcblx0XHRcdG1lc3NhZ2UuZXJyb3IoJ0tow7RuZyB0w6xtIHRo4bqleSDEkeG7i2EgxJFp4buDbSAhIScpO1xuXHRcdH1cblx0fTtcblxuXHRyZW1vdmVNYXJrZXJXaGF0SXMgPSAoKSA9PiB7XG5cdFx0dGhpcy5tYXJrZXJXaGF0SXMgPyB0aGlzLm1hcmtlcldoYXRJcy5yZW1vdmUoKSA6IG51bGw7XG5cdH07XG5cblx0X2dldEluZm9yUGxhY2VBcm91bmQgPSBhc3luYyAoaWQpID0+IHtcblx0XHR0cnkge1xuXHRcdFx0Y29uc3QgcmVzcG9uc2UgPSBhd2FpdCBBeGlvcy5nZXQoYGh0dHBzOi8vbmFwaS5nb29uZy5pby92MS9tYXJrZXIvZ2V0X21hcmtlcl9kZXRhaWwvJHtpZH1gKTtcblxuXHRcdFx0aWYgKHJlc3BvbnNlLmRhdGEuZGF0YSkge1xuXHRcdFx0XHRyZXR1cm4gcmVzcG9uc2UuZGF0YS5kYXRhO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0bWVzc2FnZS5lcnJvcignS2jDtG5nIHTDrG0gdGjhuqV5IMSR4buLYSDEkWnhu4NtICEhJyk7XG5cdFx0XHRcdHJldHVybiBudWxsO1xuXHRcdFx0fVxuXHRcdH0gY2F0Y2ggKGVycm9yKSB7XG5cdFx0XHRtZXNzYWdlLmVycm9yKCdLaMO0bmcgdMOsbSB0aOG6pXkgxJHhu4thIMSRaeG7g20gIScpO1xuXHRcdFx0dGhyb3cgZXJyb3I7XG5cdFx0fVxuXHR9O1xuXG5cdHNlbGVjdEFyb3VuZFBsYWNlID0gYXN5bmMgKGlkKSA9PiB7XG5cdFx0Y29uc3QgcGxhY2UgPSBhd2FpdCB0aGlzLl9nZXRJbmZvclBsYWNlQXJvdW5kKGlkKTtcblx0XHRpZiAocGxhY2UpIHtcblx0XHRcdGNvbnN0IHZpZXdwb3J0ID0ge1xuXHRcdFx0XHRsb25naXR1ZGU6IE51bWJlcihwbGFjZS5sbmdfbGF0WzBdKSxcblx0XHRcdFx0bGF0aXR1ZGU6IE51bWJlcihwbGFjZS5sbmdfbGF0WzFdKSxcblx0XHRcdFx0em9vbTogMTUsXG5cdFx0XHR9O1xuXHRcdFx0dGhpcy5wcm9wcy5kaXNwYXRjaChzZXRNYXBWaWV3cG9ydEFjdGlvbih2aWV3cG9ydCkpO1xuXHRcdFx0dGhpcy5zZXRTdGF0ZSh7XG5cdFx0XHRcdGJvdHRvbUluZm9WaXNpYmxlOiB0cnVlLFxuXHRcdFx0XHRwbGFjZU1vdXNlQ2xpY2s6IHBsYWNlLFxuXHRcdFx0fSk7XG5cdFx0XHR0aGlzLnByb3BzLmRpc3BhdGNoKHNldFBvcHVwUmlnaHRDbGljayhmYWxzZSkpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRtZXNzYWdlLmVycm9yKCdLaMO0bmcgdMOsbSB0aOG6pXkgxJHhu4thIMSRaeG7g20gISEnKTtcblx0XHR9XG5cdH07XG5cblx0aGFuZGxlV2hhdElzID0gKHJlZE1hcmtlclZpc2libGUgPSB0cnVlKSA9PiB7XG5cdFx0Y29uc3QgeyBwb3NpdGlvbl9wb3B1cCwgaXNTbWFsbFNjcmVlbiB9ID0gdGhpcy5wcm9wcztcblx0XHRpZiAoaXNTbWFsbFNjcmVlbikge1xuXHRcdFx0dGhpcy5wcm9wcy5kaXNwYXRjaChcblx0XHRcdFx0Z2V0RGV0YWlsQnlMYXRMbmdBY3Rpb24oe1xuXHRcdFx0XHRcdGxhdGl0dWRlOiBwb3NpdGlvbl9wb3B1cC5sYXQsXG5cdFx0XHRcdFx0bG9uZ2l0dWRlOiBwb3NpdGlvbl9wb3B1cC5sbmcsXG5cdFx0XHRcdH0pXG5cdFx0XHQpO1xuXG5cdFx0XHR0aGlzLnByb3BzLmRpc3BhdGNoKHNldEJveFZpc2libGVBY3Rpb24oJ2luZm8nKSk7XG5cdFx0XHR0aGlzLnByb3BzLmRpc3BhdGNoKGNsZWFyU2VhcmNoQXJvdW5kQWN0aW9uKCkpO1xuXHRcdFx0dGhpcy5wcm9wcy5kaXNwYXRjaChzZXRQb3B1cFJpZ2h0Q2xpY2soZmFsc2UpKTtcblx0XHRcdHRoaXMucmVtb3ZlTWFya2VyV2hhdElzKCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRoaXMuc2VsZWN0UGxhY2UocG9zaXRpb25fcG9wdXAubGF0LCBwb3NpdGlvbl9wb3B1cC5sbmcsIHJlZE1hcmtlclZpc2libGUpO1xuXHRcdH1cblx0fTtcblxuXHRoYW5kbGVGcm9tSGVyZSA9IGFzeW5jIChsYXQsIGxuZykgPT4ge1xuXHRcdGxldCBwbGFjZTtcblx0XHRpZiAoIWxhdCB8fCAhbG5nKSBwbGFjZSA9IGF3YWl0IHRoaXMuX2dldEluZm9yUGxhY2UoKTtcblx0XHRlbHNlIHtcblx0XHRcdHBsYWNlID0gYXdhaXQgdGhpcy5fZ2V0SW5mb3JQbGFjZShsYXQsIGxuZyk7XG5cdFx0fVxuXHRcdGlmIChwbGFjZSkge1xuXHRcdFx0Y29uc3Qgdmlld3BvcnQgPSB7XG5cdFx0XHRcdGxvbmdpdHVkZTogcGxhY2UuZ2VvbWV0cnkubG9jYXRpb24ubG5nLFxuXHRcdFx0XHRsYXRpdHVkZTogcGxhY2UuZ2VvbWV0cnkubG9jYXRpb24ubGF0LFxuXHRcdFx0XHR6b29tOiAxNSxcblx0XHRcdH07XG5cdFx0XHQhdGhpcy5wcm9wcy50b19wbGFjZSAmJiB0aGlzLnByb3BzLmRpc3BhdGNoKHNldE1hcFZpZXdwb3J0QWN0aW9uKHZpZXdwb3J0KSk7XG5cdFx0XHR0aGlzLnByb3BzLmRpc3BhdGNoKHNldEJveFZpc2libGVBY3Rpb24oJ25hdmlnYXRpb24nKSk7XG5cdFx0XHR0aGlzLnByb3BzLmRpc3BhdGNoKG5hdmlnYXRpb25Gcm9tQWN0aW9uKHBsYWNlLCBgJHtwbGFjZS5uYW1lfSAtICR7cGxhY2UuZm9ybWF0dGVkX2FkZHJlc3N9YCkpO1xuXG5cdFx0XHR0aGlzLnByb3BzLmRpc3BhdGNoKHNldFJlZE1hcmtlckFjdGlvbihmYWxzZSkpO1xuXHRcdFx0dGhpcy5jaGFuZ2VWaXNpYmxlQm90dG9tSW5mbyhmYWxzZSk7XG5cdFx0fVxuXHR9O1xuXG5cdGhhbmRsZVRvSGVyZSA9IGFzeW5jIChsYXQsIGxuZykgPT4ge1xuXHRcdGxldCBwbGFjZTtcblx0XHRpZiAoIWxhdCB8fCAhbG5nKSBwbGFjZSA9IGF3YWl0IHRoaXMuX2dldEluZm9yUGxhY2UoKTtcblx0XHRlbHNlIHtcblx0XHRcdHBsYWNlID0gYXdhaXQgdGhpcy5fZ2V0SW5mb3JQbGFjZShsYXQsIGxuZyk7XG5cdFx0fVxuXHRcdGlmIChwbGFjZSkge1xuXHRcdFx0dGhpcy5wcm9wcy5kaXNwYXRjaChzZXRCb3hWaXNpYmxlQWN0aW9uKCduYXZpZ2F0aW9uJykpO1xuXHRcdFx0Y29uc3Qgdmlld3BvcnQgPSB7XG5cdFx0XHRcdGxvbmdpdHVkZTogcGxhY2UuZ2VvbWV0cnkubG9jYXRpb24ubG5nLFxuXHRcdFx0XHRsYXRpdHVkZTogcGxhY2UuZ2VvbWV0cnkubG9jYXRpb24ubGF0LFxuXHRcdFx0XHR6b29tOiAxNSxcblx0XHRcdH07XG5cdFx0XHRjb25zdCBteV9sb2NhdGlvbiA9IHRoaXMucHJvcHMubXlfbG9jYXRpb247XG5cdFx0XHRpZiAobXlfbG9jYXRpb24gJiYgKHRoaXMucHJvcHMuYm94VmlzaWJsZSA9PT0gJ3NlYXJjaCcgfHwgdGhpcy5wcm9wcy5ib3hWaXNpYmxlID09PSAnaW5mbycpKSB7XG5cdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0Y29uc3QgcmVzcG9uc2UgPSBhd2FpdCBSZXF1ZXN0Lmdlb2NvZGUobXlfbG9jYXRpb24pO1xuXHRcdFx0XHRcdGlmIChyZXNwb25zZS5kYXRhLnJlc3VsdHMubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRcdFx0dGhpcy5wcm9wcy5kaXNwYXRjaChcblx0XHRcdFx0XHRcdFx0bmF2aWdhdGlvbkZyb21BY3Rpb24oXG5cdFx0XHRcdFx0XHRcdFx0e1xuXHRcdFx0XHRcdFx0XHRcdFx0Li4ucmVzcG9uc2UuZGF0YS5yZXN1bHRzWzBdLFxuXHRcdFx0XHRcdFx0XHRcdFx0bmFtZTogcmVzcG9uc2UuZGF0YS5yZXN1bHRzWzBdLmFkZHJlc3NfY29tcG9uZW50c1swXS5sb25nX25hbWUsXG5cdFx0XHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdFx0XHQnVuG7iyB0csOtIGPhu6dhIGLhuqFuJ1xuXHRcdFx0XHRcdFx0XHQpXG5cdFx0XHRcdFx0XHQpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSBjYXRjaCAoZXJyb3IpIHtcblx0XHRcdFx0XHR0aHJvdyBlcnJvcjtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0IXRoaXMucHJvcHMuZnJvbV9wbGFjZSAmJiB0aGlzLnByb3BzLmRpc3BhdGNoKHNldE1hcFZpZXdwb3J0QWN0aW9uKHZpZXdwb3J0KSk7XG5cdFx0XHR0aGlzLnByb3BzLmRpc3BhdGNoKG5hdmlnYXRpb25Ub0FjdGlvbihwbGFjZSwgYCR7cGxhY2UubmFtZX0gLSAke3BsYWNlLmZvcm1hdHRlZF9hZGRyZXNzfWApKTtcblx0XHRcdHRoaXMucHJvcHMuZGlzcGF0Y2goc2V0Qm94VmlzaWJsZUFjdGlvbignbmF2aWdhdGlvbicpKTtcblx0XHRcdHRoaXMucHJvcHMuZGlzcGF0Y2goc2V0UmVkTWFya2VyQWN0aW9uKGZhbHNlKSk7XG5cdFx0XHR0aGlzLmNoYW5nZVZpc2libGVCb3R0b21JbmZvKGZhbHNlKTtcblx0XHR9XG5cdH07XG5cblx0aGFuZGxlRGVsZXRlTG9jYXRpb24gPSAoKSA9PiB7XG5cdFx0Y29uc3QgeyB0eXBlX3BvcHVwIH0gPSB0aGlzLnByb3BzO1xuXHRcdGlmICh0eXBlX3BvcHVwID09PSAncG9wdXBGcm9tUGxhY2UnKSB7XG5cdFx0XHR0aGlzLnByb3BzLmRpc3BhdGNoKG5hdmlnYXRpb25Gcm9tQWN0aW9uKG51bGwsICcnKSk7XG5cdFx0fSBlbHNlIGlmICh0eXBlX3BvcHVwID09PSAncG9wdXBUb1BsYWNlJykge1xuXHRcdFx0dGhpcy5wcm9wcy5kaXNwYXRjaChuYXZpZ2F0aW9uVG9BY3Rpb24obnVsbCwgJycpKTtcblx0XHR9XG5cdFx0dGhpcy5wcm9wcy5kaXNwYXRjaChjbGVhclJlc3VsdEFjdGlvbigpKTtcblx0fTtcblxuXHRoYW5kbGVTZWFyY2hBcm91bmQgPSBhc3luYyAoKSA9PiB7XG5cdFx0Y29uc3QgcGxhY2UgPSBhd2FpdCB0aGlzLl9nZXRJbmZvclBsYWNlKCk7XG5cdFx0aWYgKHBsYWNlKSB7XG5cdFx0XHRjb25zdCB2aWV3cG9ydCA9IHtcblx0XHRcdFx0bG9uZ2l0dWRlOiBwbGFjZS5nZW9tZXRyeS5sb2NhdGlvbi5sbmcsXG5cdFx0XHRcdGxhdGl0dWRlOiBwbGFjZS5nZW9tZXRyeS5sb2NhdGlvbi5sYXQsXG5cdFx0XHRcdHpvb206IDE1LFxuXHRcdFx0fTtcblx0XHRcdGNvbnN0IGxvY2F0aW9uID0ge1xuXHRcdFx0XHRsYXQ6IHBsYWNlLmdlb21ldHJ5LmxvY2F0aW9uLmxhdCxcblx0XHRcdFx0bG5nOiBwbGFjZS5nZW9tZXRyeS5sb2NhdGlvbi5sbmcsXG5cdFx0XHR9O1xuXHRcdFx0dGhpcy5wcm9wcy5kaXNwYXRjaChzZXRCb3hWaXNpYmxlQWN0aW9uKCdzZWFyY2gnKSk7XG5cdFx0XHR0aGlzLnByb3BzLmRpc3BhdGNoKHNldE1hcFZpZXdwb3J0QWN0aW9uKHZpZXdwb3J0KSk7XG5cdFx0XHR0aGlzLnByb3BzLmRpc3BhdGNoKHNlYXJjaEFyb3VuZEFjdGlvbihsb2NhdGlvbiwgdGhpcy5wcm9wcy52aWV3cG9ydC56b29tKSk7XG5cdFx0XHR0aGlzLnNldFN0YXRlKHtcblx0XHRcdFx0Ym90dG9tSW5mb1Zpc2libGU6IGZhbHNlLFxuXHRcdFx0fSk7XG5cdFx0fVxuXHR9O1xuXG5cdF9zZWxlY3RBcm91bmRQbGFjZSA9ICh0eXBlLCBwbGFjZSkgPT4ge1xuXHRcdGlmICh0eXBlICE9PSAnY2VudGVyJykge1xuXHRcdFx0dGhpcy5wcm9wcy5kaXNwYXRjaChzZWxlY3RBcm91bmRQbGFjZUFjdGlvbihwbGFjZSkpO1xuXHRcdFx0dGhpcy5zZWxlY3RBcm91bmRQbGFjZShwbGFjZT8uaWQpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR0aGlzLnByb3BzLmRpc3BhdGNoKHNlbGVjdEFyb3VuZFBsYWNlQWN0aW9uKHBsYWNlKSk7XG5cdFx0XHR0aGlzLnNlbGVjdFBsYWNlKHBsYWNlLmdlb21ldHJ5LmxvY2F0aW9uLmxhdCwgcGxhY2UuZ2VvbWV0cnkubG9jYXRpb24ubG5nLCBmYWxzZSk7XG5cdFx0fVxuXHR9O1xuXG5cdGhhbmRsZVRvQXJvdW5kUGxhY2UgPSBhc3luYyAoKSA9PiB7XG5cdFx0bGV0IHBsYWNlID0gbnVsbDtcblx0XHR0aGlzLnByb3BzLmFyb3VuZF9wbGFjZXMubWFwKChpdGVtKSA9PiB7XG5cdFx0XHRpZiAoaXRlbS5sbmdfbGF0WzBdICogMSA9PT0gdGhpcy5wb3B1cFJpZ2h0Q2xpY2suZ2V0TG5nTGF0KCkubG5nICYmIGl0ZW0ubG5nX2xhdFsxXSAqIDEgPT09IHRoaXMucG9wdXBSaWdodENsaWNrLmdldExuZ0xhdCgpLmxhdCkge1xuXHRcdFx0XHRwbGFjZSA9IGl0ZW07XG5cdFx0XHR9XG5cdFx0fSk7XG5cdFx0aWYgKHBsYWNlKSB7XG5cdFx0XHR0cnkge1xuXHRcdFx0XHR0aGlzLnByb3BzLmRpc3BhdGNoKHNldFBvcHVwUmlnaHRDbGljayhmYWxzZSkpO1xuXHRcdFx0XHRjb25zdCBwbGFjZV9jZW50ZXIgPSB0aGlzLnByb3BzLmFyb3VuZF9wbGFjZV9jZW50ZXI7XG5cdFx0XHRcdHRoaXMucHJvcHMuZGlzcGF0Y2gobmF2aWdhdGlvbkZyb21BY3Rpb24ocGxhY2VfY2VudGVyLCBgJHtwbGFjZV9jZW50ZXIubmFtZX0gLSAke3BsYWNlX2NlbnRlci5mb3JtYXR0ZWRfYWRkcmVzc31gKSk7XG5cdFx0XHRcdGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgQXhpb3MuZ2V0KGBodHRwczovL25hcGkuZ29vbmcuaW8vdjEvbWFya2VyL2dldF9tYXJrZXJfZGV0YWlsLyR7cGxhY2UuaWR9YCk7XG5cblx0XHRcdFx0cGxhY2UgPSByZXNwb25zZS5kYXRhPy5kYXRhO1xuXHRcdFx0XHRwbGFjZSA9IHtcblx0XHRcdFx0XHQuLi5wbGFjZSxcblx0XHRcdFx0XHRwbGFjZV9pZDogcGxhY2UuX2lkLFxuXHRcdFx0XHRcdGdlb21ldHJ5OiB7XG5cdFx0XHRcdFx0XHRsb2NhdGlvbjoge1xuXHRcdFx0XHRcdFx0XHRsYXQ6IE51bWJlcihwbGFjZS5sbmdfbGF0WzFdKSxcblx0XHRcdFx0XHRcdFx0bG5nOiBOdW1iZXIocGxhY2UubG5nX2xhdFswXSksXG5cdFx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdH0sXG5cdFx0XHRcdFx0Zm9ybWF0dGVkX2FkZHJlc3M6IHBsYWNlLmRlc2NyaXB0aW9uLmFkZHJlc3MsXG5cdFx0XHRcdH07XG5cdFx0XHRcdHRoaXMucHJvcHMuZGlzcGF0Y2gobmF2aWdhdGlvblRvQWN0aW9uKHBsYWNlLCBgJHtwbGFjZS5uYW1lfSAtICR7cGxhY2UuZm9ybWF0dGVkX2FkZHJlc3N9YCkpO1xuXHRcdFx0XHR0aGlzLnByb3BzLmRpc3BhdGNoKHNldEJveFZpc2libGVBY3Rpb24oJ25hdmlnYXRpb24nKSk7XG5cdFx0XHR9IGNhdGNoIChlcnJvcikge1xuXHRcdFx0XHRtZXNzYWdlLmVycm9yKCdLaMO0bmcgdMOsbSB0aOG6pXkgxJHhu4thIMSRaeG7g20gIScpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRtZXNzYWdlLmVycm9yKCdLaMO0bmcgdMOsbSB0aOG6pXkgxJHhu4thIMSRaeG7g20gIScpO1xuXHRcdH1cblx0fTtcblxuXHRyZW1vdmVNYXJrZXJQb3B1cCA9ICgpID0+IHtcblx0XHRpZiAodGhpcy5tYXJrZXJDdXJyZW50UGxhY2UpIHRoaXMubWFya2VyQ3VycmVudFBsYWNlLnJlbW92ZSgpO1xuXHRcdGlmICh0aGlzLnBvcHVwUmlnaHRDbGljaykgdGhpcy5wb3B1cFJpZ2h0Q2xpY2sucmVtb3ZlKCk7XG5cdFx0aWYgKHRoaXMucHJvcHMuYXJvdW5kX3BsYWNlcykgdGhpcy5wcm9wcy5kaXNwYXRjaChjbGVhclNlYXJjaEFyb3VuZEFjdGlvbigpKTtcblx0XHRpZiAodGhpcy5yZWRNYXJrZXIpIHRoaXMucmVkTWFya2VyLnJlbW92ZSgpO1xuXHR9O1xuXG5cdGdldEFkZHJlc3NHZW9jb2RlID0gKHBsYWNlKSA9PiB7XG5cdFx0bGV0IHJlc3VsdCA9IFtdO1xuXHRcdHBsYWNlLmFkZHJlc3NfY29tcG9uZW50cz8uc2xpY2UoMSkubWFwKChpdGVtKSA9PiB7XG5cdFx0XHRyZXN1bHQucHVzaChpdGVtLmxvbmdfbmFtZSk7XG5cdFx0fSk7XG5cdFx0cmV0dXJuIHJlc3VsdC5qb2luKCcsJyk7XG5cdH07XG5cblx0Y29tcG9uZW50RGlkVXBkYXRlKHByZXZQcm9wcykge1xuXHRcdGlmICh0aGlzLnByb3BzLmlzU21hbGxTY3JlZW4gIT09IHByZXZQcm9wcy5pc1NtYWxsU2NyZWVuKSB7XG5cdFx0XHRpZiAoIXRoaXMucHJvcHMuaXNTbWFsbFNjcmVlbiAmJiAhdGhpcy5uYXZpZ2F0aW9uKSB7XG5cdFx0XHRcdHRoaXMubmF2aWdhdGlvbiA9IG5ldyBtYXBsaWJyZWdsLk5hdmlnYXRpb25Db250cm9sKCk7XG5cdFx0XHRcdHRoaXMubWFwLmFkZENvbnRyb2wodGhpcy5uYXZpZ2F0aW9uKTtcblx0XHRcdH0gZWxzZSBpZiAodGhpcy5wcm9wcy5pc1NtYWxsU2NyZWVuICYmIHRoaXMubmF2aWdhdGlvbikge1xuXHRcdFx0XHR0aGlzLm1hcC5yZW1vdmVDb250cm9sKHRoaXMubmF2aWdhdGlvbik7XG5cdFx0XHRcdHRoaXMubmF2aWdhdGlvbiA9IG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCFlcXVhbChwcmV2UHJvcHMucG9zaXRpb25NYXJrZXJTZWxlY3QsIHRoaXMucHJvcHMucG9zaXRpb25NYXJrZXJTZWxlY3QpICYmIHRoaXMucHJvcHMucG9zaXRpb25NYXJrZXJTZWxlY3QpIHtcblx0XHRcdGlmICh0aGlzLnJlZE1hcmtlcikge1xuXHRcdFx0XHR0aGlzLnJlZE1hcmtlciA9IHRoaXMucmVkTWFya2VyLnNldExuZ0xhdCh0aGlzLnByb3BzLnBvc2l0aW9uTWFya2VyU2VsZWN0KS5hZGRUbyh0aGlzLm1hcCk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRjb25zdCBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXHRcdFx0XHRlbC5pbm5lckhUTUwgPSBSZWFjdERPTVNlcnZlci5yZW5kZXJUb1N0YXRpY01hcmt1cCg8TWFya2VyIHNpemU9ezIyfSAvPik7XG5cdFx0XHRcdC8vIE1hcmtlciBjaHXhu5l0IHBo4bqjaVxuXHRcdFx0XHR0aGlzLnJlZE1hcmtlciA9IG5ldyBtYXBsaWJyZWdsLk1hcmtlcih7IGFuY2hvcjogJ2JvdHRvbScsIGVsZW1lbnQ6IGVsIH0pLnNldExuZ0xhdCh0aGlzLnByb3BzLnBvc2l0aW9uTWFya2VyU2VsZWN0KS5hZGRUbyh0aGlzLm1hcCk7XG5cblx0XHRcdFx0dGhpcy5yZWRNYXJrZXIuZ2V0RWxlbWVudCgpLmFkZEV2ZW50TGlzdGVuZXIoJ2NvbnRleHRtZW51JywgKGUpID0+IHtcblx0XHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHR0aGlzLnByb3BzLmRpc3BhdGNoKHNldFBvcHVwUmlnaHRDbGljayh0cnVlLCB0aGlzLnByb3BzLnBvc2l0aW9uTWFya2VyU2VsZWN0LCAnbm9ybWFsJykpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRpZiAocHJldlByb3BzLm1hcmtlclNlbGVjdCAhPT0gdGhpcy5wcm9wcy5tYXJrZXJTZWxlY3QpIHtcblx0XHRcdGlmICghdGhpcy5wcm9wcy5tYXJrZXJTZWxlY3QpIHtcblx0XHRcdFx0dGhpcy5yZWRNYXJrZXI/LnJlbW92ZSgpO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0aGlzLnByb3BzLnBvcHVwX3Zpc2libGUgJiYgKCFlcXVhbChwcmV2UHJvcHMucG9zaXRpb25fcG9wdXAsIHRoaXMucHJvcHMucG9zaXRpb25fcG9wdXApIHx8IHRoaXMucHJvcHMudHlwZV9wb3B1cCAhPT0gcHJldlByb3BzLnR5cGVfcG9wdXApICYmIHRoaXMucHJvcHMucG9zaXRpb25fcG9wdXApIHtcblx0XHRcdHRoaXMucG9wdXBSaWdodENsaWNrID0gdGhpcy5wb3B1cFJpZ2h0Q2xpY2tcblx0XHRcdFx0PyB0aGlzLnBvcHVwUmlnaHRDbGlja1xuXHRcdFx0XHRcdFx0LnNldExuZ0xhdChbdGhpcy5wcm9wcy5wb3NpdGlvbl9wb3B1cC5sbmcsIHRoaXMucHJvcHMucG9zaXRpb25fcG9wdXAubGF0XSlcblx0XHRcdFx0XHRcdC5hZGRUbyh0aGlzLm1hcClcblx0XHRcdFx0XHRcdC5zZXRIVE1MKFxuXHRcdFx0XHRcdFx0XHRSZWFjdERPTVNlcnZlci5yZW5kZXJUb1N0YXRpY01hcmt1cChcblx0XHRcdFx0XHRcdFx0XHQ8TWVudVJpZ2h0Q2xpY2tcblx0XHRcdFx0XHRcdFx0XHRcdGRpc3BhdGNoPXt0aGlzLnByb3BzLmRpc3BhdGNofVxuXHRcdFx0XHRcdFx0XHRcdFx0cG9zaXRpb25fcG9wdXA9e3RoaXMucHJvcHMucG9zaXRpb25fcG9wdXB9XG5cdFx0XHRcdFx0XHRcdFx0XHR0eXBlX3BvcHVwPXt0aGlzLnByb3BzLnR5cGVfcG9wdXB9XG5cdFx0XHRcdFx0XHRcdFx0Lz5cblx0XHRcdFx0XHRcdFx0KVxuXHRcdFx0XHRcdFx0KVxuXHRcdFx0XHQ6IG5ldyBtYXBsaWJyZWdsLlBvcHVwKHtcblx0XHRcdFx0XHRcdGNsb3NlQnV0dG9uOiBmYWxzZSxcblx0XHRcdFx0XHRcdGFuY2hvcjogJ3RvcCcsXG5cdFx0XHRcdFx0XHRjbG9zZU9uQ2xpY2s6IGZhbHNlLFxuXHRcdFx0XHRcdFx0b2Zmc2V0OiBbMCwgNV0sXG5cdFx0XHRcdCAgfSlcblx0XHRcdFx0XHRcdC5zZXRMbmdMYXQoW3RoaXMucHJvcHMucG9zaXRpb25fcG9wdXAubG5nLCB0aGlzLnByb3BzLnBvc2l0aW9uX3BvcHVwLmxhdF0pXG5cdFx0XHRcdFx0XHQuc2V0SFRNTChcblx0XHRcdFx0XHRcdFx0UmVhY3RET01TZXJ2ZXIucmVuZGVyVG9TdGF0aWNNYXJrdXAoXG5cdFx0XHRcdFx0XHRcdFx0PE1lbnVSaWdodENsaWNrXG5cdFx0XHRcdFx0XHRcdFx0XHRkaXNwYXRjaD17dGhpcy5wcm9wcy5kaXNwYXRjaH1cblx0XHRcdFx0XHRcdFx0XHRcdHBvc2l0aW9uX3BvcHVwPXt0aGlzLnByb3BzLnBvc2l0aW9uX3BvcHVwfVxuXHRcdFx0XHRcdFx0XHRcdFx0dHlwZV9wb3B1cD17dGhpcy5wcm9wcy50eXBlX3BvcHVwfVxuXHRcdFx0XHRcdFx0XHRcdC8+XG5cdFx0XHRcdFx0XHRcdClcblx0XHRcdFx0XHRcdClcblx0XHRcdFx0XHRcdC5hZGRUbyh0aGlzLm1hcCk7XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMucG9wdXBSaWdodENsaWNrICYmICF0aGlzLnByb3BzLnBvcHVwX3Zpc2libGUpIHtcblx0XHRcdHRoaXMucG9wdXBSaWdodENsaWNrLnJlbW92ZSgpO1xuXHRcdH1cblxuXHRcdGlmICghZXF1YWwocHJldlByb3BzLmN1cnJlbnRfcGxhY2UsIHRoaXMucHJvcHMuY3VycmVudF9wbGFjZSkgJiYgdGhpcy5wcm9wcy5jdXJyZW50X3BsYWNlKSB7XG5cdFx0XHRjb25zdCBzZWxlY3RlZFBsYWNlID0gdGhpcy5wcm9wcy5jdXJyZW50X3BsYWNlO1xuXG5cdFx0XHR0aGlzLm1hcC5mbHlUbyh7XG5cdFx0XHRcdGNlbnRlcjogW3NlbGVjdGVkUGxhY2UuZ2VvbWV0cnkubG9jYXRpb24ubG5nLCBzZWxlY3RlZFBsYWNlLmdlb21ldHJ5LmxvY2F0aW9uLmxhdF0sXG5cdFx0XHRcdHpvb206IDE1LFxuXHRcdFx0XHRzcGVlZDogMS41LFxuXHRcdFx0XHRjdXJ2ZTogMSxcblx0XHRcdH0pO1xuXHRcdFx0dGhpcy5wcm9wcy5kaXNwYXRjaChzZXRDb2xsYXBzZWRJbmZvQm94QWN0aW9uKGZhbHNlKSk7XG5cdFx0XHR0aGlzLnByb3BzLmRpc3BhdGNoKHNldFJlZE1hcmtlckFjdGlvbihmYWxzZSkpO1xuXHRcdFx0dGhpcy5zZXRTdGF0ZSh7XG5cdFx0XHRcdGJvdHRvbUluZm9WaXNpYmxlOiBmYWxzZSxcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdGlmICghZXF1YWwocHJldlByb3BzLnZpZXdwb3J0LCB0aGlzLnByb3BzLnZpZXdwb3J0KSAmJiB0aGlzLnByb3BzLnZpZXdwb3J0KSB7XG5cdFx0XHR0aGlzLm1hcC5mbHlUbyh7XG5cdFx0XHRcdGNlbnRlcjogW3RoaXMucHJvcHMudmlld3BvcnQubG9uZ2l0dWRlLCB0aGlzLnByb3BzLnZpZXdwb3J0LmxhdGl0dWRlXSxcblx0XHRcdFx0em9vbTogdGhpcy5wcm9wcy52aWV3cG9ydC56b29tLFxuXHRcdFx0XHRzcGVlZDogMixcblx0XHRcdH0pO1xuXHRcdH1cblxuXHRcdGlmICghZXF1YWwocHJldlByb3BzLmFyb3VuZF9wbGFjZV9jZW50ZXIsIHRoaXMucHJvcHMuYXJvdW5kX3BsYWNlX2NlbnRlcikpIHtcblx0XHRcdHRoaXMucHJvcHMuZGlzcGF0Y2goc2V0UmVkTWFya2VyQWN0aW9uKGZhbHNlKSk7XG5cdFx0fVxuXG5cdFx0aWYgKCFlcXVhbChwcmV2UHJvcHMuYm94VmlzaWJsZSwgdGhpcy5wcm9wcy5ib3hWaXNpYmxlKSAmJiB0aGlzLnByb3BzLmJveFZpc2libGUgPT09ICduYXZpZ2F0aW9uJykge1xuXHRcdFx0dGhpcy5yZW1vdmVNYXJrZXJQb3B1cCgpO1xuXHRcdH1cblxuXHRcdGlmICghZXF1YWwocHJldlByb3BzLnJlc3VsdF9zZWxlY3QsIHRoaXMucHJvcHMucmVzdWx0X3NlbGVjdCkgfHwgIWVxdWFsKHByZXZQcm9wcy5yZXN1bHRfbmF2aWdhdGlvbiwgdGhpcy5wcm9wcy5yZXN1bHRfbmF2aWdhdGlvbikpIHtcblx0XHRcdGNvbnN0IHsgcmVzdWx0X3NlbGVjdCwgcmVzdWx0X25hdmlnYXRpb24sIGJveFZpc2libGUsIGZyb21fcGxhY2UsIHRvX3BsYWNlIH0gPSB0aGlzLnByb3BzO1xuXHRcdFx0bGV0IGRhc2hlZExpbmVHZW9KU09OID0gW10sXG5cdFx0XHRcdHBvbHlsaW5lR2VvSlNPTiA9IFtdO1xuXHRcdFx0dGhpcy5yZXN1bHRfbmF2aWdhdGlvbiA9IFtdO1xuXG5cdFx0XHRpZiAoKGJveFZpc2libGUgIT09ICduYXZpZ2F0aW9uJyAmJiBib3hWaXNpYmxlICE9PSAnaWZyYW1lJykgfHwgIXJlc3VsdF9uYXZpZ2F0aW9uKSB7XG5cdFx0XHRcdC8vIFJlbW92ZSBjYWMgbGF5ZXIvc291cmNlXG5cdFx0XHRcdGlmICh0aGlzLm1hcC5nZXRMYXllcihgcm91dGUtbGF5ZXItZmFzdGVzdGApKSB0aGlzLm1hcC5yZW1vdmVMYXllcihgcm91dGUtbGF5ZXItZmFzdGVzdGApO1xuXHRcdFx0XHRpZiAodGhpcy5tYXAuZ2V0TGF5ZXIoYHJvdXRlLWxheWVyLXNob3J0ZXN0YCkpIHRoaXMubWFwLnJlbW92ZUxheWVyKGByb3V0ZS1sYXllci1zaG9ydGVzdGApO1xuXHRcdFx0XHRpZiAodGhpcy5tYXAuZ2V0TGF5ZXIoYHdhbGstbGF5ZXItMGApKSB0aGlzLm1hcC5yZW1vdmVMYXllcihgd2Fsay1sYXllci0wYCk7XG5cdFx0XHRcdGlmICh0aGlzLm1hcC5nZXRMYXllcihgd2Fsay1sYXllci0xYCkpIHRoaXMubWFwLnJlbW92ZUxheWVyKGB3YWxrLWxheWVyLTFgKTtcblxuXHRcdFx0XHRpZiAodGhpcy5tYXAuZ2V0U291cmNlKGByb3V0ZS1zb3VyY2UtZmFzdGVzdGApKSB0aGlzLm1hcC5yZW1vdmVTb3VyY2UoYHJvdXRlLXNvdXJjZS1mYXN0ZXN0YCk7XG5cdFx0XHRcdGlmICh0aGlzLm1hcC5nZXRTb3VyY2UoYHJvdXRlLXNvdXJjZS1zaG9ydGVzdGApKSB0aGlzLm1hcC5yZW1vdmVTb3VyY2UoYHJvdXRlLXNvdXJjZS1zaG9ydGVzdGApO1xuXHRcdFx0XHRpZiAodGhpcy5tYXAuZ2V0U291cmNlKGB3YWxrLXNvdXJjZS0wYCkpIHRoaXMubWFwLnJlbW92ZVNvdXJjZShgd2Fsay1zb3VyY2UtMGApO1xuXHRcdFx0XHRpZiAodGhpcy5tYXAuZ2V0U291cmNlKGB3YWxrLXNvdXJjZS0xYCkpIHRoaXMubWFwLnJlbW92ZVNvdXJjZShgd2Fsay1zb3VyY2UtMWApO1xuXG5cdFx0XHRcdHRoaXMucG9wdXBfbmF2aWdhdGlvblswXT8ucmVtb3ZlKCk7XG5cdFx0XHRcdHRoaXMucG9wdXBfbmF2aWdhdGlvblsxXT8ucmVtb3ZlKCk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRpZiAocmVzdWx0X25hdmlnYXRpb24pIHtcblx0XHRcdFx0XHRsZXQgZGlzdGFuY2UgPSAnJztcblx0XHRcdFx0XHRpZiAobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3VuaXQnKSA9PT0gJ0tJTE9NRVRFUlMnKSB7XG5cdFx0XHRcdFx0XHRkaXN0YW5jZSA9IGAkeyhyZXN1bHRfbmF2aWdhdGlvbi5mYXN0ZXN0WzBdLmxlZ3NbMF0uZGlzdGFuY2UudmFsdWUgLyAxMDAwKS50b0ZpeGVkKDEpfSBLTWA7XG5cdFx0XHRcdFx0fSBlbHNlIGlmIChsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgndW5pdCcpID09PSAnTUlMRVMnKSB7XG5cdFx0XHRcdFx0XHRkaXN0YW5jZSA9IGAkeygocmVzdWx0X25hdmlnYXRpb24uZmFzdGVzdFswXS5sZWdzWzBdLmRpc3RhbmNlLnZhbHVlIC8gMTAwMCkgKiBNaWxlX1RyYXZlbC5NSUxFUykudG9GaXhlZCgxKX0gROG6t21gO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRkaXN0YW5jZSA9IGAkeyhyZXN1bHRfbmF2aWdhdGlvbi5mYXN0ZXN0WzBdLmxlZ3NbMF0uZGlzdGFuY2UudmFsdWUgLyAxMDAwKS50b0ZpeGVkKDEpfSBLTWA7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGxldCBjb29yZGluYXRlT2JqZWN0MSA9IHt9O1xuXHRcdFx0XHRcdGNvb3JkaW5hdGVPYmplY3QxLmNvb3JkaW5hdGVzID0gdGhpcy5kZWNvZGVQb2x5bGluZShyZXN1bHRfbmF2aWdhdGlvbi5mYXN0ZXN0WzBdLm92ZXJ2aWV3X3BvbHlsaW5lLnBvaW50cyk7XG5cdFx0XHRcdFx0Y29vcmRpbmF0ZU9iamVjdDEudHlwZSA9ICdMaW5lU3RyaW5nJztcblx0XHRcdFx0XHRwb2x5bGluZUdlb0pTT04ucHVzaChjb29yZGluYXRlT2JqZWN0MSk7XG5cdFx0XHRcdFx0cG9seWxpbmVHZW9KU09OWzBdLnJvYWRXYXkgPSAnZmFzdGVzdCc7XG5cdFx0XHRcdFx0bGV0IGNvb3JkaW5hdGVPYmplY3QyID0ge307XG5cdFx0XHRcdFx0Y29vcmRpbmF0ZU9iamVjdDIuY29vcmRpbmF0ZXMgPSB0aGlzLmRlY29kZVBvbHlsaW5lKHJlc3VsdF9uYXZpZ2F0aW9uLnNob3J0ZXN0WzBdLm92ZXJ2aWV3X3BvbHlsaW5lLnBvaW50cyk7XG5cdFx0XHRcdFx0Y29vcmRpbmF0ZU9iamVjdDIudHlwZSA9ICdMaW5lU3RyaW5nJztcblx0XHRcdFx0XHRwb2x5bGluZUdlb0pTT04ucHVzaChjb29yZGluYXRlT2JqZWN0Mik7XG5cdFx0XHRcdFx0cG9seWxpbmVHZW9KU09OWzFdLnJvYWRXYXkgPSAnc2hvcnRlc3QnO1xuXG5cdFx0XHRcdFx0ZGFzaGVkTGluZUdlb0pTT04ucHVzaCh7XG5cdFx0XHRcdFx0XHR0eXBlOiAnTGluZVN0cmluZycsXG5cdFx0XHRcdFx0XHRjb29yZGluYXRlczogW1xuXHRcdFx0XHRcdFx0XHRbcG9seWxpbmVHZW9KU09OWzBdLmNvb3JkaW5hdGVzWzBdWzBdLCBwb2x5bGluZUdlb0pTT05bMF0uY29vcmRpbmF0ZXNbMF1bMV1dLFxuXHRcdFx0XHRcdFx0XHRbZnJvbV9wbGFjZT8uZ2VvbWV0cnkubG9jYXRpb24ubG5nLCBmcm9tX3BsYWNlPy5nZW9tZXRyeS5sb2NhdGlvbi5sYXRdLFxuXHRcdFx0XHRcdFx0XSxcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRkYXNoZWRMaW5lR2VvSlNPTi5wdXNoKHtcblx0XHRcdFx0XHRcdHR5cGU6ICdMaW5lU3RyaW5nJyxcblx0XHRcdFx0XHRcdGNvb3JkaW5hdGVzOiBbXG5cdFx0XHRcdFx0XHRcdFtwb2x5bGluZUdlb0pTT05bMF0uY29vcmRpbmF0ZXNbcG9seWxpbmVHZW9KU09OWzBdLmNvb3JkaW5hdGVzLmxlbmd0aCAtIDFdWzBdLCBwb2x5bGluZUdlb0pTT05bMF0uY29vcmRpbmF0ZXNbcG9seWxpbmVHZW9KU09OWzBdLmNvb3JkaW5hdGVzLmxlbmd0aCAtIDFdWzFdXSxcblx0XHRcdFx0XHRcdFx0W3RvX3BsYWNlPy5nZW9tZXRyeS5sb2NhdGlvbi5sbmcsIHRvX3BsYWNlPy5nZW9tZXRyeS5sb2NhdGlvbi5sYXRdLFxuXHRcdFx0XHRcdFx0XSxcblx0XHRcdFx0XHR9KTtcblxuXHRcdFx0XHRcdHBvbHlsaW5lR2VvSlNPTi5tYXAoKGl0ZW0sIGkpID0+IHtcblx0XHRcdFx0XHRcdC8vIExheWVyIGRhbiBkdW9uZ1xuXHRcdFx0XHRcdFx0aWYgKHRoaXMubWFwLmdldExheWVyKGByb3V0ZS1sYXllci0ke2l0ZW0ucm9hZFdheX1gKSkgdGhpcy5tYXAucmVtb3ZlTGF5ZXIoYHJvdXRlLWxheWVyLSR7aXRlbS5yb2FkV2F5fWApO1xuXHRcdFx0XHRcdFx0aWYgKHRoaXMubWFwLmdldFNvdXJjZShgcm91dGUtc291cmNlLSR7aXRlbS5yb2FkV2F5fWApKSB0aGlzLm1hcC5yZW1vdmVTb3VyY2UoYHJvdXRlLXNvdXJjZS0ke2l0ZW0ucm9hZFdheX1gKTtcblx0XHRcdFx0XHRcdHRoaXMubWFwLmFkZFNvdXJjZShgcm91dGUtc291cmNlLSR7aXRlbS5yb2FkV2F5fWAsIHtcblx0XHRcdFx0XHRcdFx0dHlwZTogJ2dlb2pzb24nLFxuXHRcdFx0XHRcdFx0XHRkYXRhOiB7XG5cdFx0XHRcdFx0XHRcdFx0dHlwZTogJ0ZlYXR1cmUnLFxuXHRcdFx0XHRcdFx0XHRcdHByb3BlcnRpZXM6IHt9LFxuXHRcdFx0XHRcdFx0XHRcdGdlb21ldHJ5OiBpdGVtLFxuXHRcdFx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHR0aGlzLm1hcC5hZGRMYXllcih7XG5cdFx0XHRcdFx0XHRcdGlkOiBgcm91dGUtbGF5ZXItJHtpdGVtLnJvYWRXYXl9YCxcblx0XHRcdFx0XHRcdFx0dHlwZTogJ2xpbmUnLFxuXHRcdFx0XHRcdFx0XHRzb3VyY2U6IGByb3V0ZS1zb3VyY2UtJHtpdGVtLnJvYWRXYXl9YCxcblx0XHRcdFx0XHRcdFx0bGF5b3V0OiB7XG5cdFx0XHRcdFx0XHRcdFx0J2xpbmUtam9pbic6ICdyb3VuZCcsXG5cdFx0XHRcdFx0XHRcdFx0J2xpbmUtY2FwJzogJ3JvdW5kJyxcblx0XHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdFx0cGFpbnQ6IHtcblx0XHRcdFx0XHRcdFx0XHQnbGluZS1jb2xvcic6ICdyZ2IoMjQsIDE0NCwgMjU1KScsXG5cdFx0XHRcdFx0XHRcdFx0J2xpbmUtd2lkdGgnOiA3LFxuXHRcdFx0XHRcdFx0XHRcdCdsaW5lLW9wYWNpdHknOiBpdGVtLnJvYWRXYXkgPT09IHJlc3VsdF9zZWxlY3QgPyAxIDogMC41LFxuXHRcdFx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHQvLyBMYXllciBkaSBib1xuXG5cdFx0XHRcdFx0XHRpZiAodGhpcy5tYXAuZ2V0TGF5ZXIoYHdhbGstbGF5ZXItJHtpfWApKSB0aGlzLm1hcC5yZW1vdmVMYXllcihgd2Fsay1sYXllci0ke2l9YCk7XG5cdFx0XHRcdFx0XHRpZiAodGhpcy5tYXAuZ2V0U291cmNlKGB3YWxrLXNvdXJjZS0ke2l9YCkpIHRoaXMubWFwLnJlbW92ZVNvdXJjZShgd2Fsay1zb3VyY2UtJHtpfWApO1xuXHRcdFx0XHRcdFx0dGhpcy5tYXAuYWRkU291cmNlKGB3YWxrLXNvdXJjZS0ke2l9YCwge1xuXHRcdFx0XHRcdFx0XHR0eXBlOiAnZ2VvanNvbicsXG5cdFx0XHRcdFx0XHRcdGRhdGE6IHtcblx0XHRcdFx0XHRcdFx0XHR0eXBlOiAnRmVhdHVyZScsXG5cdFx0XHRcdFx0XHRcdFx0cHJvcGVydGllczoge30sXG5cdFx0XHRcdFx0XHRcdFx0Z2VvbWV0cnk6IGRhc2hlZExpbmVHZW9KU09OW2ldLFxuXHRcdFx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHR0aGlzLm1hcC5hZGRMYXllcih7XG5cdFx0XHRcdFx0XHRcdGlkOiBgd2Fsay1sYXllci0ke2l9YCxcblx0XHRcdFx0XHRcdFx0dHlwZTogJ2xpbmUnLFxuXHRcdFx0XHRcdFx0XHRzb3VyY2U6IGB3YWxrLXNvdXJjZS0ke2l9YCxcblx0XHRcdFx0XHRcdFx0bGF5b3V0OiB7XG5cdFx0XHRcdFx0XHRcdFx0J2xpbmUtam9pbic6ICdyb3VuZCcsXG5cdFx0XHRcdFx0XHRcdFx0J2xpbmUtY2FwJzogJ3JvdW5kJyxcblx0XHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdFx0cGFpbnQ6IHtcblx0XHRcdFx0XHRcdFx0XHQnbGluZS1jb2xvcic6ICdyZ2IoMTMzLCAxMzUsIDEyNiknLFxuXHRcdFx0XHRcdFx0XHRcdCdsaW5lLW9wYWNpdHknOiAxLFxuXHRcdFx0XHRcdFx0XHRcdCdsaW5lLXdpZHRoJzogNixcblx0XHRcdFx0XHRcdFx0XHQnbGluZS1kYXNoYXJyYXknOiBbMC4yLCAyXSxcblx0XHRcdFx0XHRcdFx0fSxcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0Ly8gQWRkIFBvcHVwIGhpZW4ga2V0IHF1YVxuXG5cdFx0XHRcdFx0XHRpZiAodGhpcy5wb3B1cF9uYXZpZ2F0aW9uW2ldKSB7XG5cdFx0XHRcdFx0XHRcdHRoaXMucG9wdXBfbmF2aWdhdGlvbltpXT8ucmVtb3ZlKCk7XG5cdFx0XHRcdFx0XHRcdHRoaXMucG9wdXBfbmF2aWdhdGlvbltpXSA9IG51bGw7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR0aGlzLnBvcHVwX25hdmlnYXRpb25baV0gPSBuZXcgbWFwbGlicmVnbC5Qb3B1cCh7XG5cdFx0XHRcdFx0XHRcdGNsb3NlQnV0dG9uOiBmYWxzZSxcblx0XHRcdFx0XHRcdFx0YW5jaG9yOiAndG9wJyxcblx0XHRcdFx0XHRcdFx0Y2xvc2VPbkNsaWNrOiBmYWxzZSxcblx0XHRcdFx0XHRcdFx0Y2xhc3NOYW1lOiBpdGVtLnJvYWRXYXkgPT09IHJlc3VsdF9zZWxlY3QgPyAncG9wdXAtei1pbmRleDEnIDogJ3BvcHVwLXotaW5kZXgyJyxcblx0XHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0XHRcdC5zZXRMbmdMYXQoW2kgPT09IDAgPyBpdGVtLmNvb3JkaW5hdGVzW01hdGgudHJ1bmMoMC43NSAqIGl0ZW0uY29vcmRpbmF0ZXMubGVuZ3RoKV1bMF0gOiBpdGVtLmNvb3JkaW5hdGVzW01hdGgudHJ1bmMoMC4yNSAqIGl0ZW0uY29vcmRpbmF0ZXMubGVuZ3RoKV1bMF0sIGkgPT09IDAgPyBpdGVtLmNvb3JkaW5hdGVzW01hdGgudHJ1bmMoaXRlbS5jb29yZGluYXRlcy5sZW5ndGggKiAwLjc1KV1bMV0gOiBpdGVtLmNvb3JkaW5hdGVzW01hdGgudHJ1bmMoaXRlbS5jb29yZGluYXRlcy5sZW5ndGggKiAwLjI1KV1bMV1dKVxuXHRcdFx0XHRcdFx0XHQuc2V0SFRNTChcblx0XHRcdFx0XHRcdFx0XHRSZWFjdERPTVNlcnZlci5yZW5kZXJUb1N0YXRpY01hcmt1cChcblx0XHRcdFx0XHRcdFx0XHRcdDxkaXZcblx0XHRcdFx0XHRcdFx0XHRcdFx0Y2xhc3NOYW1lPVwidG9vbHRpcE5hdmlnYXRpb25cIlxuXHRcdFx0XHRcdFx0XHRcdFx0XHRpZD17YHBvcHVwLSR7aXRlbS5yb2FkV2F5fWB9PlxuXHRcdFx0XHRcdFx0XHRcdFx0XHQ8cD57ZGlzdGFuY2V9PC9wPlxuXHRcdFx0XHRcdFx0XHRcdFx0XHQ8cD57cmVzdWx0X25hdmlnYXRpb25baXRlbS5yb2FkV2F5XVswXS5sZWdzWzBdLmR1cmF0aW9uLnRleHR9PC9wPlxuXHRcdFx0XHRcdFx0XHRcdFx0PC9kaXY+XG5cdFx0XHRcdFx0XHRcdFx0KVxuXHRcdFx0XHRcdFx0XHQpXG5cdFx0XHRcdFx0XHRcdC5zZXRNYXhXaWR0aCgnMzAwcHgnKVxuXHRcdFx0XHRcdFx0XHQuYWRkVG8odGhpcy5tYXApO1xuXHRcdFx0XHRcdFx0ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYHBvcHVwLSR7aXRlbS5yb2FkV2F5fWApLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuXHRcdFx0XHRcdFx0XHR0aGlzLnByb3BzLmRpc3BhdGNoKHNlbGVjdFJlc3VsdEFjdGlvbihpdGVtLnJvYWRXYXkpKTtcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0Y29uc3Qgbm9ybWFsaXplQm91bmRzID0gKGJvdW5kcykgPT4ge1xuXHRcdFx0XHRcdFx0XHRjb25zdCBbZmlyc3RQb2ludCwgc2Vjb25kUG9pbnRdID0gYm91bmRzO1xuXG5cdFx0XHRcdFx0XHRcdGNvbnN0IG1pbkxhdCA9IE1hdGgubWluKGZpcnN0UG9pbnRbMV0sIHNlY29uZFBvaW50WzFdKTtcblx0XHRcdFx0XHRcdFx0Y29uc3QgbWF4TGF0ID0gTWF0aC5tYXgoZmlyc3RQb2ludFsxXSwgc2Vjb25kUG9pbnRbMV0pO1xuXG5cdFx0XHRcdFx0XHRcdGNvbnN0IG1pbkxuZyA9IE1hdGgubWluKGZpcnN0UG9pbnRbMF0sIHNlY29uZFBvaW50WzBdKTtcblx0XHRcdFx0XHRcdFx0Y29uc3QgbWF4TG5nID0gTWF0aC5tYXgoZmlyc3RQb2ludFswXSwgc2Vjb25kUG9pbnRbMF0pO1xuXG5cdFx0XHRcdFx0XHRcdHJldHVybiBbXG5cdFx0XHRcdFx0XHRcdFx0W21pbkxuZywgbWluTGF0XSxcblx0XHRcdFx0XHRcdFx0XHRbbWF4TG5nLCBtYXhMYXRdLFxuXHRcdFx0XHRcdFx0XHRdO1xuXHRcdFx0XHRcdFx0fTtcblx0XHRcdFx0XHRcdGNvbnN0IGJvdW5kID0gbm9ybWFsaXplQm91bmRzKFtpdGVtLmNvb3JkaW5hdGVzWzBdLCBpdGVtLmNvb3JkaW5hdGVzW2l0ZW0uY29vcmRpbmF0ZXMubGVuZ3RoIC0gMV1dKTtcblx0XHRcdFx0XHRcdGlmIChpc01vYmlsZSkge1xuXHRcdFx0XHRcdFx0XHR0aGlzLm5hdmlnYXRpb25WaWV3ID0gdGhpcy5tYXAuY2FtZXJhRm9yQm91bmRzKGJvdW5kLCB7XG5cdFx0XHRcdFx0XHRcdFx0cGFkZGluZzogeyB0b3A6IDEwLCBib3R0b206IDI1LCBsZWZ0OiAyNCwgcmlnaHQ6IDI0IH0sXG5cdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0dGhpcy5uYXZpZ2F0aW9uVmlldyA9IHRoaXMubWFwLmNhbWVyYUZvckJvdW5kcyhib3VuZCwge1xuXHRcdFx0XHRcdFx0XHRcdHBhZGRpbmc6IHsgdG9wOiA0MCwgYm90dG9tOiA0MCwgbGVmdDogMjAwLCByaWdodDogNDAgfSxcblx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHR0aGlzLnZpZXcgPSB7XG5cdFx0XHRcdFx0XHRsYXRpdHVkZTogdGhpcy5uYXZpZ2F0aW9uVmlldy5jZW50ZXIubGF0LFxuXHRcdFx0XHRcdFx0bG9uZ2l0dWRlOiB0aGlzLm5hdmlnYXRpb25WaWV3LmNlbnRlci5sbmcsXG5cdFx0XHRcdFx0XHR6b29tOiB0aGlzLm5hdmlnYXRpb25WaWV3Lnpvb20sXG5cdFx0XHRcdFx0fTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLnByb3BzLmRpc3BhdGNoKHNldE1hcFZpZXdwb3J0QWN0aW9uKHRoaXMudmlldykpO1xuXHRcdH1cblx0XHRpZiAoIWVxdWFsKHByZXZQcm9wcy5mcm9tX3BsYWNlLCB0aGlzLnByb3BzLmZyb21fcGxhY2UpKSB7XG5cdFx0XHRjb25zdCBwbGFjZSA9IHRoaXMucHJvcHMuZnJvbV9wbGFjZTtcblx0XHRcdGlmIChwbGFjZSkge1xuXHRcdFx0XHRjb25zdCBwb3B1cCA9IG5ldyBtYXBsaWJyZWdsLlBvcHVwKHtcblx0XHRcdFx0XHRvZmZzZXQ6IFswLCAtMThdLFxuXHRcdFx0XHRcdGNsYXNzTmFtZTogJ3Rvb2x0aXAtbWFya2VyJyxcblx0XHRcdFx0XHRjbG9zZUJ1dHRvbjogZmFsc2UsXG5cdFx0XHRcdH0pXG5cdFx0XHRcdFx0LnNldEhUTUwoYDxkaXYgY2xhc3M9XCJhbnQtdG9vbHRpcC1pbm5lciB0b29sdGlwLWluZm8tbG9jYXRpb25cIj4ke3BsYWNlLm5hbWV9PC9kaXY+YClcblx0XHRcdFx0XHQuc2V0TWF4V2lkdGgoJzE1MHB4Jyk7XG5cdFx0XHRcdGlmICh0aGlzLnN0YXJ0X21hcmtlcikge1xuXHRcdFx0XHRcdHRoaXMuc3RhcnRfbWFya2VyID0gdGhpcy5zdGFydF9tYXJrZXIuc2V0TG5nTGF0KHBsYWNlLmdlb21ldHJ5LmxvY2F0aW9uKS5zZXRQb3B1cChwb3B1cCkuYWRkVG8odGhpcy5tYXApO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNvbnN0IG1hcmtlcl9zdGFydCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXHRcdFx0XHRcdG1hcmtlcl9zdGFydC5pbm5lckhUTUwgPSBSZWFjdERPTVNlcnZlci5yZW5kZXJUb1N0YXRpY01hcmt1cChcblx0XHRcdFx0XHRcdDxkaXYgY2xhc3NOYW1lPVwibWFya2VyLXN0YXJ0XCI+XG5cdFx0XHRcdFx0XHRcdDxpbWdcblx0XHRcdFx0XHRcdFx0XHRzcmM9e2ltYWdlcy5idXR0b259XG5cdFx0XHRcdFx0XHRcdFx0c3R5bGU9e3sgd2lkdGg6IDEyIH19XG5cdFx0XHRcdFx0XHRcdFx0YWx0PVwiXCJcblx0XHRcdFx0XHRcdFx0Lz5cblx0XHRcdFx0XHRcdDwvZGl2PlxuXHRcdFx0XHRcdCk7XG5cdFx0XHRcdFx0dGhpcy5zdGFydF9tYXJrZXIgPSBuZXcgbWFwbGlicmVnbC5NYXJrZXIoe1xuXHRcdFx0XHRcdFx0YW5jaG9yOiAnY2VudGVyJyxcblx0XHRcdFx0XHRcdGVsZW1lbnQ6IG1hcmtlcl9zdGFydCxcblx0XHRcdFx0XHR9KVxuXHRcdFx0XHRcdFx0LnNldFBvcHVwKHBvcHVwKVxuXHRcdFx0XHRcdFx0LnNldExuZ0xhdChwbGFjZS5nZW9tZXRyeS5sb2NhdGlvbilcblx0XHRcdFx0XHRcdC5hZGRUbyh0aGlzLm1hcCk7XG5cdFx0XHRcdFx0dGhpcy5zdGFydF9tYXJrZXIuZ2V0RWxlbWVudCgpLmFkZEV2ZW50TGlzdGVuZXIoJ2NvbnRleHRtZW51JywgKGUpID0+IHtcblx0XHRcdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0XHRjb25zdCBsbmdMYXQgPSB0aGlzLnN0YXJ0X21hcmtlci5nZXRMbmdMYXQoKTtcblx0XHRcdFx0XHRcdHRoaXMucHJvcHMuZGlzcGF0Y2goc2V0UG9wdXBSaWdodENsaWNrKHRydWUsIGxuZ0xhdCwgJ3BvcHVwRnJvbVBsYWNlJykpO1xuXHRcdFx0XHRcdFx0dGhpcy5wcm9wcy5kaXNwYXRjaChzZXRSZWRNYXJrZXJBY3Rpb24oZmFsc2UpKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR0aGlzLnN0YXJ0X21hcmtlci5nZXRFbGVtZW50KCkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7XG5cdFx0XHRcdFx0XHRpZiAocG9wdXAuaXNPcGVuKCkpIHtcblx0XHRcdFx0XHRcdFx0dGhpcy5zdGFydF9tYXJrZXIudG9nZ2xlUG9wdXAoKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR0aGlzLnN0YXJ0X21hcmtlci5nZXRFbGVtZW50KCkuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VlbnRlcicsICgpID0+IHRoaXMuc3RhcnRfbWFya2VyLnRvZ2dsZVBvcHVwKCkpO1xuXHRcdFx0XHRcdHRoaXMuc3RhcnRfbWFya2VyLmdldEVsZW1lbnQoKS5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWxlYXZlJywgKCkgPT4gdGhpcy5zdGFydF9tYXJrZXIudG9nZ2xlUG9wdXAoKSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGlmIChlcXVhbCh0aGlzLnN0YXJ0X21hcmtlci5nZXRMbmdMYXQoKSwgdGhpcy5wcm9wcy5wb3NpdGlvbl9wb3B1cCkpIHtcblx0XHRcdFx0XHR0aGlzLnByb3BzLmRpc3BhdGNoKHNldFBvcHVwUmlnaHRDbGljayhmYWxzZSkpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGlmIChlcXVhbChwcmV2UHJvcHMuZnJvbV9wbGFjZT8ucGxhY2VfaWQsIHRoaXMuc3RhdGUucGxhY2VNb3VzZUNsaWNrPy5wbGFjZV9pZCkpIHtcblx0XHRcdFx0XHR0aGlzLmNoYW5nZVZpc2libGVCb3R0b21JbmZvKGZhbHNlKTtcblx0XHRcdFx0fVxuXHRcdFx0XHR0aGlzLmNoYW5nZVZpc2libGVCb3R0b21JbmZvKGZhbHNlKTtcblx0XHRcdFx0dGhpcy5zdGFydF9tYXJrZXIgPyB0aGlzLnN0YXJ0X21hcmtlci5yZW1vdmUoKSA6IG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCFlcXVhbChwcmV2UHJvcHMudG9fcGxhY2UsIHRoaXMucHJvcHMudG9fcGxhY2UpKSB7XG5cdFx0XHRjb25zdCBwbGFjZSA9IHRoaXMucHJvcHMudG9fcGxhY2U7XG5cdFx0XHRpZiAocGxhY2UpIHtcblx0XHRcdFx0Y29uc3QgcG9wdXAgPSBuZXcgbWFwbGlicmVnbC5Qb3B1cCh7XG5cdFx0XHRcdFx0b2Zmc2V0OiBbMCwgLTE4XSxcblx0XHRcdFx0XHRjbGFzc05hbWU6ICd0b29sdGlwLW1hcmtlcicsXG5cdFx0XHRcdFx0Y2xvc2VCdXR0b246IGZhbHNlLFxuXHRcdFx0XHR9KVxuXHRcdFx0XHRcdC5zZXRIVE1MKGA8ZGl2IGNsYXNzPVwiYW50LXRvb2x0aXAtaW5uZXIgdG9vbHRpcC1pbmZvLWxvY2F0aW9uXCI+JHtwbGFjZS5uYW1lfTwvZGl2PmApXG5cdFx0XHRcdFx0LnNldE1heFdpZHRoKCcxNTBweCcpO1xuXHRcdFx0XHRpZiAodGhpcy5lbmRfbWFya2VyKSB7XG5cdFx0XHRcdFx0dGhpcy50b19wbGFjZSA9IHRoaXMuZW5kX21hcmtlci5zZXRQb3B1cChwb3B1cCkuc2V0TG5nTGF0KHBsYWNlLmdlb21ldHJ5LmxvY2F0aW9uKS5hZGRUbyh0aGlzLm1hcCk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29uc3QgbWFya2VyX2VuZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXHRcdFx0XHRcdG1hcmtlcl9lbmQuaW5uZXJIVE1MID0gUmVhY3RET01TZXJ2ZXIucmVuZGVyVG9TdGF0aWNNYXJrdXAoXG5cdFx0XHRcdFx0XHQ8ZGl2IGNsYXNzTmFtZT1cIm1hcmtlci1lbmRcIj5cblx0XHRcdFx0XHRcdFx0PGRpdj5cblx0XHRcdFx0XHRcdFx0XHQ8aW1nXG5cdFx0XHRcdFx0XHRcdFx0XHRzcmM9e2ltYWdlcy5tYXJrZXJ9XG5cdFx0XHRcdFx0XHRcdFx0XHRhbHQ9XCJcIlxuXHRcdFx0XHRcdFx0XHRcdC8+XG5cdFx0XHRcdFx0XHRcdDwvZGl2PlxuXHRcdFx0XHRcdFx0PC9kaXY+XG5cdFx0XHRcdFx0KTtcblx0XHRcdFx0XHR0aGlzLmVuZF9tYXJrZXIgPSBuZXcgbWFwbGlicmVnbC5NYXJrZXIoe1xuXHRcdFx0XHRcdFx0YW5jaG9yOiAnY2VudGVyJyxcblx0XHRcdFx0XHRcdGVsZW1lbnQ6IG1hcmtlcl9lbmQsXG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0XHRcdC5zZXRQb3B1cChwb3B1cClcblx0XHRcdFx0XHRcdC5zZXRMbmdMYXQocGxhY2UuZ2VvbWV0cnkubG9jYXRpb24pXG5cdFx0XHRcdFx0XHQuYWRkVG8odGhpcy5tYXApO1xuXHRcdFx0XHRcdHRoaXMuZW5kX21hcmtlci5nZXRFbGVtZW50KCkuYWRkRXZlbnRMaXN0ZW5lcignY29udGV4dG1lbnUnLCAoZSkgPT4ge1xuXHRcdFx0XHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHRcdGNvbnN0IGxuZ0xhdCA9IHRoaXMuZW5kX21hcmtlci5nZXRMbmdMYXQoKTtcblx0XHRcdFx0XHRcdHRoaXMucHJvcHMuZGlzcGF0Y2goc2V0UG9wdXBSaWdodENsaWNrKHRydWUsIGxuZ0xhdCwgJ3BvcHVwVG9QbGFjZScpKTtcblx0XHRcdFx0XHRcdHRoaXMucHJvcHMuZGlzcGF0Y2goc2V0UmVkTWFya2VyQWN0aW9uKGZhbHNlKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0dGhpcy5lbmRfbWFya2VyLmdldEVsZW1lbnQoKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcblx0XHRcdFx0XHRcdGlmIChwb3B1cC5pc09wZW4oKSkge1xuXHRcdFx0XHRcdFx0XHR0aGlzLmVuZF9tYXJrZXIudG9nZ2xlUG9wdXAoKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR0aGlzLmVuZF9tYXJrZXIuZ2V0RWxlbWVudCgpLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlZW50ZXInLCAoKSA9PiB0aGlzLmVuZF9tYXJrZXIudG9nZ2xlUG9wdXAoKSk7XG5cdFx0XHRcdFx0dGhpcy5lbmRfbWFya2VyLmdldEVsZW1lbnQoKS5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWxlYXZlJywgKCkgPT4gdGhpcy5lbmRfbWFya2VyLnRvZ2dsZVBvcHVwKCkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRpZiAoZXF1YWwodGhpcy5zdGFydF9tYXJrZXI/LmdldExuZ0xhdCgpLCB0aGlzLnByb3BzLnBvc2l0aW9uX3BvcHVwKSkge1xuXHRcdFx0XHRcdHRoaXMucHJvcHMuZGlzcGF0Y2goc2V0UG9wdXBSaWdodENsaWNrKGZhbHNlKSk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoZXF1YWwocHJldlByb3BzLnRvX3BsYWNlPy5wbGFjZV9pZCwgdGhpcy5zdGF0ZS5wbGFjZU1vdXNlQ2xpY2s/LnBsYWNlX2lkKSkge1xuXHRcdFx0XHRcdHRoaXMuY2hhbmdlVmlzaWJsZUJvdHRvbUluZm8oZmFsc2UpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHRoaXMuZW5kX21hcmtlciA/IHRoaXMuZW5kX21hcmtlci5yZW1vdmUoKSA6IG51bGw7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKCFlcXVhbChwcmV2UHJvcHMuYXJvdW5kX3BsYWNlcywgdGhpcy5wcm9wcy5hcm91bmRfcGxhY2VzKSB8fCAhZXF1YWwocHJldlByb3BzLmFyb3VuZF9wbGFjZV9zZWxlY3QsIHRoaXMucHJvcHMuYXJvdW5kX3BsYWNlX3NlbGVjdCkpIHtcblx0XHRcdGlmICh0aGlzLmxpc3RfbWFya2VyX2Fyb3VuZD8ubGVuZ3RoID4gMCkge1xuXHRcdFx0XHR0aGlzLmxpc3RfbWFya2VyX2Fyb3VuZC5mb3JFYWNoKChpdGVtKSA9PiB7XG5cdFx0XHRcdFx0aXRlbS5yZW1vdmUoKTtcblx0XHRcdFx0fSk7XG5cdFx0XHRcdHRoaXMubGlzdF9tYXJrZXJfYXJvdW5kID0gW107XG5cdFx0XHR9XG5cdFx0XHRjb25zdCB7IGFyb3VuZF9wbGFjZXMsIGFyb3VuZF9wbGFjZV9jZW50ZXIgfSA9IHRoaXMucHJvcHM7XG5cdFx0XHRpZiAoYXJvdW5kX3BsYWNlcy5sZW5ndGggPiAwKSB7XG5cdFx0XHRcdHRoaXMubGlzdF9tYXJrZXJfYXJvdW5kID0gW107XG5cdFx0XHRcdGxldCBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXHRcdFx0XHRlbC5pbm5lckhUTUwgPSBSZWFjdERPTVNlcnZlci5yZW5kZXJUb1N0YXRpY01hcmt1cChcblx0XHRcdFx0XHQ8TWFya2VyXG5cdFx0XHRcdFx0XHRpZD1cIm1hcmtlci1jZW50ZXJcIlxuXHRcdFx0XHRcdFx0dHlwZT1cImNlbnRlclwiXG5cdFx0XHRcdFx0Lz5cblx0XHRcdFx0KTtcblx0XHRcdFx0dGhpcy5saXN0X21hcmtlcl9hcm91bmRbMF0gPSBuZXcgbWFwbGlicmVnbC5NYXJrZXIoZWwsIHtcblx0XHRcdFx0XHRhbmNob3I6ICdib3R0b20nLFxuXHRcdFx0XHR9KVxuXHRcdFx0XHRcdC5zZXRQb3B1cChcblx0XHRcdFx0XHRcdG5ldyBtYXBsaWJyZWdsLlBvcHVwKHtcblx0XHRcdFx0XHRcdFx0b2Zmc2V0OiBbMCwgLTMyXSxcblx0XHRcdFx0XHRcdFx0Y2xhc3NOYW1lOiAndG9vbHRpcC1tYXJrZXInLFxuXHRcdFx0XHRcdFx0XHRjbG9zZUJ1dHRvbjogZmFsc2UsXG5cdFx0XHRcdFx0XHR9KVxuXHRcdFx0XHRcdFx0XHQuc2V0SFRNTChgPGRpdiBjbGFzcz1cImFudC10b29sdGlwLWlubmVyIHRvb2x0aXAtaW5mby1sb2NhdGlvblwiPiR7YXJvdW5kX3BsYWNlX2NlbnRlci5uYW1lfTwvZGl2PmApXG5cdFx0XHRcdFx0XHRcdC5zZXRNYXhXaWR0aCgnMTUwcHgnKVxuXHRcdFx0XHRcdClcblx0XHRcdFx0XHQuc2V0TG5nTGF0KGFyb3VuZF9wbGFjZV9jZW50ZXIuZ2VvbWV0cnkubG9jYXRpb24pXG5cdFx0XHRcdFx0LmFkZFRvKHRoaXMubWFwKTtcblx0XHRcdFx0Y29uc3QgbWFya2VyQ2VudGVyRGl2ID0gdGhpcy5saXN0X21hcmtlcl9hcm91bmRbMF0uZ2V0RWxlbWVudCgpO1xuXG5cdFx0XHRcdG1hcmtlckNlbnRlckRpdi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcblx0XHRcdFx0XHR0aGlzLl9zZWxlY3RBcm91bmRQbGFjZSgnY2VudGVyJywgYXJvdW5kX3BsYWNlX2NlbnRlcik7XG5cdFx0XHRcdFx0dGhpcy5wcm9wcy5kaXNwYXRjaChzZXRSZWRNYXJrZXJBY3Rpb24oZmFsc2UpKTtcblx0XHRcdFx0XHRpZiAodGhpcy5saXN0X21hcmtlcl9hcm91bmRbMF0uZ2V0UG9wdXAoKS5pc09wZW4oKSkge1xuXHRcdFx0XHRcdFx0dGhpcy5saXN0X21hcmtlcl9hcm91bmRbMF0udG9nZ2xlUG9wdXAoKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdG1hcmtlckNlbnRlckRpdi5hZGRFdmVudExpc3RlbmVyKCdjb250ZXh0bWVudScsIChlKSA9PiB7XG5cdFx0XHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0dGhpcy5wcm9wcy5kaXNwYXRjaChzZXRSZWRNYXJrZXJBY3Rpb24oZmFsc2UpKTtcblx0XHRcdFx0XHR0aGlzLnByb3BzLmRpc3BhdGNoKHNldFBvcHVwUmlnaHRDbGljayh0cnVlLCBhcm91bmRfcGxhY2VfY2VudGVyLmdlb21ldHJ5LmxvY2F0aW9uLCAnbm9ybWFsJykpO1xuXHRcdFx0XHR9KTtcblxuXHRcdFx0XHRtYXJrZXJDZW50ZXJEaXYuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VlbnRlcicsICgpID0+IHRoaXMubGlzdF9tYXJrZXJfYXJvdW5kWzBdLnRvZ2dsZVBvcHVwKCkpO1xuXHRcdFx0XHRtYXJrZXJDZW50ZXJEaXYuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VsZWF2ZScsICgpID0+IHRoaXMubGlzdF9tYXJrZXJfYXJvdW5kWzBdLnRvZ2dsZVBvcHVwKCkpO1xuXG5cdFx0XHRcdGFyb3VuZF9wbGFjZXMuZm9yRWFjaCgoaXRlbSwgaSkgPT4ge1xuXHRcdFx0XHRcdGNvbnN0IHBvcHVwID0gbmV3IG1hcGxpYnJlZ2wuUG9wdXAoe1xuXHRcdFx0XHRcdFx0b2Zmc2V0OiBbMCwgLTMyXSxcblx0XHRcdFx0XHRcdGNsYXNzTmFtZTogJ3Rvb2x0aXAtbWFya2VyJyxcblx0XHRcdFx0XHRcdGNsb3NlQnV0dG9uOiBmYWxzZSxcblx0XHRcdFx0XHRcdGFuY2hvcjogJ2JvdHRvbScsXG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0XHRcdC5zZXRIVE1MKGA8ZGl2IGNsYXNzPVwiYW50LXRvb2x0aXAtaW5uZXIgdG9vbHRpcC1pbmZvLWxvY2F0aW9uXCI+JHtpdGVtLm5hbWV9PC9kaXY+YClcblx0XHRcdFx0XHRcdC5zZXRNYXhXaWR0aCgnMTUwcHgnKTtcblx0XHRcdFx0XHRlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXHRcdFx0XHRcdGVsLmlubmVySFRNTCA9IFJlYWN0RE9NU2VydmVyLnJlbmRlclRvU3RhdGljTWFya3VwKFxuXHRcdFx0XHRcdFx0PE1hcmtlclxuXHRcdFx0XHRcdFx0XHR0eXBlPVwiYXJvdW5kXCJcblx0XHRcdFx0XHRcdFx0cGxhY2U9e2l0ZW19XG5cdFx0XHRcdFx0XHRcdHBsYWNlX3NlbGVjdD17dGhpcy5wcm9wcy5hcm91bmRfcGxhY2Vfc2VsZWN0fVxuXHRcdFx0XHRcdFx0XHRpZD17YG1hcmtlci1hcm91bmQtJHtpfWB9XG5cdFx0XHRcdFx0XHQvPlxuXHRcdFx0XHRcdCk7XG5cdFx0XHRcdFx0dGhpcy5saXN0X21hcmtlcl9hcm91bmQucHVzaChcblx0XHRcdFx0XHRcdG5ldyBtYXBsaWJyZWdsLk1hcmtlcihlbCwgeyBhbmNob3I6ICdib3R0b20nIH0pXG5cdFx0XHRcdFx0XHRcdC5zZXRQb3B1cChwb3B1cClcblx0XHRcdFx0XHRcdFx0LnNldExuZ0xhdChbaXRlbS5sbmdfbGF0WzBdICogMSwgaXRlbS5sbmdfbGF0WzFdICogMV0pXG5cdFx0XHRcdFx0XHRcdC5hZGRUbyh0aGlzLm1hcClcblx0XHRcdFx0XHQpO1xuXHRcdFx0XHRcdGNvbnN0IG1hcmtlckRpdiA9IHRoaXMubGlzdF9tYXJrZXJfYXJvdW5kW2kgKyAxXS5nZXRFbGVtZW50KCk7XG5cblx0XHRcdFx0XHRtYXJrZXJEaXYuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuXHRcdFx0XHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0XHRcdHRoaXMucHJvcHMuZGlzcGF0Y2goc2V0UmVkTWFya2VyQWN0aW9uKGZhbHNlKSk7XG5cdFx0XHRcdFx0XHR0aGlzLl9zZWxlY3RBcm91bmRQbGFjZSgnYXJvdW5kJywgaXRlbSk7XG5cdFx0XHRcdFx0XHRpZiAocG9wdXAuaXNPcGVuKCkpIHtcblx0XHRcdFx0XHRcdFx0dGhpcy5saXN0X21hcmtlcl9hcm91bmRbaSArIDFdLnRvZ2dsZVBvcHVwKCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRtYXJrZXJEaXYuYWRkRXZlbnRMaXN0ZW5lcignY29udGV4dG1lbnUnLCAoZSkgPT4ge1xuXHRcdFx0XHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHRcdHRoaXMucHJvcHMuZGlzcGF0Y2goc2V0UG9wdXBSaWdodENsaWNrKHRydWUsIHsgbG5nOiBpdGVtLmxuZ19sYXRbMF0gKiAxLCBsYXQ6IGl0ZW0ubG5nX2xhdFsxXSAqIDEgfSwgJ2Fyb3VuZCcpKTtcblx0XHRcdFx0XHRcdHRoaXMucHJvcHMuZGlzcGF0Y2goc2V0UmVkTWFya2VyQWN0aW9uKGZhbHNlKSk7XG5cdFx0XHRcdFx0fSk7XG5cblx0XHRcdFx0XHRtYXJrZXJEaXYuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VlbnRlcicsICgpID0+IHRoaXMubGlzdF9tYXJrZXJfYXJvdW5kW2kgKyAxXS50b2dnbGVQb3B1cCgpKTtcblx0XHRcdFx0XHRtYXJrZXJEaXYuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VsZWF2ZScsICgpID0+IHRoaXMubGlzdF9tYXJrZXJfYXJvdW5kW2kgKyAxXS50b2dnbGVQb3B1cCgpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMucHJvcHMuYm94VmlzaWJsZSA9PT0gJ2luZm8nICYmIHRoaXMucHJvcHMuY3VycmVudF9wbGFjZSkge1xuXHRcdFx0aWYgKCF0aGlzLm1hcmtlckN1cnJlbnRQbGFjZSkge1xuXHRcdFx0XHRjb25zdCBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXHRcdFx0XHRlbC5pbm5lckhUTUwgPSBSZWFjdERPTVNlcnZlci5yZW5kZXJUb1N0YXRpY01hcmt1cChcblx0XHRcdFx0XHQvLyA8TWFya2VyIHR5cGU9XCJub3JtYWxcIiAvPlxuXHRcdFx0XHRcdDxkaXYgY2xhc3NOYW1lPVwibWFya2VyLWhpc3Rvcmllc1wiPlxuXHRcdFx0XHRcdFx0PGRpdj5cblx0XHRcdFx0XHRcdFx0PGltZ1xuXHRcdFx0XHRcdFx0XHRcdHNyYz17aW1hZ2VzLm1hcmtlcn1cblx0XHRcdFx0XHRcdFx0XHRhbHQ9XCJcIlxuXHRcdFx0XHRcdFx0XHQvPlxuXHRcdFx0XHRcdFx0PC9kaXY+XG5cdFx0XHRcdFx0PC9kaXY+XG5cdFx0XHRcdCk7XG5cdFx0XHRcdC8vIE1hcmtlciBpbmZvXG5cdFx0XHRcdHRoaXMubWFya2VyQ3VycmVudFBsYWNlID0gbmV3IG1hcGxpYnJlZ2wuTWFya2VyKHtcblx0XHRcdFx0XHRhbmNob3I6ICdib3R0b20nLFxuXHRcdFx0XHRcdGVsZW1lbnQ6IGVsLFxuXHRcdFx0XHR9KVxuXHRcdFx0XHRcdC5zZXRMbmdMYXQodGhpcy5wcm9wcy5jdXJyZW50X3BsYWNlPy5nZW9tZXRyeT8ubG9jYXRpb24pXG5cdFx0XHRcdFx0LmFkZFRvKHRoaXMubWFwKTtcblx0XHRcdFx0dGhpcy5tYXJrZXJDdXJyZW50UGxhY2UuZ2V0RWxlbWVudCgpLmFkZEV2ZW50TGlzdGVuZXIoJ2NvbnRleHRtZW51JywgKGUpID0+IHtcblx0XHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHRjb25zdCBsbmdMYXQgPSB0aGlzLm1hcmtlckN1cnJlbnRQbGFjZS5nZXRMbmdMYXQoKTtcblx0XHRcdFx0XHR0aGlzLnByb3BzLmRpc3BhdGNoKHNldFBvcHVwUmlnaHRDbGljayh0cnVlLCBsbmdMYXQsICdwb3B1cEN1cnJlbnRQbGFjZScpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLm1hcmtlckN1cnJlbnRQbGFjZS5zZXRMbmdMYXQodGhpcy5wcm9wcy5jdXJyZW50X3BsYWNlLmdlb21ldHJ5LmxvY2F0aW9uKS5hZGRUbyh0aGlzLm1hcCk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMucHJvcHMuYm94VmlzaWJsZSAhPT0gJ2luZm8nICYmIHRoaXMubWFya2VyQ3VycmVudFBsYWNlKSB7XG5cdFx0XHR0aGlzLm1hcmtlckN1cnJlbnRQbGFjZS5yZW1vdmUoKTtcblx0XHRcdHRoaXMubWFya2VyQ3VycmVudFBsYWNlID0gbnVsbDtcblx0XHR9XG5cdFx0aWYgKHRoaXMucHJvcHMuYm94VmlzaWJsZSA9PT0gJ2RldGFpbHNyZXN0YXVyYW50JyAmJiB0aGlzLnByb3BzLnJlc3RhdXJhbnREYXRhKSB7XG5cdFx0XHRpZiAodGhpcy5wcm9wcy5yZXN0YXVyYW50RGF0YS5sZW5ndGggIT09IDApIHtcblx0XHRcdFx0Zm9yIChsZXQgaXRlbSBvZiB0aGlzLnByb3BzLnJlc3RhdXJhbnREYXRhKSB7XG5cdFx0XHRcdFx0Y29uc3QgbWFya2VyX3Jlc3RhdXJhbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblx0XHRcdFx0XHRtYXJrZXJfcmVzdGF1cmFudC5pbm5lckhUTUwgPSBSZWFjdERPTVNlcnZlci5yZW5kZXJUb1N0YXRpY01hcmt1cChcblx0XHRcdFx0XHRcdC8vIDxNYXJrZXJOYXZpZ2F0aW9uIGlkPVwiZW5kLW1hcmtlclwiIHR5cGU9XCJoaXN0b3JpZXNcIiAvPlxuXHRcdFx0XHRcdFx0PGRpdiBjbGFzc05hbWU9XCJtYXJrZXItaGlzdG9yaWVzXCI+XG5cdFx0XHRcdFx0XHRcdDxkaXY+XG5cdFx0XHRcdFx0XHRcdFx0PGltZ1xuXHRcdFx0XHRcdFx0XHRcdFx0c3JjPXtpbWFnZXMubWFya2VyfVxuXHRcdFx0XHRcdFx0XHRcdFx0YWx0PVwiXCJcblx0XHRcdFx0XHRcdFx0XHQvPlxuXHRcdFx0XHRcdFx0XHQ8L2Rpdj5cblx0XHRcdFx0XHRcdDwvZGl2PlxuXHRcdFx0XHRcdCk7XG5cdFx0XHRcdFx0dGhpcy5yZXN0YXVyYW50X21hcmtlciA9IG5ldyBtYXBsaWJyZWdsLk1hcmtlcih7XG5cdFx0XHRcdFx0XHRhbmNob3I6ICdjZW50ZXInLFxuXHRcdFx0XHRcdFx0ZWxlbWVudDogbWFya2VyX3Jlc3RhdXJhbnQsXG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0XHRcdC8vIC5zZXRQb3B1cChwb3B1cClcblx0XHRcdFx0XHRcdC5zZXRMbmdMYXQoaXRlbS5nZW9tZXRyeS5sb2NhdGlvbilcblx0XHRcdFx0XHRcdC5hZGRUbyh0aGlzLm1hcCk7XG5cdFx0XHRcdFx0dGhpcy5saXN0UmVzdGF1cmFudC5wdXNoKHRoaXMucmVzdGF1cmFudF9tYXJrZXIpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQvLyBjb25zb2xlLmxvZygnQ8OzJylcblx0XHRcdFx0Zm9yIChsZXQgbWFya2VyIG9mIHRoaXMubGlzdFJlc3RhdXJhbnQpIHtcblx0XHRcdFx0XHRtYXJrZXIucmVtb3ZlKCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0dGhpcy5saXN0UmVzdGF1cmFudCA9IFtdO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmICh0aGlzLnByb3BzLmJveFZpc2libGUgPT09ICdoaXN0b3J5Jykge1xuXHRcdFx0Zm9yIChsZXQgbWFya2VyIG9mIHRoaXMubGlzdEhpc3Rvcmllcykge1xuXHRcdFx0XHRtYXJrZXIucmVtb3ZlKCk7XG5cdFx0XHR9XG5cdFx0XHRmb3IgKGxldCBpdGVtIG9mIHRoaXMucHJvcHMuc2VhcmNoTG9jYWxTdG9yYWdlKSB7XG5cdFx0XHRcdGNvbnN0IG1hcmtlcl9oaXN0b3J5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG5cdFx0XHRcdG1hcmtlcl9oaXN0b3J5LmlubmVySFRNTCA9IFJlYWN0RE9NU2VydmVyLnJlbmRlclRvU3RhdGljTWFya3VwKFxuXHRcdFx0XHRcdDxkaXYgY2xhc3NOYW1lPVwibWFya2VyLWhpc3Rvcmllc1wiPlxuXHRcdFx0XHRcdFx0PGRpdj5cblx0XHRcdFx0XHRcdFx0PGltZ1xuXHRcdFx0XHRcdFx0XHRcdHNyYz17aW1hZ2VzLm1hcmtlcn1cblx0XHRcdFx0XHRcdFx0XHRhbHQ9XCJcIlxuXHRcdFx0XHRcdFx0XHQvPlxuXHRcdFx0XHRcdFx0PC9kaXY+XG5cdFx0XHRcdFx0PC9kaXY+XG5cdFx0XHRcdCk7XG5cdFx0XHRcdHRoaXMuaGlzdG9yeV9tYXJrZXIgPSBuZXcgbWFwbGlicmVnbC5NYXJrZXIoe1xuXHRcdFx0XHRcdGFuY2hvcjogJ2NlbnRlcicsXG5cdFx0XHRcdFx0ZWxlbWVudDogbWFya2VyX2hpc3RvcnksXG5cdFx0XHRcdH0pXG5cdFx0XHRcdFx0LnNldExuZ0xhdChpdGVtLmxvY2F0aW9uKVxuXHRcdFx0XHRcdC5hZGRUbyh0aGlzLm1hcCk7XG5cdFx0XHRcdHRoaXMubGlzdEhpc3Rvcmllcy5wdXNoKHRoaXMuaGlzdG9yeV9tYXJrZXIpO1xuXHRcdFx0fVxuXHRcdH0gZWxzZSB7XG5cdFx0XHRmb3IgKGxldCBtYXJrZXIgb2YgdGhpcy5saXN0SGlzdG9yaWVzKSB7XG5cdFx0XHRcdG1hcmtlci5yZW1vdmUoKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHQvLyBpZiAodGhpcy5wcm9wcy5ib3hWaXNpYmxlID09PSBcImRldGFpbHNcIikge1xuXHRcdGlmICh0aGlzLnByb3BzLnJlc3VsdF9uYXZpZ2F0aW9uICYmIHRoaXMucHJvcHMuYm94VmlzaWJsZSA9PT0gJ2RldGFpbHMnKSB7XG5cdFx0XHRmb3IgKGxldCBzdGVwIG9mIHRoaXMucHJvcHMucmVzdWx0X25hdmlnYXRpb24uZmFzdGVzdFswXS5sZWdzWzBdLnN0ZXBzKSB7XG5cdFx0XHRcdGNvbnN0IHBvcHVwID0gbmV3IG1hcGxpYnJlZ2wuUG9wdXAoeyBvZmZzZXQ6IFswLCAtMzJdLCBjbGFzc05hbWU6ICd0b29sdGlwLW1hcmtlcicsIGNsb3NlQnV0dG9uOiBmYWxzZSwgYW5jaG9yOiAnYm90dG9tJyB9KS5zZXRIVE1MKGA8ZGl2IGNsYXNzPVwiYW50LXRvb2x0aXAtaW5uZXIgdG9vbHRpcC1pbmZvLWxvY2F0aW9uXCI+JHtzdGVwLmh0bWxfaW5zdHJ1Y3Rpb25zfTwvZGl2PmApLnNldE1heFdpZHRoKCcxNTBweCcpO1xuXHRcdFx0XHRjb25zdCBtYXJrZXJfc3RlcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXHRcdFx0XHRtYXJrZXJfc3RlcC5pbm5lckhUTUwgPSBSZWFjdERPTVNlcnZlci5yZW5kZXJUb1N0YXRpY01hcmt1cCg8ZGl2IGNsYXNzTmFtZT1cIm1hcmtlci1kZXRhaWxzXCI+PC9kaXY+KTtcblx0XHRcdFx0dGhpcy5zdGVwX21hcmtlciA9IG5ldyBtYXBsaWJyZWdsLk1hcmtlcih7IGFuY2hvcjogJ2NlbnRlcicsIGVsZW1lbnQ6IG1hcmtlcl9zdGVwIH0pLnNldFBvcHVwKHBvcHVwKS5zZXRMbmdMYXQoc3RlcC5lbmRfbG9jYXRpb24pLmFkZFRvKHRoaXMubWFwKTtcblx0XHRcdFx0dGhpcy5saXN0LnB1c2godGhpcy5zdGVwX21hcmtlcik7XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdGZvciAobGV0IG1hcmtlciBvZiB0aGlzLmxpc3QpIHtcblx0XHRcdFx0bWFya2VyLnJlbW92ZSgpO1xuXHRcdFx0fVxuXHRcdFx0dGhpcy5saXN0ID0gW107XG5cdFx0fVxuXHRcdC8vIH1cblx0XHRpZiAodGhpcy5wcm9wcy5ib3hWaXNpYmxlID09PSAnbmF2aWdhdGlvbicgJiYgaXNNb2JpbGUpIHtcblx0XHRcdGlmICh0aGlzLnByb3BzLnJlc3VsdF9uYXZpZ2F0aW9uKSB7XG5cdFx0XHRcdGZvciAobGV0IHN0ZXAgb2YgdGhpcy5wcm9wcy5yZXN1bHRfbmF2aWdhdGlvbi5mYXN0ZXN0WzBdLmxlZ3NbMF0uc3RlcHMpIHtcblx0XHRcdFx0XHRjb25zdCBwb3B1cCA9IG5ldyBtYXBsaWJyZWdsLlBvcHVwKHsgb2Zmc2V0OiBbMCwgLTMyXSwgY2xhc3NOYW1lOiAndG9vbHRpcC1tYXJrZXInLCBjbG9zZUJ1dHRvbjogZmFsc2UsIGFuY2hvcjogJ2JvdHRvbScgfSkuc2V0SFRNTChgPGRpdiBjbGFzcz1cImFudC10b29sdGlwLWlubmVyIHRvb2x0aXAtaW5mby1sb2NhdGlvblwiPiR7c3RlcC5odG1sX2luc3RydWN0aW9uc308L2Rpdj5gKS5zZXRNYXhXaWR0aCgnMTUwcHgnKTtcblx0XHRcdFx0XHRjb25zdCBtYXJrZXJfc3RlcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXHRcdFx0XHRcdG1hcmtlcl9zdGVwLmlubmVySFRNTCA9IFJlYWN0RE9NU2VydmVyLnJlbmRlclRvU3RhdGljTWFya3VwKDxkaXYgY2xhc3NOYW1lPVwibWFya2VyLWRldGFpbHNcIj48L2Rpdj4pO1xuXHRcdFx0XHRcdHRoaXMuc3RlcF9tYXJrZXIgPSBuZXcgbWFwbGlicmVnbC5NYXJrZXIoeyBhbmNob3I6ICdjZW50ZXInLCBlbGVtZW50OiBtYXJrZXJfc3RlcCB9KS5zZXRQb3B1cChwb3B1cCkuc2V0TG5nTGF0KHN0ZXAuZW5kX2xvY2F0aW9uKS5hZGRUbyh0aGlzLm1hcCk7XG5cdFx0XHRcdFx0dGhpcy5saXN0LnB1c2godGhpcy5zdGVwX21hcmtlcik7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGZvciAobGV0IG1hcmtlciBvZiB0aGlzLmxpc3QpIHtcblx0XHRcdFx0XHRtYXJrZXIucmVtb3ZlKCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0dGhpcy5saXN0ID0gW107XG5cdFx0XHR9XG5cdFx0fVxuXHR9XG5cblx0ZGVjb2RlUG9seWxpbmUoZW5jb2RlZCkge1xuXHRcdHZhciBwb2ludHMgPSBbXTtcblx0XHR2YXIgaW5kZXggPSAwLFxuXHRcdFx0bGVuID0gZW5jb2RlZC5sZW5ndGg7XG5cdFx0dmFyIGxhdCA9IDAsXG5cdFx0XHRsbmcgPSAwO1xuXG5cdFx0d2hpbGUgKGluZGV4IDwgbGVuKSB7XG5cdFx0XHR2YXIgYixcblx0XHRcdFx0c2hpZnQgPSAwLFxuXHRcdFx0XHRyZXN1bHQgPSAwO1xuXHRcdFx0ZG8ge1xuXHRcdFx0XHRiID0gZW5jb2RlZC5jaGFyQXQoaW5kZXgrKykuY2hhckNvZGVBdCgwKSAtIDYzO1xuXHRcdFx0XHRyZXN1bHQgfD0gKGIgJiAweDFmKSA8PCBzaGlmdDtcblx0XHRcdFx0c2hpZnQgKz0gNTtcblx0XHRcdH0gd2hpbGUgKGIgPj0gMHgyMCk7XG5cdFx0XHR2YXIgZGxhdCA9IHJlc3VsdCAmIDEgPyB+KHJlc3VsdCA+PiAxKSA6IHJlc3VsdCA+PiAxO1xuXHRcdFx0bGF0ICs9IGRsYXQ7XG5cblx0XHRcdHNoaWZ0ID0gMDtcblx0XHRcdHJlc3VsdCA9IDA7XG5cdFx0XHRkbyB7XG5cdFx0XHRcdGIgPSBlbmNvZGVkLmNoYXJBdChpbmRleCsrKS5jaGFyQ29kZUF0KDApIC0gNjM7XG5cdFx0XHRcdHJlc3VsdCB8PSAoYiAmIDB4MWYpIDw8IHNoaWZ0O1xuXHRcdFx0XHRzaGlmdCArPSA1O1xuXHRcdFx0fSB3aGlsZSAoYiA+PSAweDIwKTtcblx0XHRcdHZhciBkbG5nID0gcmVzdWx0ICYgMSA/IH4ocmVzdWx0ID4+IDEpIDogcmVzdWx0ID4+IDE7XG5cdFx0XHRsbmcgKz0gZGxuZztcblxuXHRcdFx0cG9pbnRzLnB1c2goW2xuZyAqIDFlLTUsIGxhdCAqIDFlLTVdKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gcG9pbnRzO1xuXHR9XG5cblx0Y2hhbmdlU3R5bGUgPSAoKSA9PiB7XG5cdFx0Y29uc3QgeyBzdHlsZSB9ID0gdGhpcy5zdGF0ZTtcblx0XHRpZiAoc3R5bGUgPT09IFNUWUxFX1VSTC5TQVRFTElURSArIFNUWUxFX0tFWSkge1xuXHRcdFx0dGhpcy5zZXRTdGF0ZSh7XG5cdFx0XHRcdHN0eWxlOiBTVFlMRV9VUkwuTk9STUFMICsgU1RZTEVfS0VZLFxuXHRcdFx0fSk7XG5cdFx0XHR0aGlzLm1hcC5zZXRTdHlsZShTVFlMRV9VUkwuTk9STUFMICsgU1RZTEVfS0VZKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dGhpcy5zZXRTdGF0ZSh7XG5cdFx0XHRcdHN0eWxlOiBTVFlMRV9VUkwuU0FURUxJVEUgKyBTVFlMRV9LRVksXG5cdFx0XHR9KTtcblx0XHRcdHRoaXMubWFwLnNldFN0eWxlKFNUWUxFX1VSTC5TQVRFTElURSArIFNUWUxFX0tFWSk7XG5cdFx0fVxuXHR9O1xuXG5cdGNvbXBvbmVudERpZE1vdW50KCkge1xuXHRcdHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdzdG9yYWdlJywgdGhpcy5oYW5kbGVTdG9yYWdlQ2hhbmdlKTtcblx0XHQvLyBjb25zb2xlLmxvZyhTVFlMRV9VUkwuTk9STUFMKVxuXHRcdGNvbnN0IHNlbGVjdGVkUGxhY2UgPSB0aGlzLnByb3BzLmN1cnJlbnRfcGxhY2U7XG5cdFx0dGhpcy5tYXAgPSBuZXcgbWFwbGlicmVnbC5NYXAoe1xuXHRcdFx0Y29udGFpbmVyOiAnbWFwJywgLy8gY29udGFpbmVyIGlkXG5cdFx0XHRzdHlsZTogU1RZTEVfVVJMLk5PUk1BTCArIFNUWUxFX0tFWSxcblx0XHRcdGNlbnRlcjogc2VsZWN0ZWRQbGFjZSA/IFtzZWxlY3RlZFBsYWNlLmdlb21ldHJ5LmxvY2F0aW9uLmxuZywgc2VsZWN0ZWRQbGFjZS5nZW9tZXRyeS5sb2NhdGlvbi5sYXRdIDogW0RFRkFVTFRfVklFV1BPUlQubG9uZ2l0dWRlLCBERUZBVUxUX1ZJRVdQT1JULmxhdGl0dWRlXSwgLy8gc3RhcnRpbmcgcG9zaXRpb24gW2xuZywgbGF0XVxuXHRcdFx0em9vbTogREVGQVVMVF9WSUVXUE9SVC56b29tLCAvLyBzdGFydGluZyB6b29tXG5cdFx0fSk7XG5cdFx0aWYgKHNlbGVjdGVkUGxhY2UpIHRoaXMucHJvcHMuZGlzcGF0Y2goc2V0UmVkTWFya2VyQWN0aW9uKHRydWUsIHNlbGVjdGVkUGxhY2UuZ2VvbWV0cnkubG9jYXRpb24pKTtcblxuXHRcdHRoaXMubmF2aWdhdGlvbiA9IG5ldyBtYXBsaWJyZWdsLk5hdmlnYXRpb25Db250cm9sKCk7XG5cdFx0dGhpcy5nZW9sb2NhdGVDb250cm9sID0gbmV3IG1hcGxpYnJlZ2wuR2VvbG9jYXRlQ29udHJvbCh7XG5cdFx0XHRwb3NpdGlvbk9wdGlvbnM6IHtcblx0XHRcdFx0ZW5hYmxlSGlnaEFjY3VyYWN5OiB0cnVlLFxuXHRcdFx0fSxcblx0XHRcdC8vIELhuq10IHThuq90IGhp4buDbiBi4buLIHbhu4sgdHLDrVxuXHRcdFx0dHJhY2tVc2VyTG9jYXRpb246IHRydWUsXG5cdFx0XHQvLyBIaeG7g24gdGjhu4tcblx0XHRcdHNob3dVc2VyTG9jYXRpb246IHRydWUsXG5cdFx0XHQvLyBU4bqvdCB2w7JuZyB0csOybiB0b1xuXHRcdFx0c2hvd0FjY3VyYWN5Q2lyY2xlOiBmYWxzZSxcblx0XHRcdC8vIMSQaeG7gXUgY2jhu4luaCBt4bupYyB6b29tIMSR4bq/biB24buLIHRyw60gY+G7p2EgbcOsbmhcblx0XHRcdGZpdEJvdW5kc09wdGlvbnM6IHtcblx0XHRcdFx0bWF4Wm9vbTogMTUsXG5cdFx0XHR9LFxuXHRcdH0pO1xuXG5cdFx0dGhpcy5nZW9sb2NhdGVDb250cm9sLm9uKCdlcnJvcicsICgpID0+IHtcblx0XHRcdG1lc3NhZ2Uud2FybmluZygnR29vbmcga2jDtG5nIHRo4buDIGzhuqV5IMSR4buLYSDEkWnhu4NtIGhp4buHbiB04bqhaSBj4bunYSBi4bqhbiAhJyk7XG5cdFx0fSk7XG5cblx0XHR0aGlzLmdlb2xvY2F0ZUNvbnRyb2wub24oJ2dlb2xvY2F0ZScsIChlKSA9PiB7XG5cdFx0XHR0aGlzLnByb3BzLmRpc3BhdGNoKFxuXHRcdFx0XHRzZXRNeUxvY2F0aW9uQWN0aW9uKHtcblx0XHRcdFx0XHRsYXRpdHVkZTogZS5jb29yZHMubGF0aXR1ZGUsXG5cdFx0XHRcdFx0bG9uZ2l0dWRlOiBlLmNvb3Jkcy5sb25naXR1ZGUsXG5cdFx0XHRcdH0pXG5cdFx0XHQpO1xuXHRcdH0pO1xuXG5cdFx0IWlzTW9iaWxlICYmIHRoaXMubWFwLmFkZENvbnRyb2wodGhpcy5uYXZpZ2F0aW9uKTtcblx0XHQhaXNNb2JpbGUgJiYgdGhpcy5tYXAuYWRkQ29udHJvbCh0aGlzLmdlb2xvY2F0ZUNvbnRyb2wpO1xuXG5cdFx0dGhpcy5tYXAub24oJ2NsaWNrJywgdGhpcy5fb25Nb3VzZUNsaWNrKTtcblx0XHR0aGlzLm1hcC5vbignY29udGV4dG1lbnUnLCB0aGlzLl9vblJpZ2h0Q2xpY2spO1xuXHRcdHRoaXMubWFwLm9uKCdsb2FkJywgKCkgPT4ge1xuXHRcdFx0dGhpcy5tYXAucmVzaXplKCk7XG5cblx0XHRcdGNvbnN0IHBpZCA9IG5ldyBVUkxTZWFyY2hQYXJhbXMod2luZG93LmxvY2F0aW9uLnNlYXJjaCkuZ2V0KCdwaWQnKTtcblx0XHRcdGNvbnN0IGxvY2F0aW9uID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh3aW5kb3cubG9jYXRpb24uc2VhcmNoKS5nZXQoJ2xvY2F0aW9uJyk/LnNwbGl0KCcsJyk7XG5cdFx0XHRjb25zdCBwaWRfYXJvdW5kID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh3aW5kb3cubG9jYXRpb24uc2VhcmNoKS5nZXQoJ3BpZF9hcm91bmQnKTtcblx0XHRcdGNvbnN0IGRpcmVjdGlvbl9pbmZvciA9IG5ldyBVUkxTZWFyY2hQYXJhbXMod2luZG93LmxvY2F0aW9uLnNlYXJjaCkuZ2V0KCdkaXJlY3Rpb24nKTtcblx0XHRcdGlmICghZGlyZWN0aW9uX2luZm9yICYmICFwaWQgJiYgIWxvY2F0aW9uICYmICFwaWRfYXJvdW5kICYmICF0aGlzLnByb3BzLmN1cnJlbnRfcGxhY2UpIHRoaXMuZ2VvbG9jYXRlQ29udHJvbD8udHJpZ2dlcigpO1xuXHRcdFx0ZWxzZSB7XG5cdFx0XHRcdGlmIChuYXZpZ2F0b3IuZ2VvbG9jYXRpb24pIHtcblx0XHRcdFx0XHRuYXZpZ2F0b3IuZ2VvbG9jYXRpb24uZ2V0Q3VycmVudFBvc2l0aW9uKChwb3NpdGlvbikgPT4ge1xuXHRcdFx0XHRcdFx0dGhpcy5wcm9wcy5kaXNwYXRjaChcblx0XHRcdFx0XHRcdFx0c2V0TXlMb2NhdGlvbkFjdGlvbih7XG5cdFx0XHRcdFx0XHRcdFx0bGF0aXR1ZGU6IHBvc2l0aW9uLmNvb3Jkcy5sYXRpdHVkZSxcblx0XHRcdFx0XHRcdFx0XHRsb25naXR1ZGU6IHBvc2l0aW9uLmNvb3Jkcy5sb25naXR1ZGUsXG5cdFx0XHRcdFx0XHRcdH0pXG5cdFx0XHRcdFx0XHQpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHR0aGlzLm1hcC5vbignbW92ZScsICgpID0+IHtcblx0XHRcdHRoaXMucHJvcHMuZGlzcGF0Y2goXG5cdFx0XHRcdHNldENlbnRlckxhdExuZ0FjdGlvbih7XG5cdFx0XHRcdFx0bGF0aXR1ZGU6IHRoaXMubWFwLmdldENlbnRlcigpLmxhdCxcblx0XHRcdFx0XHRsb25naXR1ZGU6IHRoaXMubWFwLmdldENlbnRlcigpLmxuZyxcblx0XHRcdFx0fSlcblx0XHRcdCk7XG5cdFx0fSk7XG5cdFx0dGhpcy5tYXAub24oJ3N0eWxlLmxvYWQnLCAoKSA9PiB7XG5cdFx0XHR0aGlzLm1hcD8uYWRkTGF5ZXIoe1xuXHRcdFx0XHRpZDogJzNkLWJ1aWxkaW5ncycsXG5cdFx0XHRcdHNvdXJjZTogJ2NvbXBvc2l0ZScsXG5cdFx0XHRcdCdzb3VyY2UtbGF5ZXInOiAnVk5fQnVpbGRpbmcnLFxuXHRcdFx0XHRmaWx0ZXI6IFsnPT0nLCAnZXh0cnVkZScsICd0cnVlJ10sXG5cdFx0XHRcdHR5cGU6ICdmaWxsLWV4dHJ1c2lvbicsXG5cdFx0XHRcdG1pbnpvb206IDE1LFxuXHRcdFx0XHRwYWludDoge1xuXHRcdFx0XHRcdCdmaWxsLWV4dHJ1c2lvbi1jb2xvcic6ICcjYWFhJyxcblx0XHRcdFx0XHQnZmlsbC1leHRydXNpb24taGVpZ2h0Jzoge1xuXHRcdFx0XHRcdFx0dHlwZTogJ2lkZW50aXR5Jyxcblx0XHRcdFx0XHRcdHByb3BlcnR5OiAnaGVpZ2h0Jyxcblx0XHRcdFx0XHR9LFxuXHRcdFx0XHRcdCdmaWxsLWV4dHJ1c2lvbi1iYXNlJzoge1xuXHRcdFx0XHRcdFx0dHlwZTogJ2lkZW50aXR5Jyxcblx0XHRcdFx0XHRcdHByb3BlcnR5OiAnbWluX2hlaWdodCcsXG5cdFx0XHRcdFx0fSxcblx0XHRcdFx0XHQnZmlsbC1leHRydXNpb24tb3BhY2l0eSc6IDAuNCxcblx0XHRcdFx0fSxcblx0XHRcdH0pO1xuXHRcdFx0aWYgKHRoaXMucHJvcHMucmVzdWx0X25hdmlnYXRpb24pIHtcblx0XHRcdFx0aWYgKHRoaXMucHJvcHMucmVzdWx0X3NlbGVjdCA9PT0gJ2Zhc3Rlc3QnKSB7XG5cdFx0XHRcdFx0dGhpcy5wcm9wcy5kaXNwYXRjaChzZWxlY3RSZXN1bHRBY3Rpb24oJ3Nob3J0ZXN0JykpO1xuXHRcdFx0XHRcdHRoaXMucHJvcHMuZGlzcGF0Y2goc2VsZWN0UmVzdWx0QWN0aW9uKCdmYXN0ZXN0JykpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMucHJvcHMuZGlzcGF0Y2goc2VsZWN0UmVzdWx0QWN0aW9uKCdmYXN0ZXN0JykpO1xuXHRcdFx0XHRcdHRoaXMucHJvcHMuZGlzcGF0Y2goc2VsZWN0UmVzdWx0QWN0aW9uKCdzaG9ydGVzdCcpKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0pO1xuXHRcdGRvY3VtZW50LmJvZHkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLl9vbkNsaWNrTWVudSk7XG5cdFx0Ly8gdGhpcy5tYXAub24oJ2NsaWNrJywgJ3JvdXRlLWxheWVyLWZhc3Rlc3QnLCAoZSkgPT4ge1xuXHRcdC8vICAgY29uc29sZS5sb2coZSwgJ2Zhc3Rlc3QnKTtcblx0XHQvLyAgIGUub3JpZ2luYWxFdmVudC5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHQvLyAgIGUub3JpZ2luYWxFdmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdC8vIH0pO1xuXG5cdFx0Ly8gdGhpcy5tYXAub24oJ2NsaWNrJywgJ3JvdXRlLWxheWVyLXNob3J0ZXN0JywgKGUpID0+IHtcblx0XHQvLyAgIGNvbnNvbGUubG9nKGUpXG5cdFx0Ly8gfSk7XG5cblx0XHRjb25zdCBkaXJlY3Rpb25faW5mb3IgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHdpbmRvdy5sb2NhdGlvbi5zZWFyY2gpLmdldCgnZGlyZWN0aW9uJyk7XG5cdFx0Y29uc3QgaWZyYW1lID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh3aW5kb3cubG9jYXRpb24uc2VhcmNoKS5nZXQoJ2lmcmFtZScpO1xuXHRcdGlmIChkaXJlY3Rpb25faW5mb3IpIHtcblx0XHRcdGNvbnN0IGNvb3JfZnJvbSA9IHtcblx0XHRcdFx0bGF0OiBkaXJlY3Rpb25faW5mb3Iuc3BsaXQoJyYnKVswXS5zcGxpdCgnLCcpWzBdLFxuXHRcdFx0XHRsbmc6IGRpcmVjdGlvbl9pbmZvci5zcGxpdCgnJicpWzBdLnNwbGl0KCcsJylbMV0sXG5cdFx0XHR9O1xuXHRcdFx0Y29uc3QgY29vcl90byA9IHtcblx0XHRcdFx0bGF0OiBkaXJlY3Rpb25faW5mb3Iuc3BsaXQoJyYnKVsxXS5zcGxpdCgnLCcpWzBdLFxuXHRcdFx0XHRsbmc6IGRpcmVjdGlvbl9pbmZvci5zcGxpdCgnJicpWzFdLnNwbGl0KCcsJylbMV0sXG5cdFx0XHR9O1xuXHRcdFx0aWYgKGNvb3JfZnJvbS5sYXQgJiYgY29vcl9mcm9tLmxuZyAmJiBjb29yX3RvLmxhdCAmJiBjb29yX3RvLmxuZykge1xuXHRcdFx0XHQvLyB0aGlzLmhhbmRsZUZyb21IZXJlKGNvb3JfZnJvbS5sYXQsIGNvb3JfZnJvbS5sbmcpO1xuXHRcdFx0XHQvLyB0aGlzLmhhbmRsZVRvSGVyZShjb29yX3RvLmxhdCwgY29vcl90by5sbmcpO1xuXHRcdFx0XHRpZiAoaWZyYW1lICE9IG51bGwpIHtcblx0XHRcdFx0XHR0aGlzLm5hdmlnYXRpb25CeVVSTElmcmFtZShjb29yX2Zyb20sIGNvb3JfdG8pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMubmF2aWdhdGlvbkJ5VVJMKGNvb3JfZnJvbSwgY29vcl90byk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHQvLyBGZXRjaCBwYXJraW5nIGxvdHNcblx0XHR0aGlzLnByb3BzLmRpc3BhdGNoKGdldFBhcmtpbmdMb3RzUmVxdWVzdCgpKTtcblx0fVxuXG5cdG5hdmlnYXRpb25CeVVSTElmcmFtZSA9IGFzeW5jIChmcm9tLCB0bykgPT4ge1xuXHRcdHRoaXMucHJvcHMuZGlzcGF0Y2goc2V0Qm94VmlzaWJsZUFjdGlvbignaWZyYW1lJykpO1xuXG5cdFx0dGhpcy5wcm9wcy5kaXNwYXRjaChzZXRSZWRNYXJrZXJBY3Rpb24oZmFsc2UpKTtcblx0XHR0aGlzLmNoYW5nZVZpc2libGVCb3R0b21JbmZvKGZhbHNlKTtcblx0XHRsZXQgZnJvbXBsYWNlO1xuXHRcdGlmICghZnJvbS5sYXQgfHwgIWZyb20ubG5nKSBmcm9tcGxhY2UgPSBhd2FpdCB0aGlzLl9nZXRJbmZvclBsYWNlKCk7XG5cdFx0ZWxzZSB7XG5cdFx0XHRmcm9tcGxhY2UgPSBhd2FpdCB0aGlzLl9nZXRJbmZvclBsYWNlKGZyb20ubGF0LCBmcm9tLmxuZyk7XG5cdFx0fVxuXHRcdGF3YWl0IHRoaXMucHJvcHMuZGlzcGF0Y2gobmF2aWdhdGlvbkZyb21BY3Rpb24oZnJvbXBsYWNlLCBgJHtmcm9tcGxhY2UubmFtZX0gLSAke2Zyb21wbGFjZS5mb3JtYXR0ZWRfYWRkcmVzc31gKSk7XG5cdFx0bGV0IHRvcGxhY2U7XG5cdFx0aWYgKCF0by5sYXQgfHwgIXRvLmxuZykgdG9wbGFjZSA9IGF3YWl0IHRoaXMuX2dldEluZm9yUGxhY2UoKTtcblx0XHRlbHNlIHtcblx0XHRcdHRvcGxhY2UgPSBhd2FpdCB0aGlzLl9nZXRJbmZvclBsYWNlKHRvLmxhdCwgdG8ubG5nKTtcblx0XHR9XG5cdFx0YXdhaXQgdGhpcy5wcm9wcy5kaXNwYXRjaChuYXZpZ2F0aW9uVG9BY3Rpb24odG9wbGFjZSwgYCR7dG9wbGFjZS5uYW1lfSAtICR7dG9wbGFjZS5mb3JtYXR0ZWRfYWRkcmVzc31gKSk7XG5cdFx0dGhpcy5wcm9wcy5kaXNwYXRjaChuYXZpZ2F0aW9uQWN0aW9uKHRoaXMucHJvcHMuZnJvbV9wbGFjZSwgdGhpcy5wcm9wcy50b19wbGFjZSwgJ2NhcicpKTtcblx0fTtcblxuXHRuYXZpZ2F0aW9uQnlVUkwgPSBhc3luYyAoZnJvbSwgdG8pID0+IHtcblx0XHR0aGlzLnByb3BzLmRpc3BhdGNoKHNldEJveFZpc2libGVBY3Rpb24oJ25hdmlnYXRpb24nKSk7XG5cdFx0dGhpcy5wcm9wcy5kaXNwYXRjaChzZXRSZWRNYXJrZXJBY3Rpb24oZmFsc2UpKTtcblx0XHR0aGlzLmNoYW5nZVZpc2libGVCb3R0b21JbmZvKGZhbHNlKTtcblx0XHRsZXQgZnJvbXBsYWNlO1xuXHRcdGlmICghZnJvbS5sYXQgfHwgIWZyb20ubG5nKSBmcm9tcGxhY2UgPSBhd2FpdCB0aGlzLl9nZXRJbmZvclBsYWNlKCk7XG5cdFx0ZWxzZSB7XG5cdFx0XHRmcm9tcGxhY2UgPSBhd2FpdCB0aGlzLl9nZXRJbmZvclBsYWNlKGZyb20ubGF0LCBmcm9tLmxuZyk7XG5cdFx0fVxuXHRcdGF3YWl0IHRoaXMucHJvcHMuZGlzcGF0Y2gobmF2aWdhdGlvbkZyb21BY3Rpb24oZnJvbXBsYWNlLCBgJHtmcm9tcGxhY2UubmFtZX0gLSAke2Zyb21wbGFjZS5mb3JtYXR0ZWRfYWRkcmVzc31gKSk7XG5cdFx0bGV0IHRvcGxhY2U7XG5cdFx0aWYgKCF0by5sYXQgfHwgIXRvLmxuZykgdG9wbGFjZSA9IGF3YWl0IHRoaXMuX2dldEluZm9yUGxhY2UoKTtcblx0XHRlbHNlIHtcblx0XHRcdHRvcGxhY2UgPSBhd2FpdCB0aGlzLl9nZXRJbmZvclBsYWNlKHRvLmxhdCwgdG8ubG5nKTtcblx0XHR9XG5cdFx0YXdhaXQgdGhpcy5wcm9wcy5kaXNwYXRjaChuYXZpZ2F0aW9uVG9BY3Rpb24odG9wbGFjZSwgYCR7dG9wbGFjZS5uYW1lfSAtICR7dG9wbGFjZS5mb3JtYXR0ZWRfYWRkcmVzc31gKSk7XG5cdH07XG5cblx0Y29tcG9uZW50V2lsbFVubW91bnQoKSB7XG5cdFx0d2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3N0b3JhZ2UnLCB0aGlzLmhhbmRsZVN0b3JhZ2VDaGFuZ2UpO1xuXHRcdGRvY3VtZW50LmJvZHkucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLl9vbkNsaWNrTWVudSk7XG5cdH1cblxuXHRoYW5kbGVTdG9yYWdlQ2hhbmdlID0gKGV2ZW50KSA9PiB7XG5cdFx0Y29uc29sZS5sb2coJ29wcGFvcGFvcGEnKTtcblx0XHRpZiAoZXZlbnQua2V5ID09PSAnc2VhcmNoX2hpc3RvcnknKSB7XG5cdFx0XHR0aGlzLnNldFN0YXRlKHsgdmFsdWU6IGV2ZW50Lm5ld1ZhbHVlIH0pO1xuXHRcdH1cblx0fTtcblxuXHRyZW5kZXJQYXJraW5nTG90cyA9ICgpID0+IHtcblx0XHRjb25zdCB7IHBhcmtpbmdMb3RzIH0gPSB0aGlzLnByb3BzO1xuXG5cdFx0cmV0dXJuIHBhcmtpbmdMb3RzPy5tYXAobG90ID0+IHtcblx0XHRcdC8vIFThuqFvIGVsZW1lbnQgY2hvIG1hcmtlclxuXHRcdFx0Y29uc3QgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblx0XHRcdGVsLmNsYXNzTmFtZSA9ICdtYXJrZXIgcGFya2luZy1tYXJrZXInO1xuXHRcdFx0ZWwuaW5uZXJIVE1MID0gYFxuXHRcdFx0XHQ8ZGl2IGNsYXNzPVwibWFya2VyLWNvbnRlbnRcIj5QPC9kaXY+XG5cdFx0XHRcdDxkaXYgY2xhc3M9XCJtYXJrZXItaW5mb1wiPlxuXHRcdFx0XHRcdDxoMz4ke2xvdC5uYW1lfTwvaDM+XG5cdFx0XHRcdFx0PHA+JHtsb3QuYWRkcmVzc308L3A+XG5cdFx0XHRcdFx0PHA+QXZhaWxhYmxlOiAke2xvdC5hdmFpbGFibGVTcG90c30vJHtsb3QuY2FwYWNpdHl9PC9wPlxuXHRcdFx0XHQ8L2Rpdj5cblx0XHRcdGA7XG5cblx0XHRcdC8vIFThuqFvIG1hcmtlciB0aGVvIGRvY3MgY+G7p2EgR29vbmdcblx0XHRcdGNvbnN0IG1hcmtlciA9IG5ldyBtYXBsaWJyZWdsLk1hcmtlcih7XG5cdFx0XHRcdGVsZW1lbnQ6IGVsLFxuXHRcdFx0XHRhbmNob3I6ICdib3R0b20nLFxuXHRcdFx0XHRvZmZzZXQ6IFswLCAtMTBdXG5cdFx0XHR9KVxuXHRcdFx0LnNldExuZ0xhdChbbG90LmxvbmdpdHVkZSwgbG90LmxhdGl0dWRlXSlcblx0XHRcdC5hZGRUbyh0aGlzLm1hcCk7XG5cblx0XHRcdC8vIFRow6ptIHPhu7Ega2nhu4duIGNsaWNrXG5cdFx0XHRtYXJrZXIuZ2V0RWxlbWVudCgpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuXHRcdFx0XHR0aGlzLmhhbmRsZVBhcmtpbmdMb3RDbGljayhsb3QpO1xuXHRcdFx0fSk7XG5cblx0XHRcdHJldHVybiBtYXJrZXI7XG5cdFx0fSk7XG5cdH07XG5cblx0aGFuZGxlUGFya2luZ0xvdENsaWNrID0gKGxvdCkgPT4ge1xuXHRcdC8vIFpvb20gxJHhur9uIHbhu4sgdHLDrSBwYXJraW5nIGxvdFxuXHRcdHRoaXMubWFwLmZseVRvKHtcblx0XHRcdGNlbnRlcjogW2xvdC5sb25naXR1ZGUsIGxvdC5sYXRpdHVkZV0sXG5cdFx0XHR6b29tOiAxNVxuXHRcdH0pO1xuXG5cdFx0Ly8gSGnhu4NuIHRo4buLIHRow7RuZyB0aW5cblx0XHR0aGlzLnNldFN0YXRlKHtcblx0XHRcdGJvdHRvbUluZm9WaXNpYmxlOiB0cnVlLFxuXHRcdFx0cGxhY2VNb3VzZUNsaWNrOiB7XG5cdFx0XHRcdG5hbWU6IGxvdC5uYW1lLFxuXHRcdFx0XHRmb3JtYXR0ZWRfYWRkcmVzczogbG90LmFkZHJlc3MsXG5cdFx0XHRcdGdlb21ldHJ5OiB7XG5cdFx0XHRcdFx0bG9jYXRpb246IHtcblx0XHRcdFx0XHRcdGxhdDogbG90LmxhdGl0dWRlLFxuXHRcdFx0XHRcdFx0bG5nOiBsb3QubG9uZ2l0dWRlXG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSk7XG5cdH07XG5cblx0cmVuZGVyKCkge1xuXHRcdGNvbnN0IHsgc3R5bGUsIGJvdHRvbUluZm9WaXNpYmxlLCBwbGFjZU1vdXNlQ2xpY2sgfSA9IHRoaXMuc3RhdGU7XG5cblx0XHRyZXR1cm4gKFxuXHRcdFx0PFJlYWN0LkZyYWdtZW50PlxuXHRcdFx0XHQ8RGl2MTAwdmg+XG5cdFx0XHRcdFx0PGRpdiBpZD1cIm1hcFwiPnt0aGlzLnJlbmRlclBhcmtpbmdMb3RzKCl9PC9kaXY+XG5cdFx0XHRcdFx0PGRpdj5cblx0XHRcdFx0XHRcdHshaXNNb2JpbGUgJiYgKFxuXHRcdFx0XHRcdFx0XHQ8QXZhdGFyXG5cdFx0XHRcdFx0XHRcdFx0c2hhcGU9XCJzcXVhcmVcIlxuXHRcdFx0XHRcdFx0XHRcdHNpemU9ezY0fVxuXHRcdFx0XHRcdFx0XHRcdG9uQ2xpY2s9e3RoaXMuY2hhbmdlU3R5bGV9XG5cdFx0XHRcdFx0XHRcdFx0Y2xhc3NOYW1lPVwiY2hhbmdlLXN0YXR1cy1idXR0b25cIlxuXHRcdFx0XHRcdFx0XHRcdHN0eWxlPXt7XG5cdFx0XHRcdFx0XHRcdFx0XHRiYWNrZ3JvdW5kSW1hZ2U6IHN0eWxlID09PSBTVFlMRV9VUkwuTk9STUFMICsgU1RZTEVfS0VZID8gYHVybCgke3NhdGVsbGl0ZV9pbWd9KWAgOiBgdXJsKCR7bm9ybWFsX21hcF9pbWd9KWAsXG5cdFx0XHRcdFx0XHRcdFx0fX1cblx0XHRcdFx0XHRcdFx0Lz5cblx0XHRcdFx0XHRcdCl9XG5cdFx0XHRcdFx0XHR7aXNNb2JpbGUgJiYgKFxuXHRcdFx0XHRcdFx0XHQ8QXZhdGFyXG5cdFx0XHRcdFx0XHRcdFx0c2hhcGU9XCJzcXVhcmVcIlxuXHRcdFx0XHRcdFx0XHRcdHNpemU9ezY0fVxuXHRcdFx0XHRcdFx0XHRcdG9uQ2xpY2s9e3RoaXMuY2hhbmdlU3R5bGV9XG5cdFx0XHRcdFx0XHRcdFx0Y2xhc3NOYW1lPVwiY2hhbmdlLXN0YXR1cy1idXR0b25cIlxuXHRcdFx0XHRcdFx0XHRcdC8vIGlkPSdjaGFuZ2Utc3RhdHVzLWJ1dHRvbi0tbW9iaWxlJ1xuXHRcdFx0XHRcdFx0XHRcdHN0eWxlPXt7XG5cdFx0XHRcdFx0XHRcdFx0XHRiYWNrZ3JvdW5kSW1hZ2U6IHN0eWxlID09PSBTVFlMRV9VUkwuTk9STUFMICsgU1RZTEVfS0VZID8gYHVybCgke3NhdGVsbGl0ZV9pbWd9KWAgOiBgdXJsKCR7bm9ybWFsX21hcF9pbWd9KWAsXG5cdFx0XHRcdFx0XHRcdFx0fX1cblx0XHRcdFx0XHRcdFx0Lz5cblx0XHRcdFx0XHRcdCl9XG5cdFx0XHRcdFx0PC9kaXY+XG5cdFx0XHRcdFx0e2JvdHRvbUluZm9WaXNpYmxlICYmIChcblx0XHRcdFx0XHRcdDxCb3R0b21JbmZvTG9jYXRpb25cblx0XHRcdFx0XHRcdFx0Y2hhbmdlVmlzaWJsZUJvdHRvbUluZm89e3RoaXMuY2hhbmdlVmlzaWJsZUJvdHRvbUluZm99XG5cdFx0XHRcdFx0XHRcdGxhdD17cGxhY2VNb3VzZUNsaWNrLmdlb21ldHJ5Py5sb2NhdGlvbi5sYXQgfHwgTnVtYmVyKHBsYWNlTW91c2VDbGljay5sbmdfbGF0WzFdKX1cblx0XHRcdFx0XHRcdFx0bG5nPXtwbGFjZU1vdXNlQ2xpY2suZ2VvbWV0cnk/LmxvY2F0aW9uLmxuZyB8fCBOdW1iZXIocGxhY2VNb3VzZUNsaWNrLmxuZ19sYXRbMF0pfVxuXHRcdFx0XHRcdFx0XHRuYW1lPXtwbGFjZU1vdXNlQ2xpY2submFtZSB8fCBwbGFjZU1vdXNlQ2xpY2suYWRkcmVzc19jb21wb25lbnRzWzBdLmxvbmdfbmFtZX1cblx0XHRcdFx0XHRcdFx0aXNNYXJrZXJBcm91bmQ9e3BsYWNlTW91c2VDbGljay5tYXJrZXJfdHlwZV9pZH1cblx0XHRcdFx0XHRcdFx0cGxhY2VfaWQ9e3BsYWNlTW91c2VDbGljay5faWR9XG5cdFx0XHRcdFx0XHRcdGFkZHJlc3M9e3RoaXMuZ2V0QWRkcmVzc0dlb2NvZGUocGxhY2VNb3VzZUNsaWNrKSB8fCBwbGFjZU1vdXNlQ2xpY2suZm9ybWF0dGVkX2FkZHJlc3MgfHwgcGxhY2VNb3VzZUNsaWNrLmRlc2NyaXB0aW9uLmFkZHJlc3N9XG5cdFx0XHRcdFx0XHRcdHJlbW92ZU1hcmtlcj17dGhpcy5yZW1vdmVNYXJrZXJXaGF0SXN9XG5cdFx0XHRcdFx0XHQvPlxuXHRcdFx0XHRcdCl9XG5cdFx0XHRcdDwvRGl2MTAwdmg+XG5cdFx0XHRcdDxzdHlsZSBqc3g+e2Bcblx0XHRcdFx0XHQucGFya2luZy1tYXJrZXIge1xuXHRcdFx0XHRcdFx0YmFja2dyb3VuZC1jb2xvcjogI2ZmZjtcblx0XHRcdFx0XHRcdGJvcmRlci1yYWRpdXM6IDUwJTtcblx0XHRcdFx0XHRcdGN1cnNvcjogcG9pbnRlcjtcblx0XHRcdFx0XHRcdHBhZGRpbmc6IDA7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0Lm1hcmtlci1jb250ZW50IHtcblx0XHRcdFx0XHRcdGJhY2tncm91bmQ6ICMxODkwZmY7XG5cdFx0XHRcdFx0XHRjb2xvcjogd2hpdGU7XG5cdFx0XHRcdFx0XHRib3JkZXItcmFkaXVzOiA1MCU7XG5cdFx0XHRcdFx0XHR3aWR0aDogMzJweDtcblx0XHRcdFx0XHRcdGhlaWdodDogMzJweDtcblx0XHRcdFx0XHRcdGRpc3BsYXk6IGZsZXg7XG5cdFx0XHRcdFx0XHRhbGlnbi1pdGVtczogY2VudGVyO1xuXHRcdFx0XHRcdFx0anVzdGlmeS1jb250ZW50OiBjZW50ZXI7XG5cdFx0XHRcdFx0XHRmb250LXdlaWdodDogYm9sZDtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQubWFya2VyLWluZm8ge1xuXHRcdFx0XHRcdFx0ZGlzcGxheTogbm9uZTtcblx0XHRcdFx0XHRcdHBvc2l0aW9uOiBhYnNvbHV0ZTtcblx0XHRcdFx0XHRcdGJvdHRvbTogMTAwJTtcblx0XHRcdFx0XHRcdGxlZnQ6IDUwJTtcblx0XHRcdFx0XHRcdHRyYW5zZm9ybTogdHJhbnNsYXRlWCgtNTAlKTtcblx0XHRcdFx0XHRcdGJhY2tncm91bmQ6IHdoaXRlO1xuXHRcdFx0XHRcdFx0cGFkZGluZzogOHB4O1xuXHRcdFx0XHRcdFx0Ym9yZGVyLXJhZGl1czogNHB4O1xuXHRcdFx0XHRcdFx0Ym94LXNoYWRvdzogMCAycHggNnB4IHJnYmEoMCwwLDAsMC4xKTtcblx0XHRcdFx0XHRcdG1pbi13aWR0aDogMjAwcHg7XG5cdFx0XHRcdFx0XHR6LWluZGV4OiAxO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdC5wYXJraW5nLW1hcmtlcjpob3ZlciAubWFya2VyLWluZm8ge1xuXHRcdFx0XHRcdFx0ZGlzcGxheTogYmxvY2s7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRgfTwvc3R5bGU+XG5cdFx0XHQ8L1JlYWN0LkZyYWdtZW50PlxuXHRcdCk7XG5cdH1cbn1cblxuY29uc3QgbWFwU3RhdGVUb1Byb3BzID0gKHN0YXRlKSA9PiB7XG5cdHJldHVybiB7XG5cdFx0Y3VycmVudF9wbGFjZTogc3RhdGUucGxhY2VSZWR1Y2VyLmN1cnJlbnRfcGxhY2UsXG5cdFx0ZnJvbV9wbGFjZTogc3RhdGUubmF2aWdhdGlvblJlZHVjZXIuZnJvbSxcblx0XHR0b19wbGFjZTogc3RhdGUubmF2aWdhdGlvblJlZHVjZXIudG8sXG5cdFx0Ym94VmlzaWJsZTogc3RhdGUuYm94VmlzaWJsZVJlZHVjZXIuYm94X3Zpc2libGUsXG5cdFx0cmVzdWx0X25hdmlnYXRpb246IHN0YXRlLm5hdmlnYXRpb25SZWR1Y2VyLnJlc3VsdCxcblx0XHR2aWV3cG9ydDogc3RhdGUucGxhY2VSZWR1Y2VyLnZpZXdwb3J0LFxuXHRcdHJlc3VsdF9zZWxlY3Q6IHN0YXRlLm5hdmlnYXRpb25SZWR1Y2VyLnJlc3VsdF9zZWxlY3QsXG5cdFx0YXJvdW5kX3BsYWNlczogc3RhdGUuc2VhcmNoUmVkdWNlci5hcm91bmRfcGxhY2VzLFxuXHRcdG1hcmtlclNlbGVjdDogc3RhdGUuYm94VmlzaWJsZVJlZHVjZXIucmVkX21hcmtlcl92aXNpYmxlLFxuXHRcdHBvc2l0aW9uTWFya2VyU2VsZWN0OiBzdGF0ZS5ib3hWaXNpYmxlUmVkdWNlci5wb3NpdGlvbl9yZWRfbWFya2VyLFxuXHRcdGFyb3VuZF9wbGFjZV9jZW50ZXI6IHN0YXRlLnNlYXJjaFJlZHVjZXIuYXJvdW5kX3BsYWNlX2NlbnRlcixcblx0XHRwb3B1cF92aXNpYmxlOiBzdGF0ZS5ib3hWaXNpYmxlUmVkdWNlci5wb3B1cF92aXNpYmxlLFxuXHRcdHBvc2l0aW9uX3BvcHVwOiBzdGF0ZS5ib3hWaXNpYmxlUmVkdWNlci5wb3NpdGlvbl9wb3B1cCxcblx0XHR0eXBlX3BvcHVwOiBzdGF0ZS5ib3hWaXNpYmxlUmVkdWNlci50eXBlX3BvcHVwLFxuXHRcdGFyb3VuZF9wbGFjZV9zZWxlY3Q6IHN0YXRlLnNlYXJjaFJlZHVjZXIuYXJvdW5kX3BsYWNlX3NlbGVjdCxcblx0XHRteV9sb2NhdGlvbjogc3RhdGUucGxhY2VSZWR1Y2VyLm15X2xvY2F0aW9uLFxuXHRcdHJlc3RhdXJhbnREYXRhOiBzdGF0ZS5zZWFyY2hSZWR1Y2VyLnJlc3RhdXJhbnRfZGF0YSxcblx0XHRzZWFyY2hMb2NhbFN0b3JhZ2U6IHN0YXRlLnNlYXJjaFJlZHVjZXIuc2VhcmNoX2xvY2FsX3N0b3JhZ2UsXG5cdFx0cGFya2luZ0xvdHM6IHN0YXRlLnBhcmtpbmdMb3RSZWR1Y2VyLnBhcmtpbmdMb3RzLFxuXHR9O1xufTtcbmV4cG9ydCBkZWZhdWx0IGNvbm5lY3QobWFwU3RhdGVUb1Byb3BzKShNYXApO1xuIl19 */\\n/*@ sourceURL=D:\\\\\\\\Workhome\\\\\\\\ParkingLot\\\\\\\\live-map\\\\\\\\components\\\\\\\\Map.jsx */\"));\n  }\n}\nconst mapStateToProps = state => {\n  return {\n    current_place: state.placeReducer.current_place,\n    from_place: state.navigationReducer.from,\n    to_place: state.navigationReducer.to,\n    boxVisible: state.boxVisibleReducer.box_visible,\n    result_navigation: state.navigationReducer.result,\n    viewport: state.placeReducer.viewport,\n    result_select: state.navigationReducer.result_select,\n    around_places: state.searchReducer.around_places,\n    markerSelect: state.boxVisibleReducer.red_marker_visible,\n    positionMarkerSelect: state.boxVisibleReducer.position_red_marker,\n    around_place_center: state.searchReducer.around_place_center,\n    popup_visible: state.boxVisibleReducer.popup_visible,\n    position_popup: state.boxVisibleReducer.position_popup,\n    type_popup: state.boxVisibleReducer.type_popup,\n    around_place_select: state.searchReducer.around_place_select,\n    my_location: state.placeReducer.my_location,\n    restaurantData: state.searchReducer.restaurant_data,\n    searchLocalStorage: state.searchReducer.search_local_storage,\n    parkingLots: state.parkingLotReducer.parkingLots\n  };\n};\nexport default connect(mapStateToProps)(Map);","map":{"version":3,"names":["React","Component","useEffect","STYLE_URL","Marker","connect","BottomInfoLocation","MenuRightClick","getDetailLatLngService","equal","setMapViewportAction","getDetailByLatLngAction","setCenterLatLngAction","setMyLocationAction","getDetailByIdAction","searchAroundAction","clearSearchAroundAction","selectAroundPlaceAction","selectResultAction","navigationFromAction","navigationToAction","clearResultAction","navigationAction","MarkerNavigation","setRedMarkerAction","setCollapsedInfoBoxAction","setPopupRightClick","setBoxVisibleAction","normal_map_img","satellite_img","ReactDOMServer","Axios","Div100vh","Request","Mile_Travel","isMobile","images","useDispatch","useSelector","getParkingLotsRequest","Map","constructor","props","_defineProperty","viewport","dispatch","e","boxVisible","removeMarkerWhatIs","setState","bottomInfoVisible","position","lat","lngLat","lng","evt","parent","target","parentElement","className","toString","includes","handleWhatIs","handleFromHere","handleToHere","handleDeleteLocation","handleSearchAround","handleToAroundPlace","visible","_this$props$position_","position_popup","_this$props$position_2","latLng","latitude","longitude","response","data","results","length","place_response","_objectSpread","name","address_components","long_name","formatted_address","getAddressGeocode","_message","error","_this$props$positionM","positionMarkerSelect","_this$props$positionM2","redMarkerVisible","place","_getInforPlace","zoom","placeMouseClick","markerWhatIs","setLngLat","addTo","map","el","document","createElement","innerHTML","renderToStaticMarkup","__jsx","size","maplibregl","anchor","getElement","addEventListener","stopPropagation","preventDefault","remove","id","get","_getInforPlaceAround","Number","lng_lat","isSmallScreen","selectPlace","geometry","location","to_place","changeVisibleBottomInfo","my_location","geocode","from_place","type_popup","type","selectAroundPlace","around_places","item","popupRightClick","getLngLat","_response$data","place_center","around_place_center","place_id","_id","description","address","markerCurrentPlace","redMarker","_place$address_compon","result","slice","push","join","style","state","SATELITE","NORMAL","setStyle","from","to","fromplace","toplace","event","console","log","key","value","newValue","parkingLots","lot","availableSpots","capacity","marker","element","offset","handleParkingLotClick","flyTo","center","_mapRef","createRef","popup_navigation","styleNormal","styleEarth","localStorage","getItem","list","listRestaurant","listHistories","view","navigationView","componentDidUpdate","prevProps","navigation","NavigationControl","addControl","removeControl","markerSelect","_this$redMarker","popup_visible","setHTML","Popup","closeButton","closeOnClick","current_place","selectedPlace","speed","curve","removeMarkerPopup","result_select","result_navigation","dashedLineGeoJSON","polylineGeoJSON","_this$popup_navigatio","_this$popup_navigatio2","getLayer","removeLayer","getSource","removeSource","distance","fastest","legs","toFixed","MILES","coordinateObject1","coordinates","decodePolyline","overview_polyline","points","roadWay","coordinateObject2","shortest","i","addSource","properties","addLayer","source","layout","paint","_this$popup_navigatio3","Math","trunc","duration","text","setMaxWidth","getElementById","normalizeBounds","bounds","firstPoint","secondPoint","minLat","min","maxLat","max","minLng","maxLng","bound","cameraForBounds","padding","top","bottom","left","right","popup","start_marker","setPopup","marker_start","src","button","width","alt","isOpen","togglePopup","_prevProps$from_place","_this$state$placeMous","end_marker","marker_end","_this$start_marker","_prevProps$to_place","_this$state$placeMous2","around_place_select","_this$list_marker_aro","list_marker_around","forEach","markerCenterDiv","_selectAroundPlace","getPopup","place_select","markerDiv","_this$props$current_p","_this$props$current_p2","restaurantData","marker_restaurant","restaurant_marker","searchLocalStorage","marker_history","history_marker","step","steps","html_instructions","marker_step","step_marker","end_location","encoded","index","len","b","shift","charAt","charCodeAt","dlat","dlng","componentDidMount","window","handleStorageChange","container","geolocateControl","GeolocateControl","positionOptions","enableHighAccuracy","trackUserLocation","showUserLocation","showAccuracyCircle","fitBoundsOptions","maxZoom","on","warning","coords","_onMouseClick","_onRightClick","_URLSearchParams$get","_this$geolocateContro","resize","pid","URLSearchParams","search","split","pid_around","direction_infor","trigger","navigator","geolocation","getCurrentPosition","getCenter","_this$map","filter","minzoom","property","body","_onClickMenu","iframe","coor_from","coor_to","navigationByURLIframe","navigationByURL","componentWillUnmount","removeEventListener","render","_placeMouseClick$geom","_placeMouseClick$geom2","Fragment","renderParkingLots","_Avatar","shape","onClick","changeStyle","backgroundImage","isMarkerAround","marker_type_id","removeMarker","_JSXStyle","mapStateToProps","placeReducer","navigationReducer","boxVisibleReducer","box_visible","searchReducer","red_marker_visible","position_red_marker","restaurant_data","search_local_storage","parkingLotReducer"],"sources":["D:/Workhome/ParkingLot/live-map/components/Map.jsx"],"sourcesContent":["import React, { Component, useEffect } from 'react';\nimport { STYLE_URL } from '../consts';\nimport Marker from './Marker';\nimport { connect } from 'react-redux';\nimport BottomInfoLocation from './BottomInfoLocation';\nimport MenuRightClick from './MenuRightCLick';\nimport { getDetailLatLngService } from '../redux/sagas/placeSaga';\nimport { message, Avatar } from 'antd';\nimport equal from 'fast-deep-equal/es6/react';\nimport { setMapViewportAction, getDetailByLatLngAction, setCenterLatLngAction, setMyLocationAction, getDetailByIdAction } from '../redux/actions/place';\nimport { searchAroundAction, clearSearchAroundAction, selectAroundPlaceAction } from '../redux/actions/search';\nimport { selectResultAction, navigationFromAction, navigationToAction, clearResultAction, navigationAction } from '../redux/actions/navigation';\nimport MarkerNavigation from './MarkerNavigation';\nimport { setRedMarkerAction, setCollapsedInfoBoxAction, setPopupRightClick, setBoxVisibleAction } from '../redux/actions/boxVisble';\nimport normal_map_img from '../static/images/normal_map.png';\nimport satellite_img from '../static/images/satellite.jpeg';\nimport ReactDOMServer from 'react-dom/server';\nimport Axios from 'axios';\nimport Div100vh from 'react-div-100vh';\nimport Request from '../utils/request';\nimport { Mile_Travel } from '../consts';\nimport { isMobile } from 'react-device-detect';\nimport images from '../utils/images';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { getParkingLotsRequest } from '../redux/actions/parkingLot';\n\nclass Map extends Component {\n\tconstructor(props) {\n\t\tsuper(props);\n\t\tthis._mapRef = React.createRef();\n\t\tthis.map = null;\n\t\tthis.redMarker = null;\n\t\tthis.popupRightClick = null;\n\t\tthis.popup_navigation = [];\n\t\tthis.state = {\n\t\t\tstyle: STYLE_URL.NORMAL + STYLE_KEY,\n\t\t\tstyleNormal: STYLE_URL.NORMAL + STYLE_KEY,\n\t\t\tstyleEarth: STYLE_URL.SATELITE + STYLE_KEY,\n\t\t\tbottomInfoVisible: false,\n\t\t\tvalue: localStorage.getItem('search_history') || '',\n\t\t\tparkingLots: [],\n\t\t};\n\t\tthis.list = [];\n\t\tthis.listRestaurant = [];\n\t\tthis.listHistories = [];\n\t\tthis.view = null;\n\t\tthis.navigationView = null;\n\t}\n\n\t_onViewportChange = (viewport) => {\n\t\tthis.props.dispatch(setMapViewportAction(viewport));\n\t};\n\n\t_onMouseClick = (e) => {\n\t\tthis.props.dispatch(setPopupRightClick(false));\n\t\tif (this.props.boxVisible !== 'iframe') {\n\t\t\tthis.props.dispatch(setRedMarkerAction(false));\n\t\t}\n\t\t// if (this.props.boxVisible === \"info\") this.props.dispatch(setBoxVisibleAction('search'))\n\t\t// this.markerWhatIs ? this.markerWhatIs.remove() : null;\n\t\tthis.props.dispatch(selectAroundPlaceAction(null));\n\t\tthis.removeMarkerWhatIs();\n\t\tthis.setState({\n\t\t\tbottomInfoVisible: false,\n\t\t});\n\t};\n\n\t_onRightClick = (e) => {\n\t\tconst position = { lat: e.lngLat.lat, lng: e.lngLat.lng };\n\t\tif (this.props.boxVisible !== 'iframe') {\n\t\t\tthis.props.dispatch(setRedMarkerAction(true, position));\n\t\t\tthis.props.dispatch(setPopupRightClick(true, position, 'normal'));\n\t\t}\n\t};\n\n\t_onClickMenu = (evt) => {\n\t\tconst parent = evt.target.parentElement;\n\n\t\tif (evt.target.className && evt.target.className.toString().includes('what-is-this')) {\n\t\t\tthis.handleWhatIs();\n\t\t} else if (evt.target.className && evt.target.className.toString().includes('from-here')) {\n\t\t\tthis.handleFromHere();\n\t\t} else if (evt.target.className && evt.target.className.toString().includes('to-here')) {\n\t\t\tthis.handleToHere();\n\t\t} else if (evt.target.className && evt.target.className.toString().includes('delete-location')) {\n\t\t\tthis.handleDeleteLocation();\n\t\t} else if (evt.target.className && evt.target.className.toString().includes('search-around')) {\n\t\t\tthis.handleSearchAround();\n\t\t} else if (evt.target.className && evt.target.className.toString().includes('to-around-place')) {\n\t\t\tthis.handleToAroundPlace();\n\t\t} else if (evt.target.className && evt.target.className.toString().includes('what-is-navigation')) {\n\t\t\tthis.handleWhatIs(false);\n\t\t}\n\t\tif (parent?.className && parent?.className.toString().includes('menu-right-click')) {\n\t\t\tif (evt.target.className && !evt.target.className.toString().includes('what-is-this')) {\n\t\t\t\tthis.props.dispatch(clearSearchAroundAction());\n\t\t\t}\n\t\t\tthis.props.dispatch(setPopupRightClick(false));\n\t\t\tthis.removeMarkerWhatIs();\n\t\t}\n\t};\n\n\tchangeVisibleBottomInfo = (visible) => {\n\t\tthis.setState({\n\t\t\tbottomInfoVisible: visible,\n\t\t});\n\t};\n\n\t_getInforPlace = async (lat = this.props.position_popup?.lat, lng = this.props.position_popup?.lng) => {\n\t\tconst latLng = {\n\t\t\tlatitude: lat,\n\t\t\tlongitude: lng,\n\t\t};\n\n\t\ttry {\n\t\t\tconst response = await getDetailLatLngService(latLng);\n\t\t\tif (response.data.results.length > 0) {\n\t\t\t\tconst place_response = response.data.results[0];\n\t\t\t\treturn {\n\t\t\t\t\t...place_response,\n\t\t\t\t\tname: place_response.address_components[0].long_name,\n\t\t\t\t\tformatted_address: this.getAddressGeocode(place_response),\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tmessage.error('Không tìm thấy địa điểm !!');\n\t\t\t\treturn null;\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tthrow error;\n\t\t}\n\t};\n\n\tselectPlace = async (lat = this.props.positionMarkerSelect?.lat, lng = this.props.positionMarkerSelect?.lng, redMarkerVisible = true) => {\n\t\tconst place = await this._getInforPlace(lat, lng);\n\n\t\tif (place) {\n\t\t\tconst viewport = {\n\t\t\t\tlongitude: lng,\n\t\t\t\tlatitude: lat,\n\t\t\t\tzoom: 15,\n\t\t\t};\n\t\t\tthis.props.dispatch(setMapViewportAction(viewport));\n\t\t\tthis.setState({\n\t\t\t\tbottomInfoVisible: true,\n\t\t\t\tplaceMouseClick: place,\n\t\t\t});\n\t\t\tif (redMarkerVisible) {\n\t\t\t\tif (this.markerWhatIs) {\n\t\t\t\t\tthis.markerWhatIs.setLngLat({ lat, lng }).addTo(this.map);\n\t\t\t\t} else {\n\t\t\t\t\tconst el = document.createElement('div');\n\t\t\t\t\tel.innerHTML = ReactDOMServer.renderToStaticMarkup(<Marker size={22} />);\n\t\t\t\t\tthis.markerWhatIs = new maplibregl.Marker(el, { anchor: 'bottom' }).setLngLat({ lat, lng }).addTo(this.map);\n\t\t\t\t}\n\t\t\t\tthis.markerWhatIs.getElement().addEventListener('contextmenu', (e) => {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tthis.props.dispatch(setRedMarkerAction(false));\n\t\t\t\t\tthis.props.dispatch(setPopupRightClick(true, { lat, lng }, 'popupCurrentPlace'));\n\t\t\t\t});\n\t\t\t\tthis.props.dispatch(setRedMarkerAction(false));\n\t\t\t}\n\t\t\t// redMarkerVisible ? this.props.dispatch(setRedMarkerAction(true, { lat, lng })) : null;\n\t\t} else {\n\t\t\tmessage.error('Không tìm thấy địa điểm !!');\n\t\t}\n\t};\n\n\tremoveMarkerWhatIs = () => {\n\t\tthis.markerWhatIs ? this.markerWhatIs.remove() : null;\n\t};\n\n\t_getInforPlaceAround = async (id) => {\n\t\ttry {\n\t\t\tconst response = await Axios.get(`https://napi.goong.io/v1/marker/get_marker_detail/${id}`);\n\n\t\t\tif (response.data.data) {\n\t\t\t\treturn response.data.data;\n\t\t\t} else {\n\t\t\t\tmessage.error('Không tìm thấy địa điểm !!');\n\t\t\t\treturn null;\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tmessage.error('Không tìm thấy địa điểm !');\n\t\t\tthrow error;\n\t\t}\n\t};\n\n\tselectAroundPlace = async (id) => {\n\t\tconst place = await this._getInforPlaceAround(id);\n\t\tif (place) {\n\t\t\tconst viewport = {\n\t\t\t\tlongitude: Number(place.lng_lat[0]),\n\t\t\t\tlatitude: Number(place.lng_lat[1]),\n\t\t\t\tzoom: 15,\n\t\t\t};\n\t\t\tthis.props.dispatch(setMapViewportAction(viewport));\n\t\t\tthis.setState({\n\t\t\t\tbottomInfoVisible: true,\n\t\t\t\tplaceMouseClick: place,\n\t\t\t});\n\t\t\tthis.props.dispatch(setPopupRightClick(false));\n\t\t} else {\n\t\t\tmessage.error('Không tìm thấy địa điểm !!');\n\t\t}\n\t};\n\n\thandleWhatIs = (redMarkerVisible = true) => {\n\t\tconst { position_popup, isSmallScreen } = this.props;\n\t\tif (isSmallScreen) {\n\t\t\tthis.props.dispatch(\n\t\t\t\tgetDetailByLatLngAction({\n\t\t\t\t\tlatitude: position_popup.lat,\n\t\t\t\t\tlongitude: position_popup.lng,\n\t\t\t\t})\n\t\t\t);\n\n\t\t\tthis.props.dispatch(setBoxVisibleAction('info'));\n\t\t\tthis.props.dispatch(clearSearchAroundAction());\n\t\t\tthis.props.dispatch(setPopupRightClick(false));\n\t\t\tthis.removeMarkerWhatIs();\n\t\t} else {\n\t\t\tthis.selectPlace(position_popup.lat, position_popup.lng, redMarkerVisible);\n\t\t}\n\t};\n\n\thandleFromHere = async (lat, lng) => {\n\t\tlet place;\n\t\tif (!lat || !lng) place = await this._getInforPlace();\n\t\telse {\n\t\t\tplace = await this._getInforPlace(lat, lng);\n\t\t}\n\t\tif (place) {\n\t\t\tconst viewport = {\n\t\t\t\tlongitude: place.geometry.location.lng,\n\t\t\t\tlatitude: place.geometry.location.lat,\n\t\t\t\tzoom: 15,\n\t\t\t};\n\t\t\t!this.props.to_place && this.props.dispatch(setMapViewportAction(viewport));\n\t\t\tthis.props.dispatch(setBoxVisibleAction('navigation'));\n\t\t\tthis.props.dispatch(navigationFromAction(place, `${place.name} - ${place.formatted_address}`));\n\n\t\t\tthis.props.dispatch(setRedMarkerAction(false));\n\t\t\tthis.changeVisibleBottomInfo(false);\n\t\t}\n\t};\n\n\thandleToHere = async (lat, lng) => {\n\t\tlet place;\n\t\tif (!lat || !lng) place = await this._getInforPlace();\n\t\telse {\n\t\t\tplace = await this._getInforPlace(lat, lng);\n\t\t}\n\t\tif (place) {\n\t\t\tthis.props.dispatch(setBoxVisibleAction('navigation'));\n\t\t\tconst viewport = {\n\t\t\t\tlongitude: place.geometry.location.lng,\n\t\t\t\tlatitude: place.geometry.location.lat,\n\t\t\t\tzoom: 15,\n\t\t\t};\n\t\t\tconst my_location = this.props.my_location;\n\t\t\tif (my_location && (this.props.boxVisible === 'search' || this.props.boxVisible === 'info')) {\n\t\t\t\ttry {\n\t\t\t\t\tconst response = await Request.geocode(my_location);\n\t\t\t\t\tif (response.data.results.length > 0) {\n\t\t\t\t\t\tthis.props.dispatch(\n\t\t\t\t\t\t\tnavigationFromAction(\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t...response.data.results[0],\n\t\t\t\t\t\t\t\t\tname: response.data.results[0].address_components[0].long_name,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t'Vị trí của bạn'\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t} catch (error) {\n\t\t\t\t\tthrow error;\n\t\t\t\t}\n\t\t\t}\n\t\t\t!this.props.from_place && this.props.dispatch(setMapViewportAction(viewport));\n\t\t\tthis.props.dispatch(navigationToAction(place, `${place.name} - ${place.formatted_address}`));\n\t\t\tthis.props.dispatch(setBoxVisibleAction('navigation'));\n\t\t\tthis.props.dispatch(setRedMarkerAction(false));\n\t\t\tthis.changeVisibleBottomInfo(false);\n\t\t}\n\t};\n\n\thandleDeleteLocation = () => {\n\t\tconst { type_popup } = this.props;\n\t\tif (type_popup === 'popupFromPlace') {\n\t\t\tthis.props.dispatch(navigationFromAction(null, ''));\n\t\t} else if (type_popup === 'popupToPlace') {\n\t\t\tthis.props.dispatch(navigationToAction(null, ''));\n\t\t}\n\t\tthis.props.dispatch(clearResultAction());\n\t};\n\n\thandleSearchAround = async () => {\n\t\tconst place = await this._getInforPlace();\n\t\tif (place) {\n\t\t\tconst viewport = {\n\t\t\t\tlongitude: place.geometry.location.lng,\n\t\t\t\tlatitude: place.geometry.location.lat,\n\t\t\t\tzoom: 15,\n\t\t\t};\n\t\t\tconst location = {\n\t\t\t\tlat: place.geometry.location.lat,\n\t\t\t\tlng: place.geometry.location.lng,\n\t\t\t};\n\t\t\tthis.props.dispatch(setBoxVisibleAction('search'));\n\t\t\tthis.props.dispatch(setMapViewportAction(viewport));\n\t\t\tthis.props.dispatch(searchAroundAction(location, this.props.viewport.zoom));\n\t\t\tthis.setState({\n\t\t\t\tbottomInfoVisible: false,\n\t\t\t});\n\t\t}\n\t};\n\n\t_selectAroundPlace = (type, place) => {\n\t\tif (type !== 'center') {\n\t\t\tthis.props.dispatch(selectAroundPlaceAction(place));\n\t\t\tthis.selectAroundPlace(place?.id);\n\t\t} else {\n\t\t\tthis.props.dispatch(selectAroundPlaceAction(place));\n\t\t\tthis.selectPlace(place.geometry.location.lat, place.geometry.location.lng, false);\n\t\t}\n\t};\n\n\thandleToAroundPlace = async () => {\n\t\tlet place = null;\n\t\tthis.props.around_places.map((item) => {\n\t\t\tif (item.lng_lat[0] * 1 === this.popupRightClick.getLngLat().lng && item.lng_lat[1] * 1 === this.popupRightClick.getLngLat().lat) {\n\t\t\t\tplace = item;\n\t\t\t}\n\t\t});\n\t\tif (place) {\n\t\t\ttry {\n\t\t\t\tthis.props.dispatch(setPopupRightClick(false));\n\t\t\t\tconst place_center = this.props.around_place_center;\n\t\t\t\tthis.props.dispatch(navigationFromAction(place_center, `${place_center.name} - ${place_center.formatted_address}`));\n\t\t\t\tconst response = await Axios.get(`https://napi.goong.io/v1/marker/get_marker_detail/${place.id}`);\n\n\t\t\t\tplace = response.data?.data;\n\t\t\t\tplace = {\n\t\t\t\t\t...place,\n\t\t\t\t\tplace_id: place._id,\n\t\t\t\t\tgeometry: {\n\t\t\t\t\t\tlocation: {\n\t\t\t\t\t\t\tlat: Number(place.lng_lat[1]),\n\t\t\t\t\t\t\tlng: Number(place.lng_lat[0]),\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tformatted_address: place.description.address,\n\t\t\t\t};\n\t\t\t\tthis.props.dispatch(navigationToAction(place, `${place.name} - ${place.formatted_address}`));\n\t\t\t\tthis.props.dispatch(setBoxVisibleAction('navigation'));\n\t\t\t} catch (error) {\n\t\t\t\tmessage.error('Không tìm thấy địa điểm !');\n\t\t\t}\n\t\t} else {\n\t\t\tmessage.error('Không tìm thấy địa điểm !');\n\t\t}\n\t};\n\n\tremoveMarkerPopup = () => {\n\t\tif (this.markerCurrentPlace) this.markerCurrentPlace.remove();\n\t\tif (this.popupRightClick) this.popupRightClick.remove();\n\t\tif (this.props.around_places) this.props.dispatch(clearSearchAroundAction());\n\t\tif (this.redMarker) this.redMarker.remove();\n\t};\n\n\tgetAddressGeocode = (place) => {\n\t\tlet result = [];\n\t\tplace.address_components?.slice(1).map((item) => {\n\t\t\tresult.push(item.long_name);\n\t\t});\n\t\treturn result.join(',');\n\t};\n\n\tcomponentDidUpdate(prevProps) {\n\t\tif (this.props.isSmallScreen !== prevProps.isSmallScreen) {\n\t\t\tif (!this.props.isSmallScreen && !this.navigation) {\n\t\t\t\tthis.navigation = new maplibregl.NavigationControl();\n\t\t\t\tthis.map.addControl(this.navigation);\n\t\t\t} else if (this.props.isSmallScreen && this.navigation) {\n\t\t\t\tthis.map.removeControl(this.navigation);\n\t\t\t\tthis.navigation = null;\n\t\t\t}\n\t\t}\n\n\t\tif (!equal(prevProps.positionMarkerSelect, this.props.positionMarkerSelect) && this.props.positionMarkerSelect) {\n\t\t\tif (this.redMarker) {\n\t\t\t\tthis.redMarker = this.redMarker.setLngLat(this.props.positionMarkerSelect).addTo(this.map);\n\t\t\t} else {\n\t\t\t\tconst el = document.createElement('div');\n\t\t\t\tel.innerHTML = ReactDOMServer.renderToStaticMarkup(<Marker size={22} />);\n\t\t\t\t// Marker chuột phải\n\t\t\t\tthis.redMarker = new maplibregl.Marker({ anchor: 'bottom', element: el }).setLngLat(this.props.positionMarkerSelect).addTo(this.map);\n\n\t\t\t\tthis.redMarker.getElement().addEventListener('contextmenu', (e) => {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tthis.props.dispatch(setPopupRightClick(true, this.props.positionMarkerSelect, 'normal'));\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (prevProps.markerSelect !== this.props.markerSelect) {\n\t\t\tif (!this.props.markerSelect) {\n\t\t\t\tthis.redMarker?.remove();\n\t\t\t}\n\t\t}\n\n\t\tif (this.props.popup_visible && (!equal(prevProps.position_popup, this.props.position_popup) || this.props.type_popup !== prevProps.type_popup) && this.props.position_popup) {\n\t\t\tthis.popupRightClick = this.popupRightClick\n\t\t\t\t? this.popupRightClick\n\t\t\t\t\t\t.setLngLat([this.props.position_popup.lng, this.props.position_popup.lat])\n\t\t\t\t\t\t.addTo(this.map)\n\t\t\t\t\t\t.setHTML(\n\t\t\t\t\t\t\tReactDOMServer.renderToStaticMarkup(\n\t\t\t\t\t\t\t\t<MenuRightClick\n\t\t\t\t\t\t\t\t\tdispatch={this.props.dispatch}\n\t\t\t\t\t\t\t\t\tposition_popup={this.props.position_popup}\n\t\t\t\t\t\t\t\t\ttype_popup={this.props.type_popup}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t)\n\t\t\t\t: new maplibregl.Popup({\n\t\t\t\t\t\tcloseButton: false,\n\t\t\t\t\t\tanchor: 'top',\n\t\t\t\t\t\tcloseOnClick: false,\n\t\t\t\t\t\toffset: [0, 5],\n\t\t\t\t  })\n\t\t\t\t\t\t.setLngLat([this.props.position_popup.lng, this.props.position_popup.lat])\n\t\t\t\t\t\t.setHTML(\n\t\t\t\t\t\t\tReactDOMServer.renderToStaticMarkup(\n\t\t\t\t\t\t\t\t<MenuRightClick\n\t\t\t\t\t\t\t\t\tdispatch={this.props.dispatch}\n\t\t\t\t\t\t\t\t\tposition_popup={this.props.position_popup}\n\t\t\t\t\t\t\t\t\ttype_popup={this.props.type_popup}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t)\n\t\t\t\t\t\t.addTo(this.map);\n\t\t}\n\n\t\tif (this.popupRightClick && !this.props.popup_visible) {\n\t\t\tthis.popupRightClick.remove();\n\t\t}\n\n\t\tif (!equal(prevProps.current_place, this.props.current_place) && this.props.current_place) {\n\t\t\tconst selectedPlace = this.props.current_place;\n\n\t\t\tthis.map.flyTo({\n\t\t\t\tcenter: [selectedPlace.geometry.location.lng, selectedPlace.geometry.location.lat],\n\t\t\t\tzoom: 15,\n\t\t\t\tspeed: 1.5,\n\t\t\t\tcurve: 1,\n\t\t\t});\n\t\t\tthis.props.dispatch(setCollapsedInfoBoxAction(false));\n\t\t\tthis.props.dispatch(setRedMarkerAction(false));\n\t\t\tthis.setState({\n\t\t\t\tbottomInfoVisible: false,\n\t\t\t});\n\t\t}\n\n\t\tif (!equal(prevProps.viewport, this.props.viewport) && this.props.viewport) {\n\t\t\tthis.map.flyTo({\n\t\t\t\tcenter: [this.props.viewport.longitude, this.props.viewport.latitude],\n\t\t\t\tzoom: this.props.viewport.zoom,\n\t\t\t\tspeed: 2,\n\t\t\t});\n\t\t}\n\n\t\tif (!equal(prevProps.around_place_center, this.props.around_place_center)) {\n\t\t\tthis.props.dispatch(setRedMarkerAction(false));\n\t\t}\n\n\t\tif (!equal(prevProps.boxVisible, this.props.boxVisible) && this.props.boxVisible === 'navigation') {\n\t\t\tthis.removeMarkerPopup();\n\t\t}\n\n\t\tif (!equal(prevProps.result_select, this.props.result_select) || !equal(prevProps.result_navigation, this.props.result_navigation)) {\n\t\t\tconst { result_select, result_navigation, boxVisible, from_place, to_place } = this.props;\n\t\t\tlet dashedLineGeoJSON = [],\n\t\t\t\tpolylineGeoJSON = [];\n\t\t\tthis.result_navigation = [];\n\n\t\t\tif ((boxVisible !== 'navigation' && boxVisible !== 'iframe') || !result_navigation) {\n\t\t\t\t// Remove cac layer/source\n\t\t\t\tif (this.map.getLayer(`route-layer-fastest`)) this.map.removeLayer(`route-layer-fastest`);\n\t\t\t\tif (this.map.getLayer(`route-layer-shortest`)) this.map.removeLayer(`route-layer-shortest`);\n\t\t\t\tif (this.map.getLayer(`walk-layer-0`)) this.map.removeLayer(`walk-layer-0`);\n\t\t\t\tif (this.map.getLayer(`walk-layer-1`)) this.map.removeLayer(`walk-layer-1`);\n\n\t\t\t\tif (this.map.getSource(`route-source-fastest`)) this.map.removeSource(`route-source-fastest`);\n\t\t\t\tif (this.map.getSource(`route-source-shortest`)) this.map.removeSource(`route-source-shortest`);\n\t\t\t\tif (this.map.getSource(`walk-source-0`)) this.map.removeSource(`walk-source-0`);\n\t\t\t\tif (this.map.getSource(`walk-source-1`)) this.map.removeSource(`walk-source-1`);\n\n\t\t\t\tthis.popup_navigation[0]?.remove();\n\t\t\t\tthis.popup_navigation[1]?.remove();\n\t\t\t} else {\n\t\t\t\tif (result_navigation) {\n\t\t\t\t\tlet distance = '';\n\t\t\t\t\tif (localStorage.getItem('unit') === 'KILOMETERS') {\n\t\t\t\t\t\tdistance = `${(result_navigation.fastest[0].legs[0].distance.value / 1000).toFixed(1)} KM`;\n\t\t\t\t\t} else if (localStorage.getItem('unit') === 'MILES') {\n\t\t\t\t\t\tdistance = `${((result_navigation.fastest[0].legs[0].distance.value / 1000) * Mile_Travel.MILES).toFixed(1)} Dặm`;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tdistance = `${(result_navigation.fastest[0].legs[0].distance.value / 1000).toFixed(1)} KM`;\n\t\t\t\t\t}\n\t\t\t\t\tlet coordinateObject1 = {};\n\t\t\t\t\tcoordinateObject1.coordinates = this.decodePolyline(result_navigation.fastest[0].overview_polyline.points);\n\t\t\t\t\tcoordinateObject1.type = 'LineString';\n\t\t\t\t\tpolylineGeoJSON.push(coordinateObject1);\n\t\t\t\t\tpolylineGeoJSON[0].roadWay = 'fastest';\n\t\t\t\t\tlet coordinateObject2 = {};\n\t\t\t\t\tcoordinateObject2.coordinates = this.decodePolyline(result_navigation.shortest[0].overview_polyline.points);\n\t\t\t\t\tcoordinateObject2.type = 'LineString';\n\t\t\t\t\tpolylineGeoJSON.push(coordinateObject2);\n\t\t\t\t\tpolylineGeoJSON[1].roadWay = 'shortest';\n\n\t\t\t\t\tdashedLineGeoJSON.push({\n\t\t\t\t\t\ttype: 'LineString',\n\t\t\t\t\t\tcoordinates: [\n\t\t\t\t\t\t\t[polylineGeoJSON[0].coordinates[0][0], polylineGeoJSON[0].coordinates[0][1]],\n\t\t\t\t\t\t\t[from_place?.geometry.location.lng, from_place?.geometry.location.lat],\n\t\t\t\t\t\t],\n\t\t\t\t\t});\n\t\t\t\t\tdashedLineGeoJSON.push({\n\t\t\t\t\t\ttype: 'LineString',\n\t\t\t\t\t\tcoordinates: [\n\t\t\t\t\t\t\t[polylineGeoJSON[0].coordinates[polylineGeoJSON[0].coordinates.length - 1][0], polylineGeoJSON[0].coordinates[polylineGeoJSON[0].coordinates.length - 1][1]],\n\t\t\t\t\t\t\t[to_place?.geometry.location.lng, to_place?.geometry.location.lat],\n\t\t\t\t\t\t],\n\t\t\t\t\t});\n\n\t\t\t\t\tpolylineGeoJSON.map((item, i) => {\n\t\t\t\t\t\t// Layer dan duong\n\t\t\t\t\t\tif (this.map.getLayer(`route-layer-${item.roadWay}`)) this.map.removeLayer(`route-layer-${item.roadWay}`);\n\t\t\t\t\t\tif (this.map.getSource(`route-source-${item.roadWay}`)) this.map.removeSource(`route-source-${item.roadWay}`);\n\t\t\t\t\t\tthis.map.addSource(`route-source-${item.roadWay}`, {\n\t\t\t\t\t\t\ttype: 'geojson',\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\ttype: 'Feature',\n\t\t\t\t\t\t\t\tproperties: {},\n\t\t\t\t\t\t\t\tgeometry: item,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.map.addLayer({\n\t\t\t\t\t\t\tid: `route-layer-${item.roadWay}`,\n\t\t\t\t\t\t\ttype: 'line',\n\t\t\t\t\t\t\tsource: `route-source-${item.roadWay}`,\n\t\t\t\t\t\t\tlayout: {\n\t\t\t\t\t\t\t\t'line-join': 'round',\n\t\t\t\t\t\t\t\t'line-cap': 'round',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tpaint: {\n\t\t\t\t\t\t\t\t'line-color': 'rgb(24, 144, 255)',\n\t\t\t\t\t\t\t\t'line-width': 7,\n\t\t\t\t\t\t\t\t'line-opacity': item.roadWay === result_select ? 1 : 0.5,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t\t// Layer di bo\n\n\t\t\t\t\t\tif (this.map.getLayer(`walk-layer-${i}`)) this.map.removeLayer(`walk-layer-${i}`);\n\t\t\t\t\t\tif (this.map.getSource(`walk-source-${i}`)) this.map.removeSource(`walk-source-${i}`);\n\t\t\t\t\t\tthis.map.addSource(`walk-source-${i}`, {\n\t\t\t\t\t\t\ttype: 'geojson',\n\t\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\t\ttype: 'Feature',\n\t\t\t\t\t\t\t\tproperties: {},\n\t\t\t\t\t\t\t\tgeometry: dashedLineGeoJSON[i],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t\tthis.map.addLayer({\n\t\t\t\t\t\t\tid: `walk-layer-${i}`,\n\t\t\t\t\t\t\ttype: 'line',\n\t\t\t\t\t\t\tsource: `walk-source-${i}`,\n\t\t\t\t\t\t\tlayout: {\n\t\t\t\t\t\t\t\t'line-join': 'round',\n\t\t\t\t\t\t\t\t'line-cap': 'round',\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tpaint: {\n\t\t\t\t\t\t\t\t'line-color': 'rgb(133, 135, 126)',\n\t\t\t\t\t\t\t\t'line-opacity': 1,\n\t\t\t\t\t\t\t\t'line-width': 6,\n\t\t\t\t\t\t\t\t'line-dasharray': [0.2, 2],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t\t// Add Popup hien ket qua\n\n\t\t\t\t\t\tif (this.popup_navigation[i]) {\n\t\t\t\t\t\t\tthis.popup_navigation[i]?.remove();\n\t\t\t\t\t\t\tthis.popup_navigation[i] = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis.popup_navigation[i] = new maplibregl.Popup({\n\t\t\t\t\t\t\tcloseButton: false,\n\t\t\t\t\t\t\tanchor: 'top',\n\t\t\t\t\t\t\tcloseOnClick: false,\n\t\t\t\t\t\t\tclassName: item.roadWay === result_select ? 'popup-z-index1' : 'popup-z-index2',\n\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.setLngLat([i === 0 ? item.coordinates[Math.trunc(0.75 * item.coordinates.length)][0] : item.coordinates[Math.trunc(0.25 * item.coordinates.length)][0], i === 0 ? item.coordinates[Math.trunc(item.coordinates.length * 0.75)][1] : item.coordinates[Math.trunc(item.coordinates.length * 0.25)][1]])\n\t\t\t\t\t\t\t.setHTML(\n\t\t\t\t\t\t\t\tReactDOMServer.renderToStaticMarkup(\n\t\t\t\t\t\t\t\t\t<div\n\t\t\t\t\t\t\t\t\t\tclassName=\"tooltipNavigation\"\n\t\t\t\t\t\t\t\t\t\tid={`popup-${item.roadWay}`}>\n\t\t\t\t\t\t\t\t\t\t<p>{distance}</p>\n\t\t\t\t\t\t\t\t\t\t<p>{result_navigation[item.roadWay][0].legs[0].duration.text}</p>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t.setMaxWidth('300px')\n\t\t\t\t\t\t\t.addTo(this.map);\n\t\t\t\t\t\tdocument.getElementById(`popup-${item.roadWay}`).addEventListener('click', () => {\n\t\t\t\t\t\t\tthis.props.dispatch(selectResultAction(item.roadWay));\n\t\t\t\t\t\t});\n\t\t\t\t\t\tconst normalizeBounds = (bounds) => {\n\t\t\t\t\t\t\tconst [firstPoint, secondPoint] = bounds;\n\n\t\t\t\t\t\t\tconst minLat = Math.min(firstPoint[1], secondPoint[1]);\n\t\t\t\t\t\t\tconst maxLat = Math.max(firstPoint[1], secondPoint[1]);\n\n\t\t\t\t\t\t\tconst minLng = Math.min(firstPoint[0], secondPoint[0]);\n\t\t\t\t\t\t\tconst maxLng = Math.max(firstPoint[0], secondPoint[0]);\n\n\t\t\t\t\t\t\treturn [\n\t\t\t\t\t\t\t\t[minLng, minLat],\n\t\t\t\t\t\t\t\t[maxLng, maxLat],\n\t\t\t\t\t\t\t];\n\t\t\t\t\t\t};\n\t\t\t\t\t\tconst bound = normalizeBounds([item.coordinates[0], item.coordinates[item.coordinates.length - 1]]);\n\t\t\t\t\t\tif (isMobile) {\n\t\t\t\t\t\t\tthis.navigationView = this.map.cameraForBounds(bound, {\n\t\t\t\t\t\t\t\tpadding: { top: 10, bottom: 25, left: 24, right: 24 },\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.navigationView = this.map.cameraForBounds(bound, {\n\t\t\t\t\t\t\t\tpadding: { top: 40, bottom: 40, left: 200, right: 40 },\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tthis.view = {\n\t\t\t\t\t\tlatitude: this.navigationView.center.lat,\n\t\t\t\t\t\tlongitude: this.navigationView.center.lng,\n\t\t\t\t\t\tzoom: this.navigationView.zoom,\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.props.dispatch(setMapViewportAction(this.view));\n\t\t}\n\t\tif (!equal(prevProps.from_place, this.props.from_place)) {\n\t\t\tconst place = this.props.from_place;\n\t\t\tif (place) {\n\t\t\t\tconst popup = new maplibregl.Popup({\n\t\t\t\t\toffset: [0, -18],\n\t\t\t\t\tclassName: 'tooltip-marker',\n\t\t\t\t\tcloseButton: false,\n\t\t\t\t})\n\t\t\t\t\t.setHTML(`<div class=\"ant-tooltip-inner tooltip-info-location\">${place.name}</div>`)\n\t\t\t\t\t.setMaxWidth('150px');\n\t\t\t\tif (this.start_marker) {\n\t\t\t\t\tthis.start_marker = this.start_marker.setLngLat(place.geometry.location).setPopup(popup).addTo(this.map);\n\t\t\t\t} else {\n\t\t\t\t\tconst marker_start = document.createElement('div');\n\t\t\t\t\tmarker_start.innerHTML = ReactDOMServer.renderToStaticMarkup(\n\t\t\t\t\t\t<div className=\"marker-start\">\n\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\tsrc={images.button}\n\t\t\t\t\t\t\t\tstyle={{ width: 12 }}\n\t\t\t\t\t\t\t\talt=\"\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t);\n\t\t\t\t\tthis.start_marker = new maplibregl.Marker({\n\t\t\t\t\t\tanchor: 'center',\n\t\t\t\t\t\telement: marker_start,\n\t\t\t\t\t})\n\t\t\t\t\t\t.setPopup(popup)\n\t\t\t\t\t\t.setLngLat(place.geometry.location)\n\t\t\t\t\t\t.addTo(this.map);\n\t\t\t\t\tthis.start_marker.getElement().addEventListener('contextmenu', (e) => {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tconst lngLat = this.start_marker.getLngLat();\n\t\t\t\t\t\tthis.props.dispatch(setPopupRightClick(true, lngLat, 'popupFromPlace'));\n\t\t\t\t\t\tthis.props.dispatch(setRedMarkerAction(false));\n\t\t\t\t\t});\n\t\t\t\t\tthis.start_marker.getElement().addEventListener('click', () => {\n\t\t\t\t\t\tif (popup.isOpen()) {\n\t\t\t\t\t\t\tthis.start_marker.togglePopup();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tthis.start_marker.getElement().addEventListener('mouseenter', () => this.start_marker.togglePopup());\n\t\t\t\t\tthis.start_marker.getElement().addEventListener('mouseleave', () => this.start_marker.togglePopup());\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (equal(this.start_marker.getLngLat(), this.props.position_popup)) {\n\t\t\t\t\tthis.props.dispatch(setPopupRightClick(false));\n\t\t\t\t}\n\t\t\t\tif (equal(prevProps.from_place?.place_id, this.state.placeMouseClick?.place_id)) {\n\t\t\t\t\tthis.changeVisibleBottomInfo(false);\n\t\t\t\t}\n\t\t\t\tthis.changeVisibleBottomInfo(false);\n\t\t\t\tthis.start_marker ? this.start_marker.remove() : null;\n\t\t\t}\n\t\t}\n\n\t\tif (!equal(prevProps.to_place, this.props.to_place)) {\n\t\t\tconst place = this.props.to_place;\n\t\t\tif (place) {\n\t\t\t\tconst popup = new maplibregl.Popup({\n\t\t\t\t\toffset: [0, -18],\n\t\t\t\t\tclassName: 'tooltip-marker',\n\t\t\t\t\tcloseButton: false,\n\t\t\t\t})\n\t\t\t\t\t.setHTML(`<div class=\"ant-tooltip-inner tooltip-info-location\">${place.name}</div>`)\n\t\t\t\t\t.setMaxWidth('150px');\n\t\t\t\tif (this.end_marker) {\n\t\t\t\t\tthis.to_place = this.end_marker.setPopup(popup).setLngLat(place.geometry.location).addTo(this.map);\n\t\t\t\t} else {\n\t\t\t\t\tconst marker_end = document.createElement('div');\n\t\t\t\t\tmarker_end.innerHTML = ReactDOMServer.renderToStaticMarkup(\n\t\t\t\t\t\t<div className=\"marker-end\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\tsrc={images.marker}\n\t\t\t\t\t\t\t\t\talt=\"\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t);\n\t\t\t\t\tthis.end_marker = new maplibregl.Marker({\n\t\t\t\t\t\tanchor: 'center',\n\t\t\t\t\t\telement: marker_end,\n\t\t\t\t\t})\n\t\t\t\t\t\t.setPopup(popup)\n\t\t\t\t\t\t.setLngLat(place.geometry.location)\n\t\t\t\t\t\t.addTo(this.map);\n\t\t\t\t\tthis.end_marker.getElement().addEventListener('contextmenu', (e) => {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tconst lngLat = this.end_marker.getLngLat();\n\t\t\t\t\t\tthis.props.dispatch(setPopupRightClick(true, lngLat, 'popupToPlace'));\n\t\t\t\t\t\tthis.props.dispatch(setRedMarkerAction(false));\n\t\t\t\t\t});\n\t\t\t\t\tthis.end_marker.getElement().addEventListener('click', () => {\n\t\t\t\t\t\tif (popup.isOpen()) {\n\t\t\t\t\t\t\tthis.end_marker.togglePopup();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t\tthis.end_marker.getElement().addEventListener('mouseenter', () => this.end_marker.togglePopup());\n\t\t\t\t\tthis.end_marker.getElement().addEventListener('mouseleave', () => this.end_marker.togglePopup());\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (equal(this.start_marker?.getLngLat(), this.props.position_popup)) {\n\t\t\t\t\tthis.props.dispatch(setPopupRightClick(false));\n\t\t\t\t}\n\n\t\t\t\tif (equal(prevProps.to_place?.place_id, this.state.placeMouseClick?.place_id)) {\n\t\t\t\t\tthis.changeVisibleBottomInfo(false);\n\t\t\t\t}\n\t\t\t\tthis.end_marker ? this.end_marker.remove() : null;\n\t\t\t}\n\t\t}\n\n\t\tif (!equal(prevProps.around_places, this.props.around_places) || !equal(prevProps.around_place_select, this.props.around_place_select)) {\n\t\t\tif (this.list_marker_around?.length > 0) {\n\t\t\t\tthis.list_marker_around.forEach((item) => {\n\t\t\t\t\titem.remove();\n\t\t\t\t});\n\t\t\t\tthis.list_marker_around = [];\n\t\t\t}\n\t\t\tconst { around_places, around_place_center } = this.props;\n\t\t\tif (around_places.length > 0) {\n\t\t\t\tthis.list_marker_around = [];\n\t\t\t\tlet el = document.createElement('div');\n\t\t\t\tel.innerHTML = ReactDOMServer.renderToStaticMarkup(\n\t\t\t\t\t<Marker\n\t\t\t\t\t\tid=\"marker-center\"\n\t\t\t\t\t\ttype=\"center\"\n\t\t\t\t\t/>\n\t\t\t\t);\n\t\t\t\tthis.list_marker_around[0] = new maplibregl.Marker(el, {\n\t\t\t\t\tanchor: 'bottom',\n\t\t\t\t})\n\t\t\t\t\t.setPopup(\n\t\t\t\t\t\tnew maplibregl.Popup({\n\t\t\t\t\t\t\toffset: [0, -32],\n\t\t\t\t\t\t\tclassName: 'tooltip-marker',\n\t\t\t\t\t\t\tcloseButton: false,\n\t\t\t\t\t\t})\n\t\t\t\t\t\t\t.setHTML(`<div class=\"ant-tooltip-inner tooltip-info-location\">${around_place_center.name}</div>`)\n\t\t\t\t\t\t\t.setMaxWidth('150px')\n\t\t\t\t\t)\n\t\t\t\t\t.setLngLat(around_place_center.geometry.location)\n\t\t\t\t\t.addTo(this.map);\n\t\t\t\tconst markerCenterDiv = this.list_marker_around[0].getElement();\n\n\t\t\t\tmarkerCenterDiv.addEventListener('click', () => {\n\t\t\t\t\tthis._selectAroundPlace('center', around_place_center);\n\t\t\t\t\tthis.props.dispatch(setRedMarkerAction(false));\n\t\t\t\t\tif (this.list_marker_around[0].getPopup().isOpen()) {\n\t\t\t\t\t\tthis.list_marker_around[0].togglePopup();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tmarkerCenterDiv.addEventListener('contextmenu', (e) => {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tthis.props.dispatch(setRedMarkerAction(false));\n\t\t\t\t\tthis.props.dispatch(setPopupRightClick(true, around_place_center.geometry.location, 'normal'));\n\t\t\t\t});\n\n\t\t\t\tmarkerCenterDiv.addEventListener('mouseenter', () => this.list_marker_around[0].togglePopup());\n\t\t\t\tmarkerCenterDiv.addEventListener('mouseleave', () => this.list_marker_around[0].togglePopup());\n\n\t\t\t\taround_places.forEach((item, i) => {\n\t\t\t\t\tconst popup = new maplibregl.Popup({\n\t\t\t\t\t\toffset: [0, -32],\n\t\t\t\t\t\tclassName: 'tooltip-marker',\n\t\t\t\t\t\tcloseButton: false,\n\t\t\t\t\t\tanchor: 'bottom',\n\t\t\t\t\t})\n\t\t\t\t\t\t.setHTML(`<div class=\"ant-tooltip-inner tooltip-info-location\">${item.name}</div>`)\n\t\t\t\t\t\t.setMaxWidth('150px');\n\t\t\t\t\tel = document.createElement('div');\n\t\t\t\t\tel.innerHTML = ReactDOMServer.renderToStaticMarkup(\n\t\t\t\t\t\t<Marker\n\t\t\t\t\t\t\ttype=\"around\"\n\t\t\t\t\t\t\tplace={item}\n\t\t\t\t\t\t\tplace_select={this.props.around_place_select}\n\t\t\t\t\t\t\tid={`marker-around-${i}`}\n\t\t\t\t\t\t/>\n\t\t\t\t\t);\n\t\t\t\t\tthis.list_marker_around.push(\n\t\t\t\t\t\tnew maplibregl.Marker(el, { anchor: 'bottom' })\n\t\t\t\t\t\t\t.setPopup(popup)\n\t\t\t\t\t\t\t.setLngLat([item.lng_lat[0] * 1, item.lng_lat[1] * 1])\n\t\t\t\t\t\t\t.addTo(this.map)\n\t\t\t\t\t);\n\t\t\t\t\tconst markerDiv = this.list_marker_around[i + 1].getElement();\n\n\t\t\t\t\tmarkerDiv.addEventListener('click', (e) => {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\tthis.props.dispatch(setRedMarkerAction(false));\n\t\t\t\t\t\tthis._selectAroundPlace('around', item);\n\t\t\t\t\t\tif (popup.isOpen()) {\n\t\t\t\t\t\t\tthis.list_marker_around[i + 1].togglePopup();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tmarkerDiv.addEventListener('contextmenu', (e) => {\n\t\t\t\t\t\te.stopPropagation();\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tthis.props.dispatch(setPopupRightClick(true, { lng: item.lng_lat[0] * 1, lat: item.lng_lat[1] * 1 }, 'around'));\n\t\t\t\t\t\tthis.props.dispatch(setRedMarkerAction(false));\n\t\t\t\t\t});\n\n\t\t\t\t\tmarkerDiv.addEventListener('mouseenter', () => this.list_marker_around[i + 1].togglePopup());\n\t\t\t\t\tmarkerDiv.addEventListener('mouseleave', () => this.list_marker_around[i + 1].togglePopup());\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (this.props.boxVisible === 'info' && this.props.current_place) {\n\t\t\tif (!this.markerCurrentPlace) {\n\t\t\t\tconst el = document.createElement('div');\n\t\t\t\tel.innerHTML = ReactDOMServer.renderToStaticMarkup(\n\t\t\t\t\t// <Marker type=\"normal\" />\n\t\t\t\t\t<div className=\"marker-histories\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\tsrc={images.marker}\n\t\t\t\t\t\t\t\talt=\"\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t);\n\t\t\t\t// Marker info\n\t\t\t\tthis.markerCurrentPlace = new maplibregl.Marker({\n\t\t\t\t\tanchor: 'bottom',\n\t\t\t\t\telement: el,\n\t\t\t\t})\n\t\t\t\t\t.setLngLat(this.props.current_place?.geometry?.location)\n\t\t\t\t\t.addTo(this.map);\n\t\t\t\tthis.markerCurrentPlace.getElement().addEventListener('contextmenu', (e) => {\n\t\t\t\t\te.stopPropagation();\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tconst lngLat = this.markerCurrentPlace.getLngLat();\n\t\t\t\t\tthis.props.dispatch(setPopupRightClick(true, lngLat, 'popupCurrentPlace'));\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.markerCurrentPlace.setLngLat(this.props.current_place.geometry.location).addTo(this.map);\n\t\t\t}\n\t\t}\n\n\t\tif (this.props.boxVisible !== 'info' && this.markerCurrentPlace) {\n\t\t\tthis.markerCurrentPlace.remove();\n\t\t\tthis.markerCurrentPlace = null;\n\t\t}\n\t\tif (this.props.boxVisible === 'detailsrestaurant' && this.props.restaurantData) {\n\t\t\tif (this.props.restaurantData.length !== 0) {\n\t\t\t\tfor (let item of this.props.restaurantData) {\n\t\t\t\t\tconst marker_restaurant = document.createElement('div');\n\t\t\t\t\tmarker_restaurant.innerHTML = ReactDOMServer.renderToStaticMarkup(\n\t\t\t\t\t\t// <MarkerNavigation id=\"end-marker\" type=\"histories\" />\n\t\t\t\t\t\t<div className=\"marker-histories\">\n\t\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\t\tsrc={images.marker}\n\t\t\t\t\t\t\t\t\talt=\"\"\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t);\n\t\t\t\t\tthis.restaurant_marker = new maplibregl.Marker({\n\t\t\t\t\t\tanchor: 'center',\n\t\t\t\t\t\telement: marker_restaurant,\n\t\t\t\t\t})\n\t\t\t\t\t\t// .setPopup(popup)\n\t\t\t\t\t\t.setLngLat(item.geometry.location)\n\t\t\t\t\t\t.addTo(this.map);\n\t\t\t\t\tthis.listRestaurant.push(this.restaurant_marker);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// console.log('Có')\n\t\t\t\tfor (let marker of this.listRestaurant) {\n\t\t\t\t\tmarker.remove();\n\t\t\t\t}\n\t\t\t\tthis.listRestaurant = [];\n\t\t\t}\n\t\t}\n\n\t\tif (this.props.boxVisible === 'history') {\n\t\t\tfor (let marker of this.listHistories) {\n\t\t\t\tmarker.remove();\n\t\t\t}\n\t\t\tfor (let item of this.props.searchLocalStorage) {\n\t\t\t\tconst marker_history = document.createElement('div');\n\t\t\t\tmarker_history.innerHTML = ReactDOMServer.renderToStaticMarkup(\n\t\t\t\t\t<div className=\"marker-histories\">\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<img\n\t\t\t\t\t\t\t\tsrc={images.marker}\n\t\t\t\t\t\t\t\talt=\"\"\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t);\n\t\t\t\tthis.history_marker = new maplibregl.Marker({\n\t\t\t\t\tanchor: 'center',\n\t\t\t\t\telement: marker_history,\n\t\t\t\t})\n\t\t\t\t\t.setLngLat(item.location)\n\t\t\t\t\t.addTo(this.map);\n\t\t\t\tthis.listHistories.push(this.history_marker);\n\t\t\t}\n\t\t} else {\n\t\t\tfor (let marker of this.listHistories) {\n\t\t\t\tmarker.remove();\n\t\t\t}\n\t\t}\n\n\t\t// if (this.props.boxVisible === \"details\") {\n\t\tif (this.props.result_navigation && this.props.boxVisible === 'details') {\n\t\t\tfor (let step of this.props.result_navigation.fastest[0].legs[0].steps) {\n\t\t\t\tconst popup = new maplibregl.Popup({ offset: [0, -32], className: 'tooltip-marker', closeButton: false, anchor: 'bottom' }).setHTML(`<div class=\"ant-tooltip-inner tooltip-info-location\">${step.html_instructions}</div>`).setMaxWidth('150px');\n\t\t\t\tconst marker_step = document.createElement('div');\n\t\t\t\tmarker_step.innerHTML = ReactDOMServer.renderToStaticMarkup(<div className=\"marker-details\"></div>);\n\t\t\t\tthis.step_marker = new maplibregl.Marker({ anchor: 'center', element: marker_step }).setPopup(popup).setLngLat(step.end_location).addTo(this.map);\n\t\t\t\tthis.list.push(this.step_marker);\n\t\t\t}\n\t\t} else {\n\t\t\tfor (let marker of this.list) {\n\t\t\t\tmarker.remove();\n\t\t\t}\n\t\t\tthis.list = [];\n\t\t}\n\t\t// }\n\t\tif (this.props.boxVisible === 'navigation' && isMobile) {\n\t\t\tif (this.props.result_navigation) {\n\t\t\t\tfor (let step of this.props.result_navigation.fastest[0].legs[0].steps) {\n\t\t\t\t\tconst popup = new maplibregl.Popup({ offset: [0, -32], className: 'tooltip-marker', closeButton: false, anchor: 'bottom' }).setHTML(`<div class=\"ant-tooltip-inner tooltip-info-location\">${step.html_instructions}</div>`).setMaxWidth('150px');\n\t\t\t\t\tconst marker_step = document.createElement('div');\n\t\t\t\t\tmarker_step.innerHTML = ReactDOMServer.renderToStaticMarkup(<div className=\"marker-details\"></div>);\n\t\t\t\t\tthis.step_marker = new maplibregl.Marker({ anchor: 'center', element: marker_step }).setPopup(popup).setLngLat(step.end_location).addTo(this.map);\n\t\t\t\t\tthis.list.push(this.step_marker);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (let marker of this.list) {\n\t\t\t\t\tmarker.remove();\n\t\t\t\t}\n\t\t\t\tthis.list = [];\n\t\t\t}\n\t\t}\n\t}\n\n\tdecodePolyline(encoded) {\n\t\tvar points = [];\n\t\tvar index = 0,\n\t\t\tlen = encoded.length;\n\t\tvar lat = 0,\n\t\t\tlng = 0;\n\n\t\twhile (index < len) {\n\t\t\tvar b,\n\t\t\t\tshift = 0,\n\t\t\t\tresult = 0;\n\t\t\tdo {\n\t\t\t\tb = encoded.charAt(index++).charCodeAt(0) - 63;\n\t\t\t\tresult |= (b & 0x1f) << shift;\n\t\t\t\tshift += 5;\n\t\t\t} while (b >= 0x20);\n\t\t\tvar dlat = result & 1 ? ~(result >> 1) : result >> 1;\n\t\t\tlat += dlat;\n\n\t\t\tshift = 0;\n\t\t\tresult = 0;\n\t\t\tdo {\n\t\t\t\tb = encoded.charAt(index++).charCodeAt(0) - 63;\n\t\t\t\tresult |= (b & 0x1f) << shift;\n\t\t\t\tshift += 5;\n\t\t\t} while (b >= 0x20);\n\t\t\tvar dlng = result & 1 ? ~(result >> 1) : result >> 1;\n\t\t\tlng += dlng;\n\n\t\t\tpoints.push([lng * 1e-5, lat * 1e-5]);\n\t\t}\n\n\t\treturn points;\n\t}\n\n\tchangeStyle = () => {\n\t\tconst { style } = this.state;\n\t\tif (style === STYLE_URL.SATELITE + STYLE_KEY) {\n\t\t\tthis.setState({\n\t\t\t\tstyle: STYLE_URL.NORMAL + STYLE_KEY,\n\t\t\t});\n\t\t\tthis.map.setStyle(STYLE_URL.NORMAL + STYLE_KEY);\n\t\t} else {\n\t\t\tthis.setState({\n\t\t\t\tstyle: STYLE_URL.SATELITE + STYLE_KEY,\n\t\t\t});\n\t\t\tthis.map.setStyle(STYLE_URL.SATELITE + STYLE_KEY);\n\t\t}\n\t};\n\n\tcomponentDidMount() {\n\t\twindow.addEventListener('storage', this.handleStorageChange);\n\t\t// console.log(STYLE_URL.NORMAL)\n\t\tconst selectedPlace = this.props.current_place;\n\t\tthis.map = new maplibregl.Map({\n\t\t\tcontainer: 'map', // container id\n\t\t\tstyle: STYLE_URL.NORMAL + STYLE_KEY,\n\t\t\tcenter: selectedPlace ? [selectedPlace.geometry.location.lng, selectedPlace.geometry.location.lat] : [DEFAULT_VIEWPORT.longitude, DEFAULT_VIEWPORT.latitude], // starting position [lng, lat]\n\t\t\tzoom: DEFAULT_VIEWPORT.zoom, // starting zoom\n\t\t});\n\t\tif (selectedPlace) this.props.dispatch(setRedMarkerAction(true, selectedPlace.geometry.location));\n\n\t\tthis.navigation = new maplibregl.NavigationControl();\n\t\tthis.geolocateControl = new maplibregl.GeolocateControl({\n\t\t\tpositionOptions: {\n\t\t\t\tenableHighAccuracy: true,\n\t\t\t},\n\t\t\t// Bật tắt hiển bị vị trí\n\t\t\ttrackUserLocation: true,\n\t\t\t// Hiển thị\n\t\t\tshowUserLocation: true,\n\t\t\t// Tắt vòng tròn to\n\t\t\tshowAccuracyCircle: false,\n\t\t\t// Điều chỉnh mức zoom đến vị trí của mình\n\t\t\tfitBoundsOptions: {\n\t\t\t\tmaxZoom: 15,\n\t\t\t},\n\t\t});\n\n\t\tthis.geolocateControl.on('error', () => {\n\t\t\tmessage.warning('Goong không thể lấy địa điểm hiện tại của bạn !');\n\t\t});\n\n\t\tthis.geolocateControl.on('geolocate', (e) => {\n\t\t\tthis.props.dispatch(\n\t\t\t\tsetMyLocationAction({\n\t\t\t\t\tlatitude: e.coords.latitude,\n\t\t\t\t\tlongitude: e.coords.longitude,\n\t\t\t\t})\n\t\t\t);\n\t\t});\n\n\t\t!isMobile && this.map.addControl(this.navigation);\n\t\t!isMobile && this.map.addControl(this.geolocateControl);\n\n\t\tthis.map.on('click', this._onMouseClick);\n\t\tthis.map.on('contextmenu', this._onRightClick);\n\t\tthis.map.on('load', () => {\n\t\t\tthis.map.resize();\n\n\t\t\tconst pid = new URLSearchParams(window.location.search).get('pid');\n\t\t\tconst location = new URLSearchParams(window.location.search).get('location')?.split(',');\n\t\t\tconst pid_around = new URLSearchParams(window.location.search).get('pid_around');\n\t\t\tconst direction_infor = new URLSearchParams(window.location.search).get('direction');\n\t\t\tif (!direction_infor && !pid && !location && !pid_around && !this.props.current_place) this.geolocateControl?.trigger();\n\t\t\telse {\n\t\t\t\tif (navigator.geolocation) {\n\t\t\t\t\tnavigator.geolocation.getCurrentPosition((position) => {\n\t\t\t\t\t\tthis.props.dispatch(\n\t\t\t\t\t\t\tsetMyLocationAction({\n\t\t\t\t\t\t\t\tlatitude: position.coords.latitude,\n\t\t\t\t\t\t\t\tlongitude: position.coords.longitude,\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tthis.map.on('move', () => {\n\t\t\tthis.props.dispatch(\n\t\t\t\tsetCenterLatLngAction({\n\t\t\t\t\tlatitude: this.map.getCenter().lat,\n\t\t\t\t\tlongitude: this.map.getCenter().lng,\n\t\t\t\t})\n\t\t\t);\n\t\t});\n\t\tthis.map.on('style.load', () => {\n\t\t\tthis.map?.addLayer({\n\t\t\t\tid: '3d-buildings',\n\t\t\t\tsource: 'composite',\n\t\t\t\t'source-layer': 'VN_Building',\n\t\t\t\tfilter: ['==', 'extrude', 'true'],\n\t\t\t\ttype: 'fill-extrusion',\n\t\t\t\tminzoom: 15,\n\t\t\t\tpaint: {\n\t\t\t\t\t'fill-extrusion-color': '#aaa',\n\t\t\t\t\t'fill-extrusion-height': {\n\t\t\t\t\t\ttype: 'identity',\n\t\t\t\t\t\tproperty: 'height',\n\t\t\t\t\t},\n\t\t\t\t\t'fill-extrusion-base': {\n\t\t\t\t\t\ttype: 'identity',\n\t\t\t\t\t\tproperty: 'min_height',\n\t\t\t\t\t},\n\t\t\t\t\t'fill-extrusion-opacity': 0.4,\n\t\t\t\t},\n\t\t\t});\n\t\t\tif (this.props.result_navigation) {\n\t\t\t\tif (this.props.result_select === 'fastest') {\n\t\t\t\t\tthis.props.dispatch(selectResultAction('shortest'));\n\t\t\t\t\tthis.props.dispatch(selectResultAction('fastest'));\n\t\t\t\t} else {\n\t\t\t\t\tthis.props.dispatch(selectResultAction('fastest'));\n\t\t\t\t\tthis.props.dispatch(selectResultAction('shortest'));\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tdocument.body.addEventListener('click', this._onClickMenu);\n\t\t// this.map.on('click', 'route-layer-fastest', (e) => {\n\t\t//   console.log(e, 'fastest');\n\t\t//   e.originalEvent.stopPropagation();\n\t\t//   e.originalEvent.preventDefault();\n\t\t// });\n\n\t\t// this.map.on('click', 'route-layer-shortest', (e) => {\n\t\t//   console.log(e)\n\t\t// });\n\n\t\tconst direction_infor = new URLSearchParams(window.location.search).get('direction');\n\t\tconst iframe = new URLSearchParams(window.location.search).get('iframe');\n\t\tif (direction_infor) {\n\t\t\tconst coor_from = {\n\t\t\t\tlat: direction_infor.split('&')[0].split(',')[0],\n\t\t\t\tlng: direction_infor.split('&')[0].split(',')[1],\n\t\t\t};\n\t\t\tconst coor_to = {\n\t\t\t\tlat: direction_infor.split('&')[1].split(',')[0],\n\t\t\t\tlng: direction_infor.split('&')[1].split(',')[1],\n\t\t\t};\n\t\t\tif (coor_from.lat && coor_from.lng && coor_to.lat && coor_to.lng) {\n\t\t\t\t// this.handleFromHere(coor_from.lat, coor_from.lng);\n\t\t\t\t// this.handleToHere(coor_to.lat, coor_to.lng);\n\t\t\t\tif (iframe != null) {\n\t\t\t\t\tthis.navigationByURLIframe(coor_from, coor_to);\n\t\t\t\t} else {\n\t\t\t\t\tthis.navigationByURL(coor_from, coor_to);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Fetch parking lots\n\t\tthis.props.dispatch(getParkingLotsRequest());\n\t}\n\n\tnavigationByURLIframe = async (from, to) => {\n\t\tthis.props.dispatch(setBoxVisibleAction('iframe'));\n\n\t\tthis.props.dispatch(setRedMarkerAction(false));\n\t\tthis.changeVisibleBottomInfo(false);\n\t\tlet fromplace;\n\t\tif (!from.lat || !from.lng) fromplace = await this._getInforPlace();\n\t\telse {\n\t\t\tfromplace = await this._getInforPlace(from.lat, from.lng);\n\t\t}\n\t\tawait this.props.dispatch(navigationFromAction(fromplace, `${fromplace.name} - ${fromplace.formatted_address}`));\n\t\tlet toplace;\n\t\tif (!to.lat || !to.lng) toplace = await this._getInforPlace();\n\t\telse {\n\t\t\ttoplace = await this._getInforPlace(to.lat, to.lng);\n\t\t}\n\t\tawait this.props.dispatch(navigationToAction(toplace, `${toplace.name} - ${toplace.formatted_address}`));\n\t\tthis.props.dispatch(navigationAction(this.props.from_place, this.props.to_place, 'car'));\n\t};\n\n\tnavigationByURL = async (from, to) => {\n\t\tthis.props.dispatch(setBoxVisibleAction('navigation'));\n\t\tthis.props.dispatch(setRedMarkerAction(false));\n\t\tthis.changeVisibleBottomInfo(false);\n\t\tlet fromplace;\n\t\tif (!from.lat || !from.lng) fromplace = await this._getInforPlace();\n\t\telse {\n\t\t\tfromplace = await this._getInforPlace(from.lat, from.lng);\n\t\t}\n\t\tawait this.props.dispatch(navigationFromAction(fromplace, `${fromplace.name} - ${fromplace.formatted_address}`));\n\t\tlet toplace;\n\t\tif (!to.lat || !to.lng) toplace = await this._getInforPlace();\n\t\telse {\n\t\t\ttoplace = await this._getInforPlace(to.lat, to.lng);\n\t\t}\n\t\tawait this.props.dispatch(navigationToAction(toplace, `${toplace.name} - ${toplace.formatted_address}`));\n\t};\n\n\tcomponentWillUnmount() {\n\t\twindow.removeEventListener('storage', this.handleStorageChange);\n\t\tdocument.body.removeEventListener('click', this._onClickMenu);\n\t}\n\n\thandleStorageChange = (event) => {\n\t\tconsole.log('oppaopaopa');\n\t\tif (event.key === 'search_history') {\n\t\t\tthis.setState({ value: event.newValue });\n\t\t}\n\t};\n\n\trenderParkingLots = () => {\n\t\tconst { parkingLots } = this.props;\n\n\t\treturn parkingLots?.map(lot => {\n\t\t\t// Tạo element cho marker\n\t\t\tconst el = document.createElement('div');\n\t\t\tel.className = 'marker parking-marker';\n\t\t\tel.innerHTML = `\n\t\t\t\t<div class=\"marker-content\">P</div>\n\t\t\t\t<div class=\"marker-info\">\n\t\t\t\t\t<h3>${lot.name}</h3>\n\t\t\t\t\t<p>${lot.address}</p>\n\t\t\t\t\t<p>Available: ${lot.availableSpots}/${lot.capacity}</p>\n\t\t\t\t</div>\n\t\t\t`;\n\n\t\t\t// Tạo marker theo docs của Goong\n\t\t\tconst marker = new maplibregl.Marker({\n\t\t\t\telement: el,\n\t\t\t\tanchor: 'bottom',\n\t\t\t\toffset: [0, -10]\n\t\t\t})\n\t\t\t.setLngLat([lot.longitude, lot.latitude])\n\t\t\t.addTo(this.map);\n\n\t\t\t// Thêm sự kiện click\n\t\t\tmarker.getElement().addEventListener('click', () => {\n\t\t\t\tthis.handleParkingLotClick(lot);\n\t\t\t});\n\n\t\t\treturn marker;\n\t\t});\n\t};\n\n\thandleParkingLotClick = (lot) => {\n\t\t// Zoom đến vị trí parking lot\n\t\tthis.map.flyTo({\n\t\t\tcenter: [lot.longitude, lot.latitude],\n\t\t\tzoom: 15\n\t\t});\n\n\t\t// Hiển thị thông tin\n\t\tthis.setState({\n\t\t\tbottomInfoVisible: true,\n\t\t\tplaceMouseClick: {\n\t\t\t\tname: lot.name,\n\t\t\t\tformatted_address: lot.address,\n\t\t\t\tgeometry: {\n\t\t\t\t\tlocation: {\n\t\t\t\t\t\tlat: lot.latitude,\n\t\t\t\t\t\tlng: lot.longitude\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t};\n\n\trender() {\n\t\tconst { style, bottomInfoVisible, placeMouseClick } = this.state;\n\n\t\treturn (\n\t\t\t<React.Fragment>\n\t\t\t\t<Div100vh>\n\t\t\t\t\t<div id=\"map\">{this.renderParkingLots()}</div>\n\t\t\t\t\t<div>\n\t\t\t\t\t\t{!isMobile && (\n\t\t\t\t\t\t\t<Avatar\n\t\t\t\t\t\t\t\tshape=\"square\"\n\t\t\t\t\t\t\t\tsize={64}\n\t\t\t\t\t\t\t\tonClick={this.changeStyle}\n\t\t\t\t\t\t\t\tclassName=\"change-status-button\"\n\t\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\t\tbackgroundImage: style === STYLE_URL.NORMAL + STYLE_KEY ? `url(${satellite_img})` : `url(${normal_map_img})`,\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t)}\n\t\t\t\t\t\t{isMobile && (\n\t\t\t\t\t\t\t<Avatar\n\t\t\t\t\t\t\t\tshape=\"square\"\n\t\t\t\t\t\t\t\tsize={64}\n\t\t\t\t\t\t\t\tonClick={this.changeStyle}\n\t\t\t\t\t\t\t\tclassName=\"change-status-button\"\n\t\t\t\t\t\t\t\t// id='change-status-button--mobile'\n\t\t\t\t\t\t\t\tstyle={{\n\t\t\t\t\t\t\t\t\tbackgroundImage: style === STYLE_URL.NORMAL + STYLE_KEY ? `url(${satellite_img})` : `url(${normal_map_img})`,\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t)}\n\t\t\t\t\t</div>\n\t\t\t\t\t{bottomInfoVisible && (\n\t\t\t\t\t\t<BottomInfoLocation\n\t\t\t\t\t\t\tchangeVisibleBottomInfo={this.changeVisibleBottomInfo}\n\t\t\t\t\t\t\tlat={placeMouseClick.geometry?.location.lat || Number(placeMouseClick.lng_lat[1])}\n\t\t\t\t\t\t\tlng={placeMouseClick.geometry?.location.lng || Number(placeMouseClick.lng_lat[0])}\n\t\t\t\t\t\t\tname={placeMouseClick.name || placeMouseClick.address_components[0].long_name}\n\t\t\t\t\t\t\tisMarkerAround={placeMouseClick.marker_type_id}\n\t\t\t\t\t\t\tplace_id={placeMouseClick._id}\n\t\t\t\t\t\t\taddress={this.getAddressGeocode(placeMouseClick) || placeMouseClick.formatted_address || placeMouseClick.description.address}\n\t\t\t\t\t\t\tremoveMarker={this.removeMarkerWhatIs}\n\t\t\t\t\t\t/>\n\t\t\t\t\t)}\n\t\t\t\t</Div100vh>\n\t\t\t\t<style jsx>{`\n\t\t\t\t\t.parking-marker {\n\t\t\t\t\t\tbackground-color: #fff;\n\t\t\t\t\t\tborder-radius: 50%;\n\t\t\t\t\t\tcursor: pointer;\n\t\t\t\t\t\tpadding: 0;\n\t\t\t\t\t}\n\n\t\t\t\t\t.marker-content {\n\t\t\t\t\t\tbackground: #1890ff;\n\t\t\t\t\t\tcolor: white;\n\t\t\t\t\t\tborder-radius: 50%;\n\t\t\t\t\t\twidth: 32px;\n\t\t\t\t\t\theight: 32px;\n\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\talign-items: center;\n\t\t\t\t\t\tjustify-content: center;\n\t\t\t\t\t\tfont-weight: bold;\n\t\t\t\t\t}\n\n\t\t\t\t\t.marker-info {\n\t\t\t\t\t\tdisplay: none;\n\t\t\t\t\t\tposition: absolute;\n\t\t\t\t\t\tbottom: 100%;\n\t\t\t\t\t\tleft: 50%;\n\t\t\t\t\t\ttransform: translateX(-50%);\n\t\t\t\t\t\tbackground: white;\n\t\t\t\t\t\tpadding: 8px;\n\t\t\t\t\t\tborder-radius: 4px;\n\t\t\t\t\t\tbox-shadow: 0 2px 6px rgba(0,0,0,0.1);\n\t\t\t\t\t\tmin-width: 200px;\n\t\t\t\t\t\tz-index: 1;\n\t\t\t\t\t}\n\n\t\t\t\t\t.parking-marker:hover .marker-info {\n\t\t\t\t\t\tdisplay: block;\n\t\t\t\t\t}\n\t\t\t\t`}</style>\n\t\t\t</React.Fragment>\n\t\t);\n\t}\n}\n\nconst mapStateToProps = (state) => {\n\treturn {\n\t\tcurrent_place: state.placeReducer.current_place,\n\t\tfrom_place: state.navigationReducer.from,\n\t\tto_place: state.navigationReducer.to,\n\t\tboxVisible: state.boxVisibleReducer.box_visible,\n\t\tresult_navigation: state.navigationReducer.result,\n\t\tviewport: state.placeReducer.viewport,\n\t\tresult_select: state.navigationReducer.result_select,\n\t\taround_places: state.searchReducer.around_places,\n\t\tmarkerSelect: state.boxVisibleReducer.red_marker_visible,\n\t\tpositionMarkerSelect: state.boxVisibleReducer.position_red_marker,\n\t\taround_place_center: state.searchReducer.around_place_center,\n\t\tpopup_visible: state.boxVisibleReducer.popup_visible,\n\t\tposition_popup: state.boxVisibleReducer.position_popup,\n\t\ttype_popup: state.boxVisibleReducer.type_popup,\n\t\taround_place_select: state.searchReducer.around_place_select,\n\t\tmy_location: state.placeReducer.my_location,\n\t\trestaurantData: state.searchReducer.restaurant_data,\n\t\tsearchLocalStorage: state.searchReducer.search_local_storage,\n\t\tparkingLots: state.parkingLotReducer.parkingLots,\n\t};\n};\nexport default connect(mapStateToProps)(Map);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}